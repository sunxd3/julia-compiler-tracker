# Julia 1.13 Compiler Changes

*Summary of compiler changes from Julia 1.12 to 1.13*

*Branch point: 2025-10-28, commit `abd8457ca85370eefe3788cfa13a6233773ea16f`*

---

## Frontend and Lowering

### ccall Syntax Distinction (PR #59165)

The distinction between pointer and name in `ccall` is now a syntactic distinction via tuple syntax, changing the lowering and IR shape for foreign function calls.

### Make `=` and `const` Toplevel-Preserving (PR #59784)

Assignment and const declarations are now toplevel-preserving syntax, fixing closure conversion behavior for certain edge cases.

---

## Type Inference

### Use stmt instead of Instruction in def-use map (PR #56201)

Fixed def-use map population by passing the statement (not Instruction wrapper) to `userefs()`, preventing early scan exits that left def-use counts incomplete. This ensures correct type refinement propagation in the IR interpreter.

### Type-assert `isfinite(::AbstractFloat)` (PR #59888)

Type assertion added to `isfinite(::AbstractFloat)` to fix inference invalidation issues.

### Concrete Evaluation Cancellation (PR #59908)

Abstract interpreter now allows ad-hoc cancellation of concrete evaluation, improving handling of long-running or problematic concrete evaluations.

### Set Types of Boxed Variables in Foreign Calls (PR #59921)

Fixed type setting for boxed variables in `abstract_eval_nonlinearized_foreigncall_name`, improving inference correctness for foreign function calls.

---

## Runtime and GC

### Align Interpreter and Codegen Error Behavior (PR #59766)

Aligned interpreter and codegen error behavior for `setglobal!` and related functions, ensuring consistent semantics across execution modes.

### Avoid Method Instance Normalization for Opaque Closures (PR #59772)

Skips method instance normalization for opaque closure methods, improving runtime correctness for opaque closures.

### Fix Missing GC Root (PR #59785)

Fixed a missing GC root in `jl_type_error_global`. The function now protects `JL_MAYBE_UNROOTED` arguments with `JL_GC_PUSH2` before calling allocation functions. Also corrects `jl_module_globalref` annotation from `JL_GLOBALLY_ROOTED` to `JL_PROPAGATES_ROOT`.

---

## Impact on Downstream Tools

### Medium Impact

1. **ccall IR shape changes** (PR #59165): Tools processing ccall lowered IR may need updates.

2. **def-use map correctness** (PR #56201): IR interpreter type refinement and constant propagation now work correctly through cycles.

### Recommendations for Downstream Maintainers

- **JET.jl**: Update for improved type inference behavior from PR #56201
- **Mooncake.jl**: Validate type inference behavior with the fixed def-use map

---

*Generated from PR analyses in `/analyses/v1.13/`.*
