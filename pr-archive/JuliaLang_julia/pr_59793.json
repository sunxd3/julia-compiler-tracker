{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/59793",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/59793/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/59793/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/59793/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/59793",
  "id": 3499620822,
  "node_id": "PR_kwDOABkWpM6s697g",
  "number": 59793,
  "title": "[1.12] Backport (improve sysimage.mk more completely (#57758))",
  "user": {
    "login": "vchuravy",
    "id": 145258,
    "node_id": "MDQ6VXNlcjE0NTI1OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/145258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vchuravy",
    "html_url": "https://github.com/vchuravy",
    "followers_url": "https://api.github.com/users/vchuravy/followers",
    "following_url": "https://api.github.com/users/vchuravy/following{/other_user}",
    "gists_url": "https://api.github.com/users/vchuravy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vchuravy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vchuravy/subscriptions",
    "organizations_url": "https://api.github.com/users/vchuravy/orgs",
    "repos_url": "https://api.github.com/users/vchuravy/repos",
    "events_url": "https://api.github.com/users/vchuravy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vchuravy/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 210703,
      "node_id": "MDU6TGFiZWwyMTA3MDM=",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/building",
      "name": "building",
      "color": "444444",
      "default": false,
      "description": "Build system, or building Julia or its dependencies"
    },
    {
      "id": 7049087670,
      "node_id": "LA_kwDOABkWpM8AAAABpCiKtg",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/regression%201.12",
      "name": "regression 1.12",
      "color": "D93F0B",
      "default": false,
      "description": "Regression in the 1.12 release"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2025-10-09T15:25:50Z",
  "updated_at": "2025-10-21T07:46:11Z",
  "closed_at": "2025-10-12T02:31:11Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/59793",
    "html_url": "https://github.com/JuliaLang/julia/pull/59793",
    "diff_url": "https://github.com/JuliaLang/julia/pull/59793.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/59793.patch",
    "merged_at": "2025-10-12T02:31:11Z"
  },
  "body": "Add back support for -debug builds and define ability to use shared\nlibrary builds more places in the file.\n\nFix #57675\n\n(cherry picked from commit 51da5402f86c98113c78ddeced4e96527fc09a21)\n\nFixes https://github.com/JuliaLang/julia/issues/57675#issuecomment-3386213653\nand https://github.com/JuliaLang/julia/pull/57758#issuecomment-3386223349\n",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/59793/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/59793/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "f58fda5ec855860677e2925ce317614a01a0d434",
      "filename": "Makefile",
      "status": "modified",
      "additions": 1,
      "deletions": 7,
      "changes": 8,
      "blob_url": "https://github.com/JuliaLang/julia/blob/c72ea41475ac83927d147db334c15e1011fba9c7/Makefile",
      "raw_url": "https://github.com/JuliaLang/julia/raw/c72ea41475ac83927d147db334c15e1011fba9c7/Makefile",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/Makefile?ref=c72ea41475ac83927d147db334c15e1011fba9c7",
      "patch": "@@ -110,13 +110,7 @@ julia-src-release julia-src-debug : julia-src-% : julia-deps julia_flisp.boot.in\n julia-cli-release julia-cli-debug: julia-cli-% : julia-deps\n \t@$(MAKE) $(QUIET_MAKE) -C $(BUILDROOT)/cli $*\n \n-julia-sysimg-ji : $(TOP_LEVEL_PKG_LINK_TARGETS) julia-stdlib julia-base julia-cli-$(JULIA_BUILD_MODE) julia-src-$(JULIA_BUILD_MODE) | $(build_private_libdir)\n-\t@$(MAKE) $(QUIET_MAKE) -C $(BUILDROOT) -f sysimage.mk sysimg-ji JULIA_EXECUTABLE='$(JULIA_EXECUTABLE)'\n-\n-julia-sysimg-bc : $(TOP_LEVEL_PKG_LINK_TARGETS) julia-stdlib julia-base julia-cli-$(JULIA_BUILD_MODE) julia-src-$(JULIA_BUILD_MODE) | $(build_private_libdir)\n-\t@$(MAKE) $(QUIET_MAKE) -C $(BUILDROOT) -f sysimage.mk sysimg-bc JULIA_EXECUTABLE='$(JULIA_EXECUTABLE)'\n-\n-julia-sysimg-release julia-sysimg-debug : julia-sysimg-% : julia-sysimg-ji julia-src-%\n+julia-sysimg-release julia-sysimg-debug : julia-sysimg-% : julia-src-% $(TOP_LEVEL_PKG_LINK_TARGETS) julia-stdlib julia-base julia-cli-% julia-src-% | $(build_private_libdir)\n \t@$(MAKE) $(QUIET_MAKE) -C $(BUILDROOT) -f sysimage.mk sysimg-$*\n \n julia-debug julia-release : julia-% : julia-sysimg-% julia-src-% julia-symlink julia-libccalltest \\"
    },
    {
      "sha": "310dbde37580a23a8594ea70c2eb88d6903b69df",
      "filename": "sysimage.mk",
      "status": "modified",
      "additions": 36,
      "deletions": 16,
      "changes": 52,
      "blob_url": "https://github.com/JuliaLang/julia/blob/c72ea41475ac83927d147db334c15e1011fba9c7/sysimage.mk",
      "raw_url": "https://github.com/JuliaLang/julia/raw/c72ea41475ac83927d147db334c15e1011fba9c7/sysimage.mk",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/sysimage.mk?ref=c72ea41475ac83927d147db334c15e1011fba9c7",
      "patch": "@@ -7,7 +7,7 @@ include $(JULIAHOME)/stdlib/stdlib.mk\n default: sysimg-$(JULIA_BUILD_MODE) # contains either \"debug\" or \"release\"\n all: sysimg-release sysimg-debug\n basecompiler-ji: $(build_private_libdir)/basecompiler.ji\n-sysimg-ji: $(build_private_libdir)/sys.ji\n+sysimg-ji: $(build_private_libdir)/sysbase.ji\n sysimg-bc: $(build_private_libdir)/sys-bc.a\n sysimg-release: $(build_private_libdir)/sys.$(SHLIB_EXT)\n sysimg-debug: $(build_private_libdir)/sys-debug.$(SHLIB_EXT)\n@@ -69,28 +69,45 @@ RELDATADIR := $(call rel_path,$(JULIAHOME)/base,$(build_datarootdir))/ # <-- mak\n \n $(build_private_libdir)/basecompiler.ji: $(COMPILER_SRCS)\n \t@$(call PRINT_JULIA, cd $(JULIAHOME)/base && \\\n-\tJULIA_NUM_THREADS=1 $(call spawn,$(JULIA_EXECUTABLE)) -C \"$(JULIA_CPU_TARGET)\" $(HEAPLIM) --output-ji $(call cygpath_w,$@).tmp \\\n-\t\t--startup-file=no --warn-overwrite=yes --depwarn=error -g$(BOOTSTRAP_DEBUG_LEVEL) -O1 Base_compiler.jl --buildroot $(RELBUILDROOT) --dataroot $(RELDATADIR))\n-\t@mv $@.tmp $@\n-\n-$(build_private_libdir)/basecompiler-o.a $(build_private_libdir)/basecompiler-bc.a: $(build_private_libdir)/basecompiler-%.a : $(COMPILER_SRCS)\n-\t@$(call PRINT_JULIA, cd $(JULIAHOME)/base && \\\n-\tJULIA_NUM_THREADS=1 $(call spawn,$(JULIA_EXECUTABLE)) -C \"$(JULIA_CPU_TARGET)\" $(HEAPLIM) --output-$* $(call cygpath_w,$@).tmp \\\n+\tJULIA_NUM_THREADS=1 $(call spawn,$(JULIA_EXECUTABLE)) $(HEAPLIM) --output-ji $(call cygpath_w,$@).tmp \\\n \t\t--startup-file=no --warn-overwrite=yes -g$(BOOTSTRAP_DEBUG_LEVEL) -O1 Base_compiler.jl --buildroot $(RELBUILDROOT) --dataroot $(RELDATADIR))\n \t@mv $@.tmp $@\n \n-$(build_private_libdir)/sys.ji: $(build_private_libdir)/basecompiler.$(SHLIB_EXT) $(JULIAHOME)/VERSION $(BASE_SRCS) $(STDLIB_SRCS)\n-\t@$(call PRINT_JULIA, cd $(JULIAHOME)/base && \\\n-\tif ! JULIA_BINDIR=$(call cygpath_w,$(build_bindir)) WINEPATH=\"$(call cygpath_w,$(build_bindir));$$WINEPATH\" \\\n-\t\t\tJULIA_NUM_THREADS=1 $(call spawn, $(JULIA_EXECUTABLE)) -g1 -O1 -C \"$(JULIA_CPU_TARGET)\" $(HEAPLIM) --output-ji $(call cygpath_w,$@).tmp $(JULIA_SYSIMG_BUILD_FLAGS) \\\n-\t\t\t--startup-file=no --warn-overwrite=yes --depwarn=error --sysimage $(call cygpath_w,$<) sysimg.jl --buildroot $(RELBUILDROOT) --dataroot $(RELDATADIR); then \\\n-\t\techo '*** This error might be fixed by running `make clean`. If the error persists$(COMMA) try `make cleanall`. ***'; \\\n+define base_builder\n+$$(build_private_libdir)/basecompiler$1-o.a $$(build_private_libdir)/basecompiler$1-bc.a : $$(build_private_libdir)/basecompiler$1-%.a : $(COMPILER_SRCS)\n+\t@$$(call PRINT_JULIA, cd $$(JULIAHOME)/base && \\\n+\tWINEPATH=\"$$(call cygpath_w,$$(build_bindir));$$$$WINEPATH\" \\\n+\tJULIA_NUM_THREADS=1 \\\n+\t\t$$(call spawn, $3) $2 -C \"$$(JULIA_CPU_TARGET)\" $$(HEAPLIM) --output-$$* $$(call cygpath_w,$$@).tmp \\\n+\t\t--startup-file=no --warn-overwrite=yes -g$$(BOOTSTRAP_DEBUG_LEVEL) Base_compiler.jl --buildroot $$(RELBUILDROOT) --dataroot $$(RELDATADIR))\n+\t@mv $$@.tmp $$@\n+$$(build_private_libdir)/sysbase$1.ji: $$(build_private_libdir)/basecompiler$1.$$(SHLIB_EXT) $$(JULIAHOME)/VERSION $$(BASE_SRCS) $$(STDLIB_SRCS)\n+\t@$$(call PRINT_JULIA, cd $$(JULIAHOME)/base && \\\n+\tif ! JULIA_BINDIR=$$(call cygpath_w,$$(build_bindir)) \\\n+\t     WINEPATH=\"$$(call cygpath_w,$$(build_bindir));$$$$WINEPATH\" \\\n+\t\t JULIA_NUM_THREADS=1 \\\n+\t\t\t$$(call spawn, $$(JULIA_EXECUTABLE)) -g1 $2 -C \"$$(JULIA_CPU_TARGET)\" $$(HEAPLIM) --output-ji $$(call cygpath_w,$$@).tmp $$(JULIA_SYSIMG_BUILD_FLAGS) \\\n+\t\t\t--startup-file=no --warn-overwrite=yes --sysimage $$(call cygpath_w,$$<) sysimg.jl --buildroot $$(RELBUILDROOT) --dataroot $$(RELDATADIR); then \\\n+\t\techo '*** This error might be fixed by running `make clean`. If the error persists$$(COMMA) try `make cleanall`. ***'; \\\n \t\tfalse; \\\n \tfi )\n-\t@mv $@.tmp $@\n+\t@mv $$@.tmp $$@\n+.SECONDARY: $$(build_private_libdir)/basecompiler$1-o.a $$(build_private_libdir)/basecompiler$1-bc.a $$(build_private_libdir)/sysbase$1.ji # request Make to keep these files around\n+endef\n \n define sysimg_builder\n-$$(build_private_libdir)/sys$1-o.a $$(build_private_libdir)/sys$1-bc.a : $$(build_private_libdir)/sys$1-%.a : $$(build_private_libdir)/sys.ji $$(JULIAHOME)/contrib/generate_precompile.jl\n+$$(build_private_libdir)/sysbase$1-o.a $$(build_private_libdir)/sysbase$1-bc.a : $$(build_private_libdir)/sysbase$1-%.a : $$(build_private_libdir)/basecompiler$1.$$(SHLIB_EXT) $$(JULIAHOME)/VERSION $$(BASE_SRCS) $$(STDLIB_SRCS)\n+\t@$$(call PRINT_JULIA, cd $$(JULIAHOME)/base && \\\n+\tif ! JULIA_BINDIR=$$(call cygpath_w,$$(build_bindir)) \\\n+\t     WINEPATH=\"$$(call cygpath_w,$$(build_bindir));$$$$WINEPATH\" \\\n+\t\t JULIA_NUM_THREADS=1 \\\n+\t\t\t$$(call spawn, $$(JULIA_EXECUTABLE)) -g1 $2 -C \"$$(JULIA_CPU_TARGET)\" $$(HEAPLIM) --output-$$* $$(call cygpath_w,$$@).tmp $$(JULIA_SYSIMG_BUILD_FLAGS) \\\n+\t\t\t--startup-file=no --warn-overwrite=yes --sysimage $$(call cygpath_w,$$<) sysimg.jl --buildroot $$(RELBUILDROOT) --dataroot $$(RELDATADIR); then \\\n+\t\techo '*** This error might be fixed by running `make clean`. If the error persists$$(COMMA) try `make cleanall`. ***'; \\\n+\t\tfalse; \\\n+\tfi )\n+\t@mv $$@.tmp $$@\n+$$(build_private_libdir)/sys$1-o.a $$(build_private_libdir)/sys$1-bc.a : $$(build_private_libdir)/sys$1-%.a : $$(build_private_libdir)/sysbase$1.$$(SHLIB_EXT) $$(JULIAHOME)/contrib/generate_precompile.jl\n \t@$$(call PRINT_JULIA, cd $$(JULIAHOME)/base && \\\n \tif ! JULIA_BINDIR=$$(call cygpath_w,$(build_bindir)) \\\n \t\t WINEPATH=\"$$(call cygpath_w,$$(build_bindir));$$$$WINEPATH\" \\\n@@ -105,6 +122,9 @@ $$(build_private_libdir)/sys$1-o.a $$(build_private_libdir)/sys$1-bc.a : $$(buil\n \tfi )\n \t@mv $$@.tmp $$@\n .SECONDARY: $$(build_private_libdir)/sys$1-o.a $(build_private_libdir)/sys$1-bc.a # request Make to keep these files around\n+.SECONDARY: $$(build_private_libdir)/sysbase$1-o.a $(build_private_libdir)/sysbase$1-bc.a # request Make to keep these files around\n endef\n+$(eval $(call base_builder,,-O1,$(JULIA_EXECUTABLE_release)))\n+$(eval $(call base_builder,-debug,-O0,$(JULIA_EXECUTABLE_debug)))\n $(eval $(call sysimg_builder,,-O3,$(JULIA_EXECUTABLE_release)))\n $(eval $(call sysimg_builder,-debug,-O0,$(JULIA_EXECUTABLE_debug)))"
    }
  ]
}