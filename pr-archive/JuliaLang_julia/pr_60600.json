{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60600",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60600/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60600/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60600/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60600",
  "id": 3792883045,
  "node_id": "PR_kwDOABkWpM68HuXk",
  "number": 60600,
  "title": "[JuliaLowering] Avoid creating global binding for keyword slurp argument",
  "user": {
    "login": "aviatesk",
    "id": 40514306,
    "node_id": "MDQ6VXNlcjQwNTE0MzA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/40514306?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aviatesk",
    "html_url": "https://github.com/aviatesk",
    "followers_url": "https://api.github.com/users/aviatesk/followers",
    "following_url": "https://api.github.com/users/aviatesk/following{/other_user}",
    "gists_url": "https://api.github.com/users/aviatesk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aviatesk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aviatesk/subscriptions",
    "organizations_url": "https://api.github.com/users/aviatesk/orgs",
    "repos_url": "https://api.github.com/users/aviatesk/repos",
    "events_url": "https://api.github.com/users/aviatesk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aviatesk/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 9763847389,
      "node_id": "LA_kwDOABkWpM8AAAACRfh83Q",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/JuliaLowering",
      "name": "JuliaLowering",
      "color": "144fbf",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2026-01-08T13:21:13Z",
  "updated_at": "2026-01-12T13:06:28Z",
  "closed_at": "2026-01-12T13:06:26Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60600",
    "html_url": "https://github.com/JuliaLang/julia/pull/60600",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60600.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60600.patch",
    "merged_at": "2026-01-12T13:06:26Z"
  },
  "body": "When `use_ssa_kw_temps=false` (i.e., when a keyword default depends on another keyword name), `kw_val_vars` was set to `kw_names` which included the slurp argument. Since the slurp argument is passed via `remaining_kws`, including it in `kw_val_vars` caused:\r\n1. The slurp name to be referenced as an unbound `Identifier` in kwcall\r\n2. Scope analysis resolving it as a global binding\r\n3. The call to body method having an extra argument\r\n\r\nThis fix excludes the slurp argument from `kw_val_vars` when `has_kw_slurp=true`, since it's always the last element of `kw_names`.\r\n\r\nIR change in kwcall method for `f(; a=1, b=a, kws...) = (a, b, kws)`:\r\n\r\nBefore:\r\n\r\n    22  TestMod.#f#0\r\n    23  slot\u2085/a\r\n    24  slot\u2086/b\r\n    25  Main.kws                                    # unwanted global\r\n    26  (call %\u2082\u2082 %\u2082\u2083 %\u2082\u2084 %\u2082\u2085 %\u2082\u2081 slot\u2083/#self#)    # extra argument\r\n\r\nAfter:\r\n\r\n    22  TestMod.#f#0\r\n    23  slot\u2085/a\r\n    24  slot\u2086/b\r\n    25  (call %\u2082\u2082 %\u2082\u2083 %\u2082\u2084 %\u2082\u2081 slot\u2083/#self#)        # correct\r\n\r\nThis fix is important not only for the correctness of the IR generated by JuliaLowering, but also it eliminates false positive undefined global variable reports that JETLS would report for cases like the following:\r\n```julia\r\nfunction f_kw_slurp_dep(; a=1, b=a, kws...)\r\n    (a, b, kws)\r\nend\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60600/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60600/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "cbb342c5a7d74d06b4f8358b472898a903a5ec4d",
      "filename": "JuliaLowering/src/desugaring.jl",
      "status": "modified",
      "additions": 10,
      "deletions": 1,
      "changes": 11,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Fsrc%2Fdesugaring.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Fsrc%2Fdesugaring.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Fsrc%2Fdesugaring.jl?ref=1ba875d5ce78b59e3126694df77706927f942c89",
      "patch": "@@ -2805,7 +2805,16 @@ function keyword_function_defs(ctx, srcref, callex_srcref, name_str, typevar_nam\n             push!(kw_val_vars, v)\n         end\n     else\n-        kw_val_vars = kw_names\n+        # Use kw_names directly as the values, but exclude slurp if present\n+        # because slurp is passed via remaining_kws\n+        if has_kw_slurp\n+            kw_val_vars = SyntaxList(ctx)\n+            for i in 1:length(kw_names)-1\n+                push!(kw_val_vars, kw_names[i])\n+            end\n+        else\n+            kw_val_vars = kw_names\n+        end\n     end\n \n     kwcall_body_tail = @ast ctx keywords [K\"block\""
    },
    {
      "sha": "c6f274d07e58568afc59c9319d5036ae6cd4642e",
      "filename": "JuliaLowering/test/functions.jl",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Ftest%2Ffunctions.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Ftest%2Ffunctions.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Ffunctions.jl?ref=1ba875d5ce78b59e3126694df77706927f942c89",
      "patch": "@@ -422,6 +422,15 @@ end\n     @test values(test_mod.f_kw_slurp_some(x = 1)) === (;)\n     @test values(test_mod.f_kw_slurp_some()) === (;)\n \n+    # Slurping with defaults depending on keyword names\n+    JuliaLowering.include_string(test_mod, \"\"\"\n+    function f_kw_slurp_dep(; a=1, b=a, kws...)\n+        (a, b, length(kws))\n+    end\n+    \"\"\")\n+    @test test_mod.f_kw_slurp_dep(; a=1) == (1, 1, 0)\n+    @test test_mod.f_kw_slurp_dep(; a=2, c=3) == (2, 2, 1)\n+\n     # Keyword defaults which depend on other keywords.\n     JuliaLowering.include_string(test_mod, \"\"\"\n     begin"
    },
    {
      "sha": "53e646eb12537b9a5c0bf362ccd99d19eb26a259",
      "filename": "JuliaLowering/test/functions_ir.jl",
      "status": "modified",
      "additions": 84,
      "deletions": 0,
      "changes": 84,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Ftest%2Ffunctions_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba875d5ce78b59e3126694df77706927f942c89/JuliaLowering%2Ftest%2Ffunctions_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Ffunctions_ir.jl?ref=1ba875d5ce78b59e3126694df77706927f942c89",
      "patch": "@@ -1366,6 +1366,90 @@ end\n 33  TestMod.f_kw_slurp\n 34  (return %\u2083\u2083)\n \n+########################################\n+# Keyword slurping with defaults depending on keyword names\n+# This tests the case where use_ssa_kw_temps=false because a keyword default\n+# depends on another keyword name. The slurp argument should not be included\n+# in kw_val_vars to avoid creating an unwanted global binding.\n+function f_kw_slurp_dep(; a=1, b=a, kws...)\n+    (a, b, kws)\n+end\n+#---------------------\n+1   (method TestMod.f_kw_slurp_dep)\n+2   latestworld\n+3   (method TestMod.#f_kw_slurp_dep#0)\n+4   latestworld\n+5   TestMod.#f_kw_slurp_dep#0\n+6   (call core.Typeof %\u2085)\n+7   (call top.pairs core.NamedTuple)\n+8   TestMod.f_kw_slurp_dep\n+9   (call core.Typeof %\u2088)\n+10  (call core.svec %\u2086 core.Any core.Any %\u2087 %\u2089)\n+11  (call core.svec)\n+12  SourceLocation::1:10\n+13  (call core.svec %\u2081\u2080 %\u2081\u2081 %\u2081\u2082)\n+14  --- method core.nothing %\u2081\u2083\n+    slots: [slot\u2081/#self#(!read) slot\u2082/a slot\u2083/b slot\u2084/kws slot\u2085/#self#]\n+    1   (meta :nkw 3)\n+    2   (call core.tuple slot\u2082/a slot\u2083/b slot\u2084/kws)\n+    3   (return %\u2082)\n+15  latestworld\n+16  (call core.typeof core.kwcall)\n+17  TestMod.f_kw_slurp_dep\n+18  (call core.Typeof %\u2081\u2087)\n+19  (call core.svec %\u2081\u2086 core.NamedTuple %\u2081\u2088)\n+20  (call core.svec)\n+21  SourceLocation::1:10\n+22  (call core.svec %\u2081\u2089 %\u2082\u2080 %\u2082\u2081)\n+23  --- method core.nothing %\u2082\u2082\n+    slots: [slot\u2081/#self#(!read) slot\u2082/kws slot\u2083/#self# slot\u2084/kwtmp slot\u2085/a(single_assign) slot\u2086/b(single_assign)]\n+    1   (call core.isdefined slot\u2082/kws :a)\n+    2   (gotoifnot %\u2081 label\u2086)\n+    3   (call core.getfield slot\u2082/kws :a)\n+    4   (= slot\u2084/kwtmp %\u2083)\n+    5   (goto label\u2087)\n+    6   (= slot\u2084/kwtmp 1)\n+    7   slot\u2084/kwtmp\n+    8   (= slot\u2085/a %\u2087)\n+    9   (call core.isdefined slot\u2082/kws :b)\n+    10  (gotoifnot %\u2089 label\u2081\u2084)\n+    11  (call core.getfield slot\u2082/kws :b)\n+    12  (= slot\u2084/kwtmp %\u2081\u2081)\n+    13  (goto label\u2081\u2086)\n+    14  slot\u2085/a\n+    15  (= slot\u2084/kwtmp %\u2081\u2084)\n+    16  slot\u2084/kwtmp\n+    17  (= slot\u2086/b %\u2081\u2086)\n+    18  (call core.tuple :a :b)\n+    19  (call core.apply_type core.NamedTuple %\u2081\u2088)\n+    20  (call top.structdiff slot\u2082/kws %\u2081\u2089)\n+    21  (call top.pairs %\u2082\u2080)\n+    22  TestMod.#f_kw_slurp_dep#0\n+    23  (call %\u2082\u2082 slot\u2085/a slot\u2086/b %\u2082\u2081 slot\u2083/#self#)\n+    24  (return %\u2082\u2083)\n+24  latestworld\n+25  TestMod.f_kw_slurp_dep\n+26  (call core.Typeof %\u2082\u2085)\n+27  (call core.svec %\u2082\u2086)\n+28  (call core.svec)\n+29  SourceLocation::1:10\n+30  (call core.svec %\u2082\u2087 %\u2082\u2088 %\u2082\u2089)\n+31  --- method core.nothing %\u2083\u2080\n+    slots: [slot\u2081/#self# slot\u2082/a(single_assign) slot\u2083/b(single_assign) slot\u2084/kws(single_assign)]\n+    1   1\n+    2   (= slot\u2082/a %\u2081)\n+    3   slot\u2082/a\n+    4   (= slot\u2083/b %\u2083)\n+    5   (call core.NamedTuple)\n+    6   (call top.pairs %\u2085)\n+    7   (= slot\u2084/kws %\u2086)\n+    8   TestMod.#f_kw_slurp_dep#0\n+    9   (call %\u2088 slot\u2082/a slot\u2083/b slot\u2084/kws slot\u2081/#self#)\n+    10  (return %\u2089)\n+32  latestworld\n+33  TestMod.f_kw_slurp_dep\n+34  (return %\u2083\u2083)\n+\n ########################################\n # Static parameters used in keywords, with and without the static parameter\n # being present in positional argument types."
    }
  ]
}