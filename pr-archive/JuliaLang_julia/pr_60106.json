{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60106",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60106/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60106/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60106/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60106",
  "id": 3615136776,
  "node_id": "PR_kwDOABkWpM6y6Dt_",
  "number": 60106,
  "title": "RFC: Don't leave precompile-time tempdirs to be cleaned-up in binaries (#60078)",
  "user": {
    "login": "deroulers",
    "id": 25111313,
    "node_id": "MDQ6VXNlcjI1MTExMzEz",
    "avatar_url": "https://avatars.githubusercontent.com/u/25111313?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deroulers",
    "html_url": "https://github.com/deroulers",
    "followers_url": "https://api.github.com/users/deroulers/followers",
    "following_url": "https://api.github.com/users/deroulers/following{/other_user}",
    "gists_url": "https://api.github.com/users/deroulers/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deroulers/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deroulers/subscriptions",
    "organizations_url": "https://api.github.com/users/deroulers/orgs",
    "repos_url": "https://api.github.com/users/deroulers/repos",
    "events_url": "https://api.github.com/users/deroulers/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deroulers/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 6567868799,
      "node_id": "LA_kwDOABkWpM8AAAABh3m5fw",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/backport%201.11",
      "name": "backport 1.11",
      "color": "d4c5f9",
      "default": false,
      "description": "Change should be backported to release-1.11"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "vtjnash",
    "id": 330950,
    "node_id": "MDQ6VXNlcjMzMDk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/330950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vtjnash",
    "html_url": "https://github.com/vtjnash",
    "followers_url": "https://api.github.com/users/vtjnash/followers",
    "following_url": "https://api.github.com/users/vtjnash/following{/other_user}",
    "gists_url": "https://api.github.com/users/vtjnash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vtjnash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vtjnash/subscriptions",
    "organizations_url": "https://api.github.com/users/vtjnash/orgs",
    "repos_url": "https://api.github.com/users/vtjnash/repos",
    "events_url": "https://api.github.com/users/vtjnash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vtjnash/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "vtjnash",
      "id": 330950,
      "node_id": "MDQ6VXNlcjMzMDk1MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/330950?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vtjnash",
      "html_url": "https://github.com/vtjnash",
      "followers_url": "https://api.github.com/users/vtjnash/followers",
      "following_url": "https://api.github.com/users/vtjnash/following{/other_user}",
      "gists_url": "https://api.github.com/users/vtjnash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vtjnash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vtjnash/subscriptions",
      "organizations_url": "https://api.github.com/users/vtjnash/orgs",
      "repos_url": "https://api.github.com/users/vtjnash/repos",
      "events_url": "https://api.github.com/users/vtjnash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vtjnash/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2025-11-12T06:19:09Z",
  "updated_at": "2025-12-17T11:18:13Z",
  "closed_at": "2025-11-13T16:56:33Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60106",
    "html_url": "https://github.com/JuliaLang/julia/pull/60106",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60106.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60106.patch",
    "merged_at": "2025-11-13T16:56:33Z"
  },
  "body": "I think that #60078 is due to the fact that Julia binaries inherit the dictionary `TEMP_CLEANUP` (used in `base/file.jl`) defined during build (more precisely, by function `generate_precompile_statements` in `contrib/generate_precompile.jl`), which is wrong because the temporary files and directories at runtime may reside in quite a different directory than at build time.\r\n\r\nIn particular, in the case of MacPorts on a recent Mac OS (e.g. Mac OS 15), where each user has a specific tempdir not accessible to others, building Julia is performed by the user `macports`, then Julia's binary hardcodes that some directories inside the tempdir of user `macports` have to be cleaned on exit. When running Julia under the identity of another user, who has another tempdir and no read/write access to the tempdir of `macports`, the reported failure happens.\r\n\r\nThe proposed fix is to set up temporary files created by function `generate_precompile_statements` in `contrib/generate_precompile.jl` to have no automatic cleanup. This won't do harm since they will be removed by the cleanup of the temporary directory created by the call to `mktempdir` in function `generate_precompile_statements` (see the call `rm(tmpdir, recursive=true)` in `base/file.jl`). On the other hand, the benefit of this is that the dictionary `TEMP_CLEANUP` at runtime will be free of irrelevant compile-time directories to clean.\r\n\r\nTo test this issue, one can do:\r\n`$ mkdir $TMPDIR/JuliaBuild`\r\n`$ OLDTMPDIR=$TMPDIR`\r\n`$ export TMPDIR=$TMPDIR/JuliaBuild`\r\n`$ cd <julia's build root>`\r\n`$ <build julia>`\r\n`$ strings usr/lib/julia/sys.dylib|less # shows that the temp. dir. JuliaBuild is hardcoded in the binaries`\r\n`$ TMPDIR=$OLDTMPDIR`\r\n`$ chmod u-x $TMPDIR/JuliaBuild`\r\n`$ <run the built julia with ./julia and exit> # should try to use $TMPDIR/JuliaBuild which is now inaccessible`\r\n\r\nWithout the fix, the last step triggers the infinite loop of ``Failed to clean up temporary path''. With the fix, one can see that the binaries (`usr/lib/julia/sys.dylib`) do not contain the temp. dir. anymore, and the infinite loop of errors is not triggered.\r\n\r\nAny comment/help appreciated.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60106/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60106/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "d9259333144811ffb72c9c1df13800f7698794e4",
      "filename": "contrib/generate_precompile.jl",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/JuliaLang/julia/blob/7a7b374cd947c239ece3a261366d0e6d627a2e9c/contrib%2Fgenerate_precompile.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/7a7b374cd947c239ece3a261366d0e6d627a2e9c/contrib%2Fgenerate_precompile.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/contrib%2Fgenerate_precompile.jl?ref=7a7b374cd947c239ece3a261366d0e6d627a2e9c",
      "patch": "@@ -346,8 +346,8 @@ generate_precompile_statements() = try # Make sure `ansi_enablecursor` is printe\n             uuid = \"$pkguuid\"\n             \"\"\")\n         touch(joinpath(pkgpath, \"Manifest.toml\"))\n-        tmp_prec = tempname(prec_path)\n-        tmp_proc = tempname(prec_path)\n+        tmp_prec = tempname(prec_path; cleanup=false)\n+        tmp_proc = tempname(prec_path; cleanup=false)\n         s = \"\"\"\n             pushfirst!(DEPOT_PATH, $(repr(joinpath(prec_path,\"depot\"))));\n             Base.PRECOMPILE_TRACE_COMPILE[] = $(repr(tmp_prec));"
    }
  ]
}