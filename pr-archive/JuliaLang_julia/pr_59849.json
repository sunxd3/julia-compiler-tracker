{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/59849",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/59849/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/59849/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/59849/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/59849",
  "id": 3518422579,
  "node_id": "PR_kwDOABkWpM6t5_G8",
  "number": 59849,
  "title": "allow specifying projects in a workspace more than one level under it",
  "user": {
    "login": "KristofferC",
    "id": 1282691,
    "node_id": "MDQ6VXNlcjEyODI2OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1282691?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KristofferC",
    "html_url": "https://github.com/KristofferC",
    "followers_url": "https://api.github.com/users/KristofferC/followers",
    "following_url": "https://api.github.com/users/KristofferC/following{/other_user}",
    "gists_url": "https://api.github.com/users/KristofferC/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KristofferC/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KristofferC/subscriptions",
    "organizations_url": "https://api.github.com/users/KristofferC/orgs",
    "repos_url": "https://api.github.com/users/KristofferC/repos",
    "events_url": "https://api.github.com/users/KristofferC/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KristofferC/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 24139877,
      "node_id": "MDU6TGFiZWwyNDEzOTg3Nw==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/packages",
      "name": "packages",
      "color": "D180FB",
      "default": false,
      "description": "Package management and loading"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2025-10-15T14:52:12Z",
  "updated_at": "2025-11-21T11:28:40Z",
  "closed_at": "2025-10-17T11:11:53Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/59849",
    "html_url": "https://github.com/JuliaLang/julia/pull/59849",
    "diff_url": "https://github.com/JuliaLang/julia/pull/59849.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/59849.patch",
    "merged_at": "2025-10-17T11:11:52Z"
  },
  "body": "we find \"parent\" projects by searching upwards, in a similar way to how we find a standard project file when we are in a subfolder\r\n",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/59849/reactions",
    "total_count": 2,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 2,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/59849/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "e326c39cdd4c4d3174ff5c046024e8a799e1ab55",
      "filename": "base/loading.jl",
      "status": "modified",
      "additions": 38,
      "deletions": 13,
      "changes": 51,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/base%2Floading.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/base%2Floading.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/base%2Floading.jl?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -671,20 +671,45 @@ function env_project_file(env::String)::Union{Bool,String}\n end\n \n function base_project(project_file)\n-    base_dir = abspath(joinpath(dirname(project_file), \"..\"))\n-    base_project_file = env_project_file(base_dir)\n-    base_project_file isa String || return nothing\n-    d = parsed_toml(base_project_file)\n-    workspace = get(d, \"workspace\", nothing)::Union{Dict{String, Any}, Nothing}\n-    if workspace === nothing\n-        return nothing\n-    end\n-    projects = get(workspace, \"projects\", nothing)::Union{Vector{String}, Nothing, String}\n-    projects === nothing && return nothing\n-    if projects isa Vector && basename(dirname(project_file)) in projects\n-        return base_project_file\n+    home_dir = abspath(homedir())\n+    project_dir = abspath(dirname(project_file))\n+    current_dir = project_dir\n+    # Only stop at home boundary if we started under home\n+    started_in_home = startswith(project_dir, home_dir)\n+\n+    while true\n+        parent_dir = dirname(current_dir)\n+        # Stop if we've reached root\n+        if parent_dir == current_dir\n+            return nothing\n+        end\n+        # Stop if we started in home and have now left it\n+        if started_in_home && !startswith(parent_dir, home_dir)\n+            return nothing\n+        end\n+\n+        base_project_file = env_project_file(parent_dir)\n+        if base_project_file isa String\n+            d = parsed_toml(base_project_file)\n+            workspace = get(d, \"workspace\", nothing)::Union{Dict{String, Any}, Nothing}\n+            if workspace !== nothing\n+                projects = get(workspace, \"projects\", nothing)::Union{Vector{String}, Nothing, String}\n+                if projects isa Vector\n+                    # Check if any project in the workspace matches the original project\n+                    workspace_root = dirname(base_project_file)\n+                    for project in projects\n+                        project_path = joinpath(workspace_root, project)\n+                        if isdir(project_path)\n+                            if samefile(project_path, project_dir)\n+                                return base_project_file\n+                            end\n+                        end\n+                    end\n+                end\n+            end\n+        end\n+        current_dir = parent_dir\n     end\n-    return nothing\n end\n \n function project_deps_get(env::String, name::String)::Union{Nothing,PkgId}"
    },
    {
      "sha": "c673f8bd4f6d7a14b10871272ac2954e156719b2",
      "filename": "doc/src/manual/code-loading.md",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/doc%2Fsrc%2Fmanual%2Fcode-loading.md",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/doc%2Fsrc%2Fmanual%2Fcode-loading.md",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/doc%2Fsrc%2Fmanual%2Fcode-loading.md?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -406,7 +406,9 @@ A project file can define a workspace by giving a set of projects that is part o\n projects = [\"test\", \"benchmarks\", \"docs\", \"SomePackage\"]\n ```\n \n-Each subfolder contains its own `Project.toml` file, which may include additional dependencies and compatibility constraints. In such cases, the package manager gathers all dependency information from all the projects in the workspace generating a single manifest file that combines the versions of all dependencies.\n+Each project listed in the `projects` array is specified by its relative path from the workspace root. This can be a direct child directory (e.g., `\"test\"`) or a nested subdirectory (e.g., `\"nested/subdir/MyPackage\"`). Each project contains its own `Project.toml` file, which may include additional dependencies and compatibility constraints. In such cases, the package manager gathers all dependency information from all the projects in the workspace generating a single manifest file that combines the versions of all dependencies.\n+\n+When Julia loads a project, it searches upward through parent directories until it reaches the user's home directory to find a workspace that includes that project. This allows workspace projects to be nested at arbitrary depth within the workspace directory tree.\n \n Furthermore, workspaces can be \"nested\", meaning a project defining a workspace can also be part of another workspace. In this scenario, a single manifest file is still utilized, stored alongside the \"root project\" (the project that doesn't have another workspace including it). An example file structure could look like this:\n "
    },
    {
      "sha": "f27451d45b328d80973c260223fc724b260a7499",
      "filename": "test/loading.jl",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Floading.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Floading.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Floading.jl?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -1669,6 +1669,14 @@ end\n        @test isfile(Base.locate_package(id_dev))\n        @test Base.identify_package(\"Devved2\") === nothing\n \n+       # Test that workspace projects can be specified with subfolder paths\n+       # and that base_project searches upward through multiple directory levels\n+       empty!(LOAD_PATH)\n+       push!(LOAD_PATH, joinpath(@__DIR__, \"project\", \"SubProject\", \"nested\", \"deep\"))\n+       proj_file = joinpath(@__DIR__, \"project\", \"SubProject\", \"nested\", \"deep\", \"Project.toml\")\n+       base_proj = Base.base_project(proj_file)\n+       @test base_proj == joinpath(@__DIR__, \"project\", \"SubProject\", \"Project.toml\")\n+\n     finally\n        copy!(LOAD_PATH, old_load_path)\n     end"
    },
    {
      "sha": "40fb20eee68265fa785d973431d9f04de4a058f5",
      "filename": "test/project/SubProject/Project.toml",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2FProject.toml",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2FProject.toml",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Fproject%2FSubProject%2FProject.toml?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -2,7 +2,7 @@ name = \"MyPkg\"\n uuid = \"0cafdeb2-d7a2-40d0-8d22-4411fcc2c4ee\"\n \n [workspace]\n-projects = [\"sub\", \"PackageThatIsSub\", \"test\"]\n+projects = [\"sub\", \"PackageThatIsSub\", \"test\", \"nested/deep\"]\n \n [deps]\n Devved = \"cbce3a6e-7a3d-4e84-8e6d-b87208df7599\""
    },
    {
      "sha": "5567e6f4974dbc09863a01a1d6ce390ea7eb9cd6",
      "filename": "test/project/SubProject/nested/deep/Project.toml",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2FProject.toml",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2FProject.toml",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2FProject.toml?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -0,0 +1,2 @@\n+name = \"DeepNested\"\n+uuid = \"d5e3a334-7f12-4e5f-9ab8-123456789abc\""
    },
    {
      "sha": "3e5553c1fd9ba3acb0c8e61d8c95c15eb5fe74c2",
      "filename": "test/project/SubProject/nested/deep/src/DeepNested.jl",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2Fsrc%2FDeepNested.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2Fsrc%2FDeepNested.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Fproject%2FSubProject%2Fnested%2Fdeep%2Fsrc%2FDeepNested.jl?ref=16fa7a43b506de8c25c0a3c9c0d88049ace2ccd1",
      "patch": "@@ -0,0 +1,2 @@\n+module DeepNested\n+end"
    }
  ]
}