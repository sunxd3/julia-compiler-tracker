{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60554",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60554/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60554/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60554/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60554",
  "id": 3782705761,
  "node_id": "PR_kwDOABkWpM67mI7B",
  "number": 60554,
  "title": "Markdown: cleanup test suite",
  "user": {
    "login": "fingolfin",
    "id": 241512,
    "node_id": "MDQ6VXNlcjI0MTUxMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/241512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fingolfin",
    "html_url": "https://github.com/fingolfin",
    "followers_url": "https://api.github.com/users/fingolfin/followers",
    "following_url": "https://api.github.com/users/fingolfin/following{/other_user}",
    "gists_url": "https://api.github.com/users/fingolfin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fingolfin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fingolfin/subscriptions",
    "organizations_url": "https://api.github.com/users/fingolfin/orgs",
    "repos_url": "https://api.github.com/users/fingolfin/repos",
    "events_url": "https://api.github.com/users/fingolfin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fingolfin/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 10466303,
      "node_id": "MDU6TGFiZWwxMDQ2NjMwMw==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/test",
      "name": "test",
      "color": "e102d8",
      "default": false,
      "description": "This change adds or pertains to unit tests"
    },
    {
      "id": 2317339600,
      "node_id": "MDU6TGFiZWwyMzE3MzM5NjAw",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/markdown",
      "name": "markdown",
      "color": "D914CD",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2026-01-05T19:59:46Z",
  "updated_at": "2026-01-06T12:57:11Z",
  "closed_at": "2026-01-06T12:57:09Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60554",
    "html_url": "https://github.com/JuliaLang/julia/pull/60554",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60554.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60554.patch",
    "merged_at": "2026-01-06T12:57:09Z"
  },
  "body": "- **Markdown: simplify some tests**\n- **Markdown: avoid some imports in the tests**\n- **Markdown: use @testset**\n\nI'd also like to split it into several files and start adding more\nsystematic tests, but then the conflicts with my other in-flight\nPRs gets too big, so I'll wait with that.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60554/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60554/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "364844a5ea465fe2a12ebdd7dcb5a6cfd79d575d",
      "filename": "stdlib/Markdown/test/runtests.jl",
      "status": "modified",
      "additions": 423,
      "deletions": 422,
      "changes": 845,
      "blob_url": "https://github.com/JuliaLang/julia/blob/2851c75224c290925ac9c35f36b18ad0fd3e533c/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/2851c75224c290925ac9c35f36b18ad0fd3e533c/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fruntests.jl?ref=2851c75224c290925ac9c35f36b18ad0fd3e533c",
      "patch": "@@ -2,79 +2,93 @@\n \n using Test, Markdown, StyledStrings\n import Markdown: MD, Paragraph, Header, Italic, Bold, Strikethrough, LineBreak, Table, Code, LaTeX, Footnote\n-import Markdown: insert_hlines, plain, term, html, rst\n import Base: show\n \n # Basics\n # Equality is checked by making sure the HTML output is\n # the same \u2013 the structure itself may be different.\n+@testset \"basics\" begin\n+    @test md\"foo\" == MD(Paragraph(\"foo\"))\n+    @test md\"foo *bar* baz\" == MD(Paragraph([\"foo \", Italic(\"bar\"), \" baz\"]))\n+    @test md\"foo _bar_ baz\" == MD(Paragraph([\"foo \", Italic(\"bar\"), \" baz\"]))\n+    @test md\"foo **bar** baz\" == MD(Paragraph([\"foo \", Bold(\"bar\"), \" baz\"]))\n+    @test md\"foo __bar__ baz\" == MD(Paragraph([\"foo \", Bold(\"bar\"), \" baz\"]))\n+    @test md\"foo ~bar~ baz\" == MD(Paragraph([\"foo \", Strikethrough(\"bar\"), \" baz\"]))\n+    @test md\"foo ~~bar~~ baz\" == MD(Paragraph([\"foo \", Strikethrough(\"bar\"), \" baz\"]))\n+    @test md\"\"\"foo\n+    bar\"\"\" == MD(Paragraph([\"foo bar\"]))\n+    @test md\"\"\"foo\\\n+    bar\"\"\" == MD(Paragraph([\"foo\", LineBreak(), \"bar\"]))\n+\n+    @test md\"#no title\" == MD(Paragraph([\"#no title\"]))\n+    @test md\"# title\" == MD(Header{1}(\"title\"))\n+    @test md\"\"\"\n+      #\n+      empty\n+      \"\"\" == MD(Header{1}(\"\"), Paragraph(\"empty\"))\n+    @test md\"## section\" == MD(Header{2}(\"section\"))\n+    @test md\"# title *foo* `bar` **baz** ~~qux~~\" ==\n+        MD(Header{1}([\"title \", Italic(\"foo\"),\" \",Code(\"bar\"),\" \",Bold(\"baz\"),\" \",Strikethrough(\"qux\")]))\n+    @test md\"\"\"\n+    h1\n+    ===\"\"\" == md\"# h1\"\n+    @test md\"\"\"\n+    h2\n+       ---\"\"\" == md\"## h2\"\n+\n+    @test md\"**foo *bar* baz**\" == MD(Paragraph(Bold([\"foo \", Italic(\"bar\"), \" baz\"])))\n+    @test md\"*foo **bar** baz*\" == MD(Paragraph(Italic([\"foo \", Bold(\"bar\"), \" baz\"])))\n+end\n \n-@test md\"foo\" == MD(Paragraph(\"foo\"))\n-@test md\"foo *bar* baz\" == MD(Paragraph([\"foo \", Italic(\"bar\"), \" baz\"]))\n-@test md\"foo _bar_ baz\" == MD(Paragraph([\"foo \", Italic(\"bar\"), \" baz\"]))\n-@test md\"foo **bar** baz\" == MD(Paragraph([\"foo \", Bold(\"bar\"), \" baz\"]))\n-@test md\"foo __bar__ baz\" == MD(Paragraph([\"foo \", Bold(\"bar\"), \" baz\"]))\n-@test md\"foo ~bar~ baz\" == MD(Paragraph([\"foo \", Strikethrough(\"bar\"), \" baz\"]))\n-@test md\"foo ~~bar~~ baz\" == MD(Paragraph([\"foo \", Strikethrough(\"bar\"), \" baz\"]))\n-@test md\"\"\"foo\n-bar\"\"\" == MD(Paragraph([\"foo bar\"]))\n-@test md\"\"\"foo\\\n-bar\"\"\" == MD(Paragraph([\"foo\", LineBreak(), \"bar\"]))\n-\n-@test md\"#no title\" == MD(Paragraph([\"#no title\"]))\n-@test md\"# title\" == MD(Header{1}(\"title\"))\n-@test md\"\"\"\n-  #\n-  empty\n-  \"\"\" == MD(Header{1}(\"\"), Paragraph(\"empty\"))\n-@test md\"## section\" == MD(Header{2}(\"section\"))\n-@test md\"# title *foo* `bar` **baz** ~~qux~~\" ==\n-    MD(Header{1}([\"title \", Italic(\"foo\"),\" \",Code(\"bar\"),\" \",Bold(\"baz\"),\" \",Strikethrough(\"qux\")]))\n-@test md\"\"\"\n-h1\n-===\"\"\" == md\"# h1\"\n-@test md\"\"\"\n-h2\n-   ---\"\"\" == md\"## h2\"\n+@testset \"fenced code blocks\" begin\n \n-@test md\"**foo *bar* baz**\" == MD(Paragraph(Bold([\"foo \", Italic(\"bar\"), \" baz\"])))\n-@test md\"*foo **bar** baz*\" == MD(Paragraph(Italic([\"foo \", Bold(\"bar\"), \" baz\"])))\n+    @test md\"\"\"```julia\n+    foo\n+    ```\n+    \"\"\" == MD(Code(\"julia\", \"foo\"))\n \n-@test md\"\"\"```julia\n-foo\n-```\n-\"\"\" == MD(Code(\"julia\", \"foo\"))\n+    @test md\"foo ``bar`` baz\" == MD(Paragraph([\"foo \", LaTeX(\"bar\"), \" baz\"]))\n \n-@test md\"foo ``bar`` baz\" == MD(Paragraph([\"foo \", LaTeX(\"bar\"), \" baz\"]))\n+    @test md\"\"\"\n+    ```math\n+    ...\n+    ```\n+    \"\"\" == MD(LaTeX(\"...\"))\n \n-@test md\"\"\"\n-```math\n-...\n-```\n-\"\"\" == MD(LaTeX(\"...\"))\n+    code_in_code = md\"\"\"\n+    ````\n+    ```\n+    ````\n+    \"\"\"\n+    @test code_in_code == MD(Code(\"```\"))\n+    @test Markdown.plain(code_in_code) == \"````\\n```\\n````\\n\"\n \n-code_in_code = md\"\"\"\n-````\n-```\n-````\n-\"\"\"\n-@test code_in_code == MD(Code(\"```\"))\n-@test plain(code_in_code) == \"````\\n```\\n````\\n\"\n+    let text = \"Foo ```bar` ``baz`` ```\\n\",\n+        md = Markdown.parse(text)\n+        @test text == Markdown.plain(md)\n+    end\n \n-let text = \"Foo ```bar` ``baz`` ```\\n\",\n-    md = Markdown.parse(text)\n-    @test text == Markdown.plain(md)\n+    @test md\"\"\"\n+    ````julia\n+    foo()\n+    ````\"\"\" == md\"\"\"\n+    ```julia\n+    foo()\n+    ```\"\"\"\n end\n \n-@test isempty(Markdown.parse(\"\\r\"))\n-@test Markdown.parse(\"hello\\r\") == MD(Paragraph([\"hello\"]))\n-@test Markdown.parse(\"hello\\r*julia*\") == MD(Paragraph(Any[\"hello \", Italic(Any[\"julia\"])]))\n+@testset \"linefeeds\" begin\n+    @test isempty(Markdown.parse(\"\\r\"))\n+    @test Markdown.parse(\"hello\\r\") == MD(Paragraph([\"hello\"]))\n+    @test Markdown.parse(\"hello\\r*julia*\") == MD(Paragraph(Any[\"hello \", Italic(Any[\"julia\"])]))\n+end\n \n-@test md\"A footnote [^foo].\" == MD(Paragraph([\"A footnote \", Footnote(\"foo\", nothing), \".\"]))\n+@testset \"footnotes\" begin\n+    @test md\"A footnote [^foo].\" == MD(Paragraph([\"A footnote \", Footnote(\"foo\", nothing), \".\"]))\n \n-@test md\"[^foo]: footnote\" == MD([Footnote(\"foo\", Any[Paragraph(Any[\"footnote\"])])])\n+    @test md\"[^foo]: footnote\" == MD([Footnote(\"foo\", Any[Paragraph(Any[\"footnote\"])])])\n \n-let text =\n+    text =\n     \"\"\"\n     A paragraph with some footnotes,[^1] and another.[^note]\n \n@@ -91,20 +105,20 @@ let text =\n     \\tAnd a third paragraph indented with a *tab*.\n \n     This isn't part of the footnote.\n-    \"\"\",\n+    \"\"\"\n     md = Markdown.parse(text)\n-    @test length(md.content) == 4\n-    @test isa(md.content[1], Markdown.Paragraph)\n-    @test isa(md.content[2], Markdown.Footnote)\n-    @test isa(md.content[3], Markdown.Footnote)\n-    @test isa(md.content[4], Markdown.Paragraph)\n+    @test length(md) == 4\n+    @test isa(md[1], Markdown.Paragraph)\n+    @test isa(md[2], Markdown.Footnote)\n+    @test isa(md[3], Markdown.Footnote)\n+    @test isa(md[4], Markdown.Paragraph)\n \n-    @test md.content[2].id == \"1\"\n-    @test md.content[3].id == \"note\"\n+    @test md[2].id == \"1\"\n+    @test md[3].id == \"note\"\n \n-    @test length(md.content[3].text) == 5\n+    @test length(md[3].text) == 5\n \n-    let expected =\n+    expected =\n             \"\"\"\n             A paragraph with some footnotes,[^1] and another.[^note]\n \n@@ -126,9 +140,9 @@ let text =\n \n             This isn't part of the footnote.\n             \"\"\"\n-        @test Markdown.plain(md) == expected\n-    end\n-    let expected =\n+    @test Markdown.plain(md) == expected\n+\n+    expected =\n             \"\"\"\n             A paragraph with some footnotes,[1]_ and another.[note]_\n \n@@ -150,39 +164,39 @@ let text =\n \n             This isn't part of the footnote.\n             \"\"\"\n-        @test Markdown.rst(md) == expected\n-    end\n-    let html = Markdown.html(md)\n-        @test occursin(\",<a href=\\\"#footnote-1\\\" class=\\\"footnote\\\">[1]</a>\", html)\n-        @test occursin(\".<a href=\\\"#footnote-note\\\" class=\\\"footnote\\\">[note]</a>\", html)\n-        @test occursin(\"<div class=\\\"footnote\\\" id=\\\"footnote-1\\\"><p class=\\\"footnote-title\\\">1</p>\", html)\n-        @test occursin(\"<div class=\\\"footnote\\\" id=\\\"footnote-note\\\"><p class=\\\"footnote-title\\\">note</p>\", html)\n-    end\n-    let latex = Markdown.latex(md)\n-        @test occursin(\",\\\\footnotemark[1]\", latex)\n-        @test occursin(\".\\\\footnotemark[note]\", latex)\n-        @test occursin(\"\\n\\\\footnotetext[1]{Footnote text for\", latex)\n-        @test occursin(\"\\n\\\\footnotetext[note]{A longer footnote:\\n\", latex)\n-    end\n-end\n-\n-let doc = md\"\"\"\n-* one\n-* two\n-\n-1. pirate\n-2. ninja\n-3. zombie\"\"\"\n-    @test isa(doc.content[1], Markdown.List)\n-    @test isa(doc.content[2], Markdown.List)\n-    @test doc.content[1].items[1][1].content[1] == \"one\"\n-    @test doc.content[1].items[2][1].content[1] == \"two\"\n-    @test doc.content[2].items[1][1].content[1] == \"pirate\"\n-    @test doc.content[2].items[2][1].content[1] == \"ninja\"\n-    @test doc.content[2].items[3][1].content[1] == \"zombie\"\n+    @test Markdown.rst(md) == expected\n+\n+    html = Markdown.html(md)\n+    @test occursin(\",<a href=\\\"#footnote-1\\\" class=\\\"footnote\\\">[1]</a>\", html)\n+    @test occursin(\".<a href=\\\"#footnote-note\\\" class=\\\"footnote\\\">[note]</a>\", html)\n+    @test occursin(\"<div class=\\\"footnote\\\" id=\\\"footnote-1\\\"><p class=\\\"footnote-title\\\">1</p>\", html)\n+    @test occursin(\"<div class=\\\"footnote\\\" id=\\\"footnote-note\\\"><p class=\\\"footnote-title\\\">note</p>\", html)\n+\n+    latex = Markdown.latex(md)\n+    @test occursin(\",\\\\footnotemark[1]\", latex)\n+    @test occursin(\".\\\\footnotemark[note]\", latex)\n+    @test occursin(\"\\n\\\\footnotetext[1]{Footnote text for\", latex)\n+    @test occursin(\"\\n\\\\footnotetext[note]{A longer footnote:\\n\", latex)\n end\n \n-let doc = Markdown.parse(\n+@testset \"lists\" begin\n+    doc = md\"\"\"\n+    * one\n+    * two\n+\n+    1. pirate\n+    2. ninja\n+    3. zombie\"\"\"\n+    @test length(doc) === 2\n+    @test isa(doc[1], Markdown.List)\n+    @test isa(doc[2], Markdown.List)\n+    @test doc[1].items[1][1].content[1] == \"one\"\n+    @test doc[1].items[2][1].content[1] == \"two\"\n+    @test doc[2].items[1][1].content[1] == \"pirate\"\n+    @test doc[2].items[2][1].content[1] == \"ninja\"\n+    @test doc[2].items[3][1].content[1] == \"zombie\"\n+\n+    doc = Markdown.parse(\n         \"\"\"\n         A paragraph...\n         - one\n@@ -192,57 +206,57 @@ let doc = Markdown.parse(\n         ... another paragraph.\n         \"\"\"\n     )\n-    @test length(doc.content) === 3\n-    @test isa(doc.content[1], Markdown.Paragraph)\n-    @test isa(doc.content[2], Markdown.List)\n-    @test isa(doc.content[3], Markdown.Paragraph)\n-\n-    @test length(doc.content[2].items) === 2\n-    @test doc.content[2].items[1][1].content[1] == \"one\"\n-    @test length(doc.content[2].items[2]) == 2\n-    @test doc.content[2].items[2][1].content[1] == \"two\"\n-\n-    @test isa(doc.content[2].items[2][2], Markdown.List)\n-    @test length(doc.content[2].items[2][2].items) === 2\n-    @test doc.content[2].items[2][2].items[1][1].content[1] == \"three\"\n-    @test doc.content[2].items[2][2].items[2][1].content[1] == \"four\"\n+    @test length(doc) === 3\n+    @test isa(doc[1], Markdown.Paragraph)\n+    @test isa(doc[2], Markdown.List)\n+    @test isa(doc[3], Markdown.Paragraph)\n+\n+    @test length(doc[2].items) === 2\n+    @test doc[2].items[1][1].content[1] == \"one\"\n+    @test length(doc[2].items[2]) == 2\n+    @test doc[2].items[2][1].content[1] == \"two\"\n+\n+    @test isa(doc[2].items[2][2], Markdown.List)\n+    @test length(doc[2].items[2][2].items) === 2\n+    @test doc[2].items[2][2].items[1][1].content[1] == \"three\"\n+    @test doc[2].items[2][2].items[2][1].content[1] == \"four\"\n end\n \n @test md\"Foo [bar]\" == MD(Paragraph(\"Foo [bar]\"))\n @test md\"Foo [bar](baz)\" != MD(Paragraph(\"Foo [bar](baz)\"))\n @test md\"Foo \\[bar](baz)\" == MD(Paragraph(\"Foo [bar](baz)\"))\n \n # Basic plain (markdown) output\n-@test md\"foo\" |> plain == \"foo\\n\"\n-@test md\"foo *bar* baz\" |> plain == \"foo *bar* baz\\n\"\n-@test md\"# title\" |> plain == \"# title\\n\"\n-@test md\"## section\" |> plain == \"## section\\n\"\n-@test md\"## section `foo`\" |> plain == \"## section `foo`\\n\"\n+@test md\"foo\" |> Markdown.plain == \"foo\\n\"\n+@test md\"foo *bar* baz\" |> Markdown.plain == \"foo *bar* baz\\n\"\n+@test md\"# title\" |> Markdown.plain == \"# title\\n\"\n+@test md\"## section\" |> Markdown.plain == \"## section\\n\"\n+@test md\"## section `foo`\" |> Markdown.plain == \"## section `foo`\\n\"\n @test md\"\"\"Hello\n \n ---\n-World\"\"\" |> plain == \"Hello\\n\\n---\\n\\nWorld\\n\"\n-@test md\"[*a*](b)\" |> plain == \"[*a*](b)\\n\"\n+World\"\"\" |> Markdown.plain == \"Hello\\n\\n---\\n\\nWorld\\n\"\n+@test md\"[*a*](b)\" |> Markdown.plain == \"[*a*](b)\\n\"\n @test md\"\"\"\n > foo\n >\n >   * bar\n >\n > ```\n > baz\n-> ```\"\"\" |> plain == \"\"\"> foo\\n>\\n>   * bar\\n>\\n> ```\\n> baz\\n> ```\\n\\n\"\"\"\n+> ```\"\"\" |> Markdown.plain == \"\"\"> foo\\n>\\n>   * bar\\n>\\n> ```\\n> baz\\n> ```\\n\\n\"\"\"\n \n # Terminal (markdown) output\n \n # multiple whitespace is ignored\n-@test sprint(term, md\"a  b\") == \"  a b\"\n-@test sprint(term, md\"[x](https://julialang.org)\") == \"  x\"\n-@test sprint(term, md\"[x](@ref)\") == \"  x\"\n-@test sprint(term, md\"[x](@ref something)\") == \"  x\"\n-@test sprint(term, md\"![x](https://julialang.org)\") == \"  (Image: x)\"\n+@test sprint(Markdown.term, md\"a  b\") == \"  a b\"\n+@test sprint(Markdown.term, md\"[x](https://julialang.org)\") == \"  x\"\n+@test sprint(Markdown.term, md\"[x](@ref)\") == \"  x\"\n+@test sprint(Markdown.term, md\"[x](@ref something)\") == \"  x\"\n+@test sprint(Markdown.term, md\"![x](https://julialang.org)\") == \"  (Image: x)\"\n \n # math (LaTeX)\n-@test sprint(term, md\"\"\"\n+@test sprint(Markdown.term, md\"\"\"\n ```math\n A = Q R\n ```\n@@ -255,19 +269,19 @@ let doc = Markdown.parse(\n         3. b\n         \"\"\"\n     )\n-    @test occursin(\"1. \", sprint(term, doc))\n-    @test occursin(\"2. \", sprint(term, doc))\n-    @test !occursin(\"3. \", sprint(term, doc))\n+    @test occursin(\"1. \", sprint(Markdown.term, doc))\n+    @test occursin(\"2. \", sprint(Markdown.term, doc))\n+    @test !occursin(\"3. \", sprint(Markdown.term, doc))\n end\n \n # Testing margin when printing Tables to the terminal.\n-@test sprint(term, md\"\"\"\n+@test sprint(Markdown.term, md\"\"\"\n | R |\n |---|\n | L |\n \"\"\") == \"  R\\n  \u2013\\n  L\"\n \n-@test sprint(term, md\"\"\"\n+@test sprint(Markdown.term, md\"\"\"\n !!! note \"Tables in admonitions\"\n \n     | R |\n@@ -329,81 +343,83 @@ let doc =\n \n     2. a bc def ghij a bc def ghij a bc def ghij a bc def ghij a bc def ghij a bc def ghij a bc def ghij a bc def ghij a bc def ghij\n     \"\"\"\n-    str = sprint(term, doc, 50)\n+    str = sprint(Markdown.term, doc, 50)\n     @test test_list_wrap(str, 40, 50)\n-    str = sprint(term, doc, 60)\n+    str = sprint(Markdown.term, doc, 60)\n     @test test_list_wrap(str, 50, 60)\n-    str = sprint(term, doc, 80)\n+    str = sprint(Markdown.term, doc, 80)\n     @test test_list_wrap(str, 70, 80)\n end\n \n-# HTML output\n-@test md\"foo *bar* baz\" |> html == \"<p>foo <em>bar</em> baz</p>\\n\"\n-@test md\"something ***\" |> html == \"<p>something ***</p>\\n\"\n-@test md\"# h1## \" |> html == \"<h1>h1##</h1>\\n\"\n-@test md\"## h2 ### \" |> html == \"<h2>h2</h2>\\n\"\n-@test md\"###### h6\" |> html == \"<h6>h6</h6>\\n\"\n-@test md\"####### h7\" |> html == \"<p>####### h7</p>\\n\"\n-@test md\"   >\" |> html == \"<blockquote>\\n</blockquote>\\n\"\n-@test md\"1. Hello\" |> html == \"<ol>\\n<li><p>Hello</p>\\n</li>\\n</ol>\\n\"\n-@test md\"* World\" |> html == \"<ul>\\n<li><p>World</p>\\n</li>\\n</ul>\\n\"\n-@test md\"# title *blah*\" |> html == \"<h1>title <em>blah</em></h1>\\n\"\n-@test md\"## title *blah*\" |> html == \"<h2>title <em>blah</em></h2>\\n\"\n-@test md\"<https://julialang.org>\" |> html == \"\"\"<p><a href=\"https://julialang.org\">https://julialang.org</a></p>\\n\"\"\"\n-@test md\"<mailto://a@example.com>\" |> html == \"\"\"<p><a href=\"mailto://a@example.com\">mailto://a@example.com</a></p>\\n\"\"\"\n-@test md\"<https://julialang.org/not a link>\" |> html == \"<p>&lt;https://julialang.org/not a link&gt;</p>\\n\"\n-@test md\"\"\"<https://julialang.org/nota\n-link>\"\"\" |> html == \"<p>&lt;https://julialang.org/nota link&gt;</p>\\n\"\n-@test md\"\"\"Hello\n-\n----\n-World\"\"\" |> html == \"<p>Hello</p>\\n<hr />\\n<p>World</p>\\n\"\n-@test md\"`escape</code>`\" |> html == \"<p><code>escape&lt;/code&gt;</code></p>\\n\"\n-\n-@test md\"\"\"\n-    code1\n-\n-    code2\n-\"\"\" |> html == \"<pre><code>code1\\n\\ncode2</code></pre>\\n\" # single code block\n+@testset \"HTML output\" begin\n+    @test md\"foo *bar* baz\" |> html == \"<p>foo <em>bar</em> baz</p>\\n\"\n+    @test md\"something ***\" |> html == \"<p>something ***</p>\\n\"\n+    @test md\"# h1## \" |> html == \"<h1>h1##</h1>\\n\"\n+    @test md\"## h2 ### \" |> html == \"<h2>h2</h2>\\n\"\n+    @test md\"###### h6\" |> html == \"<h6>h6</h6>\\n\"\n+    @test md\"####### h7\" |> html == \"<p>####### h7</p>\\n\"\n+    @test md\"   >\" |> html == \"<blockquote>\\n</blockquote>\\n\"\n+    @test md\"1. Hello\" |> html == \"<ol>\\n<li><p>Hello</p>\\n</li>\\n</ol>\\n\"\n+    @test md\"* World\" |> html == \"<ul>\\n<li><p>World</p>\\n</li>\\n</ul>\\n\"\n+    @test md\"# title *blah*\" |> html == \"<h1>title <em>blah</em></h1>\\n\"\n+    @test md\"## title *blah*\" |> html == \"<h2>title <em>blah</em></h2>\\n\"\n+    @test md\"<https://julialang.org>\" |> html == \"\"\"<p><a href=\"https://julialang.org\">https://julialang.org</a></p>\\n\"\"\"\n+    @test md\"<mailto://a@example.com>\" |> html == \"\"\"<p><a href=\"mailto://a@example.com\">mailto://a@example.com</a></p>\\n\"\"\"\n+    @test md\"<https://julialang.org/not a link>\" |> html == \"<p>&lt;https://julialang.org/not a link&gt;</p>\\n\"\n+    @test md\"\"\"<https://julialang.org/nota\n+    link>\"\"\" |> html == \"<p>&lt;https://julialang.org/nota link&gt;</p>\\n\"\n+    @test md\"\"\"Hello\n+\n+    ---\n+    World\"\"\" |> html == \"<p>Hello</p>\\n<hr />\\n<p>World</p>\\n\"\n+    @test md\"`escape</code>`\" |> html == \"<p><code>escape&lt;/code&gt;</code></p>\\n\"\n+\n+    @test md\"\"\"\n+        code1\n+\n+        code2\n+    \"\"\" |> html == \"<pre><code>code1\\n\\ncode2</code></pre>\\n\" # single code block\n+\n+    # @test md\"\"\"\n+    # - Foo\n+    #  ---\n+    # - Bar\"\"\" |> html == \"<ul>\\n<li>Foo</li>\\n</ul>\\n<hr />\\n<ul>\\n<li>Bar</li>\\n</ul>\\n\"\n+    @test md\"\"\"\n+    h1\n+    ===\n+    h2\n+    ---\n+    not\n+    == =\"\"\" |> html == \"<h1>h1</h1>\\n<h2>h2</h2>\\n<p>not &#61;&#61; &#61;</p>\\n\"\n+end\n \n-# @test md\"\"\"\n-# - Foo\n-#  ---\n-# - Bar\"\"\" |> html == \"<ul>\\n<li>Foo</li>\\n</ul>\\n<hr />\\n<ul>\\n<li>Bar</li>\\n</ul>\\n\"\n-@test md\"\"\"\n-h1\n-===\n-h2\n----\n-not\n-== =\"\"\" |> html == \"<h1>h1</h1>\\n<h2>h2</h2>\\n<p>not &#61;&#61; &#61;</p>\\n\"\n+@testset \"the 'book' example input\" begin\n+    book = md\"\"\"\n+    # Title\n \n-# Latex output\n-book = md\"\"\"\n-# Title\n+    Some discussion\n \n-Some discussion\n+    > A quote\n \n-> A quote\n+    ## Section *important*\n \n-## Section *important*\n+    Some **bolded**\n \n-Some **bolded**\n+    - list1\n+    - list2\n+    \"\"\"\n \n-- list1\n-- list2\n-\"\"\"\n-@test latex(book) == \"\\\\section{Title}\\nSome discussion\\n\\n\\\\begin{quote}\\nA quote\\n\\n\\\\end{quote}\\n\\\\subsection{Section \\\\emph{important}}\\nSome \\\\textbf{bolded}\\n\\n\\\\begin{itemize}\\n\\\\item list1\\n\\n\\n\\\\item list2\\n\\n\\\\end{itemize}\\n\"\n-table = md\"\"\"\n- a | b\n----|---\n- 1 | 2\n-\"\"\"\n-@test latex(table) ==\n-    \"\\\\begin{tabular}\\n{r | r}\\na & b \\\\\\\\\\n\\\\hline\\n1 & 2 \\\\\\\\\\n\\\\end{tabular}\\n\"\n+    # Latex output\n+    @test latex(book) == \"\\\\section{Title}\\nSome discussion\\n\\n\\\\begin{quote}\\nA quote\\n\\n\\\\end{quote}\\n\\\\subsection{Section \\\\emph{important}}\\nSome \\\\textbf{bolded}\\n\\n\\\\begin{itemize}\\n\\\\item list1\\n\\n\\n\\\\item list2\\n\\n\\\\end{itemize}\\n\"\n+    table = md\"\"\"\n+     a | b\n+    ---|---\n+     1 | 2\n+    \"\"\"\n+    @test latex(table) ==\n+        \"\\\\begin{tabular}\\n{r | r}\\na & b \\\\\\\\\\n\\\\hline\\n1 & 2 \\\\\\\\\\n\\\\end{tabular}\\n\"\n \n-# mime output\n-let out =\n+    # mime output\n     @test sprint(show, \"text/plain\", book) ==\n         \"\"\"\n           Title\n@@ -438,8 +454,8 @@ let out =\n           * list1\n           * list2\n         \"\"\"\n-end\n-let out =\n+\n+    out =\n     \"\"\"\n     <div class=\"markdown\"><h1>Title</h1>\n     <p>Some discussion</p>\n@@ -456,8 +472,8 @@ let out =\n     </ul>\n     </div>\"\"\"\n     @test sprint(show, \"text/html\", book) == out\n-end\n-let out =\n+\n+    out =\n     \"\"\"\n     \\\\section{Title}\n     Some discussion\n@@ -478,8 +494,8 @@ let out =\n     \\\\end{itemize}\n     \"\"\"\n     @test sprint(show, \"text/latex\", book) == out\n-end\n-let out =\n+\n+    out =\n     \"\"\"\n     Title\n     *****\n@@ -502,8 +518,8 @@ let out =\n     @test sprint(show, \"text/rst\", book) == out\n end\n \n-# rst rendering\n-for (input, output) in (\n+@testset \"rst rendering\" begin\n+    for (input, output) in (\n         md\"foo *bar* baz\"     => \"foo *bar* baz\\n\",\n         md\"something ***\"     => \"something ***\\n\",\n         md\"# h1## \"           => \"h1##\\n****\\n\\n\",\n@@ -525,145 +541,138 @@ for (input, output) in (\n         md\"[`x`](:data:`x`)\"  => \":data:`x`\\n\",\n         md\"[`x`](:???:`x`)\"   => \"```x`` <:???:`x`>`_\\n\",\n         md\"[x](y)\"            => \"`x <y>`_\\n\",\n-    )\n-    @test rst(input) == output\n-end\n-\n-# Interpolation / Custom types\n-mutable struct Reference1\n-    ref\n+        )\n+        @test Markdown.rst(input) == output\n+    end\n end\n \n-show(io::IO, m::MIME\"text/plain\", r::Reference1) =\n-    print(io, \"$(r.ref) (see Julia docs)\")\n+@testset \"Interpolation / Custom types\" begin\n+    mutable struct Reference1\n+        ref\n+    end\n \n-sum_ref = md\"Behaves like $(Reference1(sum))\"\n-@test plain(sum_ref) == \"Behaves like sum (see Julia docs)\\n\"\n-@test html(sum_ref) == \"<p>Behaves like sum &#40;see Julia docs&#41;</p>\\n\"\n+    Base.show(io::IO, m::MIME\"text/plain\", r::Reference1) =\n+        print(io, \"$(r.ref) (see Julia docs)\")\n \n-@testset \"JuliaLang/julia#59783 and #53362\" begin\n-    x = 1\n-    result = md\"\"\"\n-    $x\n+    sum_ref = md\"Behaves like $(Reference1(sum))\"\n+    @test Markdown.plain(sum_ref) == \"Behaves like sum (see Julia docs)\\n\"\n+    @test Markdown.html(sum_ref) == \"<p>Behaves like sum &#40;see Julia docs&#41;</p>\\n\"\n \n-    [^1]: $x\n+    @testset \"JuliaLang/julia#59783 and #53362\" begin\n+        x = 1\n+        result = md\"\"\"\n+        $x\n \n-    !!! note\n-    $x\n+        [^1]: $x\n \n-    > $x\n-    \"\"\"\n-    expected = \"\"\"\n-    1\n+        !!! note\n+        $x\n \n-    [^1]: 1\n+        > $x\n+        \"\"\"\n+        expected = \"\"\"\n+        1\n \n-    !!! note\n+        [^1]: 1\n \n+        !!! note\n \n \n-    1\n \n-    > 1\n+        1\n \n-    \"\"\"\n-    @test plain(result) == expected\n-end\n+        > 1\n \n-mutable struct Reference2\n-    ref\n-end\n+        \"\"\"\n+        @test Markdown.plain(result) == expected\n+    end\n \n-sum_ref = md\"Behaves like $(Reference2(sum))\"\n-show(io::IO, m::MIME\"text/plain\", r::Reference2) =\n-    print(io, \"$(r.ref) (see Julia docs)\")\n-show(io::IO, m::MIME\"text/html\", r::Reference2) =\n-    Markdown.withtag(io, :a, :href=>\"test\") do\n-        Markdown.htmlesc(io, Markdown.plaininline(r))\n+    mutable struct Reference2\n+        ref\n     end\n-@test html(sum_ref) == \"<p>Behaves like <a href=\\\"test\\\">sum &#40;see Julia docs&#41;</a></p>\\n\"\n \n-@test md\"\"\"\n-````julia\n-foo()\n-````\"\"\" == md\"\"\"\n-```julia\n-foo()\n-```\"\"\"\n-\n-# GH tables\n-@test md\"\"\"\n+    sum_ref = md\"Behaves like $(Reference2(sum))\"\n+    Base.show(io::IO, m::MIME\"text/plain\", r::Reference2) =\n+        print(io, \"$(r.ref) (see Julia docs)\")\n+    Base.show(io::IO, m::MIME\"text/html\", r::Reference2) =\n+        Markdown.withtag(io, :a, :href=>\"test\") do\n+            Markdown.htmlesc(io, Markdown.plaininline(r))\n+        end\n+    @test Markdown.html(sum_ref) == \"<p>Behaves like <a href=\\\"test\\\">sum &#40;see Julia docs&#41;</a></p>\\n\"\n+end\n+\n+@testset \"GH tables\" begin\n+    @test md\"\"\"\n     a  | b\n     ---|---\n     1  | 2\"\"\" == MD(Table(Any[[\"a\",\"b\"],\n                               [\"1\",\"2\"]], [:r, :r]))\n \n-@test md\"\"\"\n+    @test md\"\"\"\n     | a  |  b | c |\n     | :-- | --: | --- |\n     | d`gh`hg | hgh**jhj**ge | f |\"\"\" == MD(Table(Any[[\"a\",\"b\",\"c\"],\n                                                       Any[[\"d\",Code(\"gh\"),\"hg\"],\n                                                           [\"hgh\",Bold(\"jhj\"),\"ge\"],\n                                                           \"f\"]],\n                                                   [:l, :r, :r]))\n-@test md\"\"\"\n+    @test md\"\"\"\n     |   | b |\n     |:--|--:|\n     | 1 |   |\"\"\" == MD(Table(Any[[Any[],\"b\"],\n                                  [\"1\",Any[]]], [:l, :r]))\n \n-@test md\"\"\"\n-no|table\n-no error\n-\"\"\" == MD([Paragraph(Any[\"no|table no error\"])])\n+    @test md\"\"\"\n+    no|table\n+    no error\n+    \"\"\" == MD([Paragraph(Any[\"no|table no error\"])])\n \n-let t = \"\"\"a   |   b\n+    t = \"\"\"a   |   b\n     :-- | --:\n     1   |   2\n     \"\"\"\n     @test Markdown.parse(t) == MD(Table(Any[Any[\"a\", \"b\"], Any[\"1\", \"2\"]], [:l, :r]))\n-end\n \n-let text =\n+    text =\n     \"\"\"\n     | a   |   b |\n     |:--- | ---:|\n     | 1   |   2 |\n-    \"\"\",\n+    \"\"\"\n     table = Markdown.parse(text)\n     @test text == Markdown.plain(table)\n-end\n-let text =\n+\n+    text =\n     \"\"\"\n     | Markdown | Table |  Test |\n     |:-------- |:-----:| -----:|\n     | foo      | `bar` | *baz* |\n     | `bar`    |  baz  | *foo* |\n-    \"\"\",\n+    \"\"\"\n     table = Markdown.parse(text)\n     @test text == Markdown.plain(table)\n     @test Markdown.html(table) == \"\"\"<table><tr><th align=\"left\">Markdown</th><th align=\"center\">Table</th><th align=\"right\">Test</th></tr><tr><td align=\"left\">foo</td><td align=\"center\"><code>bar</code></td><td align=\"right\"><em>baz</em></td></tr><tr><td align=\"left\"><code>bar</code></td><td align=\"center\">baz</td><td align=\"right\"><em>foo</em></td></tr></table>\\n\"\"\"\n-end\n-let text =\n+\n+    text =\n     \"\"\"\n     | a        |   b |\n     |:-------- | ---:|\n     | `x \\\\| y` |   2 |\n-    \"\"\",\n+    \"\"\"\n     table = Markdown.parse(text)\n     @test text == Markdown.plain(table)\n     @test Markdown.html(table) == \"\"\"<table><tr><th align=\"left\">a</th><th align=\"right\">b</th></tr><tr><td align=\"left\"><code>x | y</code></td><td align=\"right\">2</td></tr></table>\\n\"\"\"\n end\n \n-# LaTeX extension\n-let in_dollars =\n+@testset \"LaTeX extension\" begin\n+    in_dollars =\n     \"\"\"\n     We have \\$x^2 < x\\$ whenever:\n \n     \\$|x| < 1\\$\n \n     etc.\n-    \"\"\",\n+    \"\"\"\n     in_backticks =\n     \"\"\"\n     We have ``x^2 < x`` whenever:\n@@ -673,7 +682,7 @@ let in_dollars =\n     ```\n \n     etc.\n-    \"\"\",\n+    \"\"\"\n     out_plain =\n     \"\"\"\n     We have \\$x^2 < x\\$ whenever:\n@@ -683,7 +692,7 @@ let in_dollars =\n     \\$\\$\n \n     etc.\n-    \"\"\",\n+    \"\"\"\n     out_rst =\n     \"\"\"\n     We have :math:`x^2 < x` whenever:\n@@ -693,17 +702,17 @@ let in_dollars =\n         |x| < 1\n \n     etc.\n-    \"\"\",\n+    \"\"\"\n     out_latex =\n     \"\"\"\n     We have \\$x^2 < x\\$ whenever:\n \n     \\$\\$|x| < 1\\$\\$\n     etc.\n \n-    \"\"\",\n-    dollars   = Markdown.parse(in_dollars),\n-    backticks = Markdown.parse(in_backticks),\n+    \"\"\"\n+    dollars   = Markdown.parse(in_dollars)\n+    backticks = Markdown.parse(in_backticks)\n     latex_doc = MD(\n         Any[Paragraph(Any[\"We have \", LaTeX(\"x^2 < x\"), \" whenever:\"]),\n             LaTeX(\"|x| < 1\"),\n@@ -723,18 +732,18 @@ let in_dollars =\n     @test latex_doc == backticks\n end\n \n-# Nested backticks for inline code and math.\n-let t_1 = \"`code` ``math`` ```code``` ````math```` `````code`````\",\n-    t_2 = \"`` `math` `` ``` `code` ``code`` ``` ```` `math` ``math`` ```math``` ````\",\n-    t_3 = \"`` ` `` ``` `` ` `` ` ` ```\",\n+@testset \"Nested backticks for inline code and math\" begin\n+    t_1 = \"`code` ``math`` ```code``` ````math```` `````code`````\"\n+    t_2 = \"`` `math` `` ``` `code` ``code`` ``` ```` `math` ``math`` ```math``` ````\"\n+    t_3 = \"`` ` `` ``` `` ` `` ` ` ```\"\n     t_4 = \"\"\"`code\n     over several\n     lines` ``math\n     over several\n     lines`` ``math with\n     ` some extra ` ` backticks`\n-    ``\"\"\",\n-    t_5 = \"``code at end of string`\",\n+    ``\"\"\"\n+    t_5 = \"``code at end of string`\"\n     t_6 = \"```math at end of string``\"\n     @test Markdown.parse(t_1) == MD(Paragraph([\n         Code(\"code\"),\n@@ -776,8 +785,8 @@ let t_1 = \"`code` ``math`` ```code``` ````math```` `````code`````\",\n     ]))\n end\n \n-# Admonitions.\n-let t_1 =\n+@testset \"Admonitions\" begin\n+    t_1 =\n         \"\"\"\n         # Foo\n \n@@ -790,7 +799,7 @@ let t_1 =\n         !!! danger \"\"\n \n         !!!\n-        \"\"\",\n+        \"\"\"\n     t_2 =\n         \"\"\"\n         !!! note\n@@ -814,51 +823,51 @@ let t_1 =\n                 bar\n \n             # baz\n-        \"\"\",\n-    m_1 = Markdown.parse(t_1),\n+        \"\"\"\n+    m_1 = Markdown.parse(t_1)\n     m_2 = Markdown.parse(t_2)\n \n     # Content Tests.\n \n-    @test isa(m_1.content[2], Markdown.Admonition)\n-    @test m_1.content[2].category == \"note\"\n-    @test m_1.content[2].title == \"Note\"\n-    @test m_1.content[2].content == []\n-\n-    @test isa(m_1.content[3], Markdown.Admonition)\n-    @test m_1.content[3].category == \"warning\"\n-    @test m_1.content[3].title == \"custom title\"\n-    @test m_1.content[3].content == []\n-\n-    @test isa(m_1.content[5], Markdown.Admonition)\n-    @test m_1.content[5].category == \"danger\"\n-    @test m_1.content[5].title == \"\"\n-    @test m_1.content[5].content == []\n-\n-    @test isa(m_1.content[6], Markdown.Paragraph)\n-\n-    @test isa(m_2.content[1], Markdown.Admonition)\n-    @test m_2.content[1].category == \"note\"\n-    @test m_2.content[1].title == \"Note\"\n-    @test isa(m_2.content[1].content[1], Markdown.Paragraph)\n-    @test isa(m_2.content[1].content[2], Markdown.Paragraph)\n-\n-    @test isa(m_2.content[2], Markdown.Admonition)\n-    @test m_2.content[2].category == \"warning\"\n-    @test m_2.content[2].title == \"custom title\"\n-    @test isa(m_2.content[2].content[1], Markdown.List)\n-    @test isa(m_2.content[2].content[2], Markdown.Paragraph)\n-\n-    @test isa(m_2.content[3], Markdown.Admonition)\n-    @test m_2.content[3].category == \"danger\"\n-    @test m_2.content[3].title == \"\"\n-    @test isa(m_2.content[3].content[1], Markdown.Code)\n-    @test isa(m_2.content[3].content[2], Markdown.Code)\n-    @test isa(m_2.content[3].content[3], Markdown.Header{1})\n+    @test isa(m_1[2], Markdown.Admonition)\n+    @test m_1[2].category == \"note\"\n+    @test m_1[2].title == \"Note\"\n+    @test m_1[2].content == []\n+\n+    @test isa(m_1[3], Markdown.Admonition)\n+    @test m_1[3].category == \"warning\"\n+    @test m_1[3].title == \"custom title\"\n+    @test m_1[3].content == []\n+\n+    @test isa(m_1[5], Markdown.Admonition)\n+    @test m_1[5].category == \"danger\"\n+    @test m_1[5].title == \"\"\n+    @test m_1[5].content == []\n+\n+    @test isa(m_1[6], Markdown.Paragraph)\n+\n+    @test isa(m_2[1], Markdown.Admonition)\n+    @test m_2[1].category == \"note\"\n+    @test m_2[1].title == \"Note\"\n+    @test isa(m_2[1].content[1], Markdown.Paragraph)\n+    @test isa(m_2[1].content[2], Markdown.Paragraph)\n+\n+    @test isa(m_2[2], Markdown.Admonition)\n+    @test m_2[2].category == \"warning\"\n+    @test m_2[2].title == \"custom title\"\n+    @test isa(m_2[2].content[1], Markdown.List)\n+    @test isa(m_2[2].content[2], Markdown.Paragraph)\n+\n+    @test isa(m_2[3], Markdown.Admonition)\n+    @test m_2[3].category == \"danger\"\n+    @test m_2[3].title == \"\"\n+    @test isa(m_2[3].content[1], Markdown.Code)\n+    @test isa(m_2[3].content[2], Markdown.Code)\n+    @test isa(m_2[3].content[3], Markdown.Header{1})\n \n     # Rendering Tests.\n-    let out = Markdown.plain(m_1),\n-        expected =\n+    actual = Markdown.plain(m_1)\n+    expected =\n             \"\"\"\n             # Foo\n \n@@ -872,10 +881,10 @@ let t_1 =\n             \\n\\n\n             !!!\n             \"\"\"\n-        @test out == expected\n-    end\n-    let out = Markdown.rst(m_1),\n-        expected =\n+    @test actual == expected\n+\n+    actual = Markdown.rst(m_1)\n+    expected =\n             \"\"\"\n             Foo\n             ***\n@@ -891,10 +900,10 @@ let t_1 =\n             \\n\\n\n             !!!\n             \"\"\"\n-        @test out == expected\n-    end\n-    let out = Markdown.latex(m_1),\n-        expected =\n+    @test actual == expected\n+\n+    actual = Markdown.latex(m_1)\n+    expected =\n             \"\"\"\n             \\\\section{Foo}\n             \\\\begin{quote}\n@@ -917,10 +926,10 @@ let t_1 =\n             !!!\n \n             \"\"\"\n-        @test out == expected\n-    end\n-    let out = Markdown.html(m_1),\n-        expected =\n+    @test actual == expected\n+\n+    actual = Markdown.html(m_1)\n+    expected =\n             \"\"\"\n             <h1>Foo</h1>\n             <div class=\"admonition note\"><p class=\"admonition-title\">Note</p></div>\n@@ -929,11 +938,10 @@ let t_1 =\n             <div class=\"admonition danger\"><p class=\"admonition-title\"></p></div>\n             <p>&#33;&#33;&#33;</p>\n             \"\"\"\n-        @test out == expected\n-    end\n+    @test actual == expected\n \n-    let out = Markdown.plain(m_2),\n-        expected =\n+    actual = Markdown.plain(m_2)\n+    expected =\n             \"\"\"\n             !!! note\n                 foo bar baz\n@@ -961,10 +969,10 @@ let t_1 =\n                 # baz\n \n             \"\"\"\n-        @test out == expected\n-    end\n-    let out = Markdown.rst(m_2),\n-        expected =\n+    @test actual == expected\n+\n+    actual = Markdown.rst(m_2)\n+    expected =\n             \"\"\"\n             .. note::\n                foo bar baz\n@@ -993,12 +1001,11 @@ let t_1 =\n                ***\n \n             \"\"\"\n-        @test out == expected\n-    end\n+    @test actual == expected\n end\n \n-# Nested Lists.\n-let text =\n+@testset \"Nested Lists\" begin\n+    text =\n         \"\"\"\n         1. A paragraph\n            with two lines.\n@@ -1025,33 +1032,33 @@ let text =\n         1. foo\n         2. bar\n         3. baz\n-        \"\"\",\n+        \"\"\"\n     md = Markdown.parse(text)\n \n     # Content and structure tests.\n \n-    @test length(md.content) == 6\n-    @test length(md.content[1].items) == 1\n-    @test length(md.content[1].items[1]) == 3\n-    @test isa(md.content[1].items[1][1], Markdown.Paragraph)\n-    @test isa(md.content[1].items[1][2], Markdown.Code)\n-    @test isa(md.content[1].items[1][3], Markdown.BlockQuote)\n-    @test length(md.content[2].items) == 1\n-    @test isa(md.content[2].items[1][1], Markdown.Paragraph)\n-    @test isa(md.content[3], Markdown.Paragraph)\n-    @test length(md.content[4].items) == 1\n-    @test isa(md.content[4].items[1][1], Paragraph)\n-    @test isa(md.content[4].items[1][2], Paragraph)\n-    @test length(md.content[5].items) == 2\n-    @test isa(md.content[5].items[1][1], Markdown.Paragraph)\n-    @test isa(md.content[5].items[2][1], Markdown.Code)\n-    @test length(md.content[6].items) == 3\n-    @test md.content[6].items[1][1].content[1] == \"foo\"\n-    @test md.content[6].items[2][1].content[1] == \"bar\"\n-    @test md.content[6].items[3][1].content[1] == \"baz\"\n+    @test length(md) == 6\n+    @test length(md[1].items) == 1\n+    @test length(md[1].items[1]) == 3\n+    @test isa(md[1].items[1][1], Markdown.Paragraph)\n+    @test isa(md[1].items[1][2], Markdown.Code)\n+    @test isa(md[1].items[1][3], Markdown.BlockQuote)\n+    @test length(md[2].items) == 1\n+    @test isa(md[2].items[1][1], Markdown.Paragraph)\n+    @test isa(md[3], Markdown.Paragraph)\n+    @test length(md[4].items) == 1\n+    @test isa(md[4].items[1][1], Paragraph)\n+    @test isa(md[4].items[1][2], Paragraph)\n+    @test length(md[5].items) == 2\n+    @test isa(md[5].items[1][1], Markdown.Paragraph)\n+    @test isa(md[5].items[2][1], Markdown.Code)\n+    @test length(md[6].items) == 3\n+    @test md[6].items[1][1].content[1] == \"foo\"\n+    @test md[6].items[2][1].content[1] == \"bar\"\n+    @test md[6].items[3][1].content[1] == \"baz\"\n \n     # Rendering tests.\n-    let expected =\n+    expected =\n             \"\"\"\n             1. A paragraph with two lines.\n \n@@ -1078,10 +1085,9 @@ let text =\n             2. bar\n             3. baz\n             \"\"\"\n-        @test expected == Markdown.plain(md)\n-    end\n+    @test expected == Markdown.plain(md)\n \n-    let expected =\n+    expected =\n             \"\"\"\n             <ol>\n             <li><p>A paragraph with two lines.</p>\n@@ -1116,10 +1122,9 @@ let text =\n             </li>\n             </ol>\n             \"\"\"\n-        @test expected == Markdown.html(md)\n-    end\n+    @test expected == Markdown.html(md)\n \n-    let expected =\n+    expected =\n             \"\"\"\n             1. A paragraph with two lines.\n \n@@ -1146,12 +1151,11 @@ let text =\n             2. bar\n             3. baz\n             \"\"\"\n-        @test expected == Markdown.rst(md)\n-    end\n+    @test expected == Markdown.rst(md)\n end\n \n-# Ordered list starting number.\n-let text =\n+@testset \"Ordered list starting number.\" begin\n+    text =\n         \"\"\"\n         42. foo\n         43. bar\n@@ -1163,14 +1167,14 @@ let text =\n \n         - foo\n         - bar\n-        \"\"\",\n+        \"\"\"\n     md = Markdown.parse(text)\n \n-    @test md.content[1].ordered == 42\n-    @test md.content[2].ordered == 1\n-    @test md.content[3].ordered == -1\n+    @test md[1].ordered == 42\n+    @test md[2].ordered == 1\n+    @test md[3].ordered == -1\n \n-    let expected =\n+    expected =\n             \"\"\"\n             <ol start=\"42\">\n             <li><p>foo</p>\n@@ -1191,10 +1195,9 @@ let text =\n             </li>\n             </ul>\n             \"\"\"\n-        @test expected == Markdown.html(md)\n-    end\n+    @test expected == Markdown.html(md)\n \n-    let expected =\n+    expected =\n             \"\"\"\n             \\\\begin{itemize}\n             \\\\item[42. ] foo\n@@ -1218,35 +1221,32 @@ let text =\n \n             \\\\end{itemize}\n             \"\"\"\n-        @test expected == Markdown.latex(md)\n-    end\n+    @test expected == Markdown.latex(md)\n end\n \n-# issue 20225, check this can print\n-@test typeof(sprint(Markdown.term, Markdown.parse(\" \"))) == String\n+@testset \"issue 20225, check this can print\" begin\n+    @test typeof(sprint(Markdown.term, Markdown.parse(\" \"))) == String\n \n-# different output depending on whether color is requested: +# issue 20225, check this can print\n-let buf = IOBuffer()\n+    # different output depending on whether color is requested: +# issue 20225, check this can print\n+    buf = IOBuffer()\n     @test typeof(sprint(Markdown.term, Markdown.parse(\" \"))) == String\n     show(buf, \"text/plain\", md\"*emph*\")\n     @test String(take!(buf)) == \"  emph\"\n     show(buf, \"text/markdown\", md\"*emph*\")\n     @test String(take!(buf)) == \"*emph*\\n\"\n     show(IOContext(buf, :color=>true), \"text/plain\", md\"*emph*\")\n     @test String(take!(buf)) in (\"  \\e[3memph\\e[23m\", \"  \\e[4memph\\e[24m\")\n-end\n \n-let word = \"Markdown\" # disable underline when wrapping lines\n+    word = \"Markdown\" # disable underline when wrapping lines\n     buf = IOBuffer()\n     ctx = IOContext(buf, :color => true, :displaysize => (displaysize(buf)[1], length(word)))\n     long_italic_text = Markdown.parse('_' * join(fill(word, 10), ' ') * '_')\n     show(ctx, MIME(\"text/plain\"), long_italic_text)\n     lines = split(String(take!(buf)), '\\n')\n     @test endswith(lines[begin], r\"\\e\\[2[34]m\")\n     @test startswith(lines[begin+1], Regex(' '^Markdown.margin * \"\\e\\\\[[34]m\"))\n-end\n \n-let word = \"Markdown\" # pre is of size Markdown.margin when wrapping title\n+    word = \"Markdown\" # pre is of size Markdown.margin when wrapping title\n     buf = IOBuffer()\n     ctx = IOContext(buf, :color => true, :displaysize => (displaysize(buf)[1], length(word)))\n     long_title = Markdown.parse(\"# \" * join(fill(word, 3)))\n@@ -1257,11 +1257,12 @@ let word = \"Markdown\" # pre is of size Markdown.margin when wrapping title\n               lines)\n end\n \n-struct Struct49454 end\n-Base.show(io::IO, ::Struct49454) =\n-    print(io, Base.text_colors[:underline], \"Struct 49454()\", Base.text_colors[:normal])\n+@testset \"issue 49454, check this can print\" begin\n+    struct Struct49454 end\n+    Base.show(io::IO, ::Struct49454) =\n+        print(io, Base.text_colors[:underline], \"Struct 49454()\", Base.text_colors[:normal])\n \n-let buf = IOBuffer()\n+    buf = IOBuffer()\n     ctx = IOContext(buf, :color => true, :displaysize => (displaysize(buf)[1], 10))\n     show(ctx, MIME(\"text/plain\"), md\"\"\"\n     text without $(Struct49454()) underline.\n@@ -1270,15 +1271,15 @@ let buf = IOBuffer()\n     @test !occursin(Base.text_colors[:underline], lines[end])\n end\n \n-# table rendering with term #25213\n-t = \"\"\"\n-    a   |   b\n-    :-- | --:\n-    1   |   2\"\"\"\n-@test sprint(Markdown.term, Markdown.parse(t), 0) == \"  a b\\n  \u2013 \u2013\\n  1 2\"\n+@testset \"table rendering with term #25213\" begin\n+    t = \"\"\"\n+        a   |   b\n+        :-- | --:\n+        1   |   2\"\"\"\n+    @test sprint(Markdown.term, Markdown.parse(t), 0) == \"  a b\\n  \u2013 \u2013\\n  1 2\"\n+end\n \n-# test Base.copy\n-let\n+@testset \"test Base.copy\" begin\n     md = doc\"test\"\n     md\u2032 = copy(md)\n     @test length(md) == length(md\u2032) == 1\n@@ -1291,21 +1292,21 @@ let\n     @test !haskey(md\u2032.meta, :foo)\n end\n \n-let\n+@testset \"issue #26598: loose lists\" begin\n     v = Markdown.parse(\"foo\\n\\n- 1\\n- 2\\n\\n- 3\\n\\n\\n- 1\\n- 2\\n\\nbar\\n\\n- 1\\n\\n  2\\n- 4\\n\\nbuz\\n\\n- 1\\n- 2\\n  3\\n- 4\\n\")\n-    @test v.content[2].loose\n-    @test !v.content[3].loose\n-    @test v.content[5].loose\n-    @test !v.content[7].loose\n+    @test v[2].loose\n+    @test !v[3].loose\n+    @test v[5].loose\n+    @test !v[7].loose\n end\n \n-# issue #29995\n-let m = Markdown.parse(\"---\"), io = IOBuffer()\n+@testset \"issue #29995\" begin\n+    m = Markdown.parse(\"---\")\n+    io = IOBuffer()\n     show(io, \"text/latex\", m)\n     @test String(take!(io)) == \"\\\\rule{\\\\textwidth}{1pt}\\n\"\n end\n \n-# issue #16194: interpolation in md\"...\" strings\n @testset \"issue #16194: interpolation in md\\\"...\\\" strings\" begin\n     x = \"X\"\n     contains_X(md) = occursin(x, sprint(show, MIME(\"text/plain\"), md))\n@@ -1326,7 +1327,7 @@ end\n         \"\"\")\n end\n \n-@testset \"issue 40080: empty list item breaks display()\" begin\n+@testset \"issue #40080: empty list item breaks display()\" begin\n     d = TextDisplay(devnull)\n     display(d, md\"\"\"\n                1. hello\n@@ -1447,9 +1448,9 @@ end\n \n @testset \"Non-Markdown\" begin\n     # https://github.com/JuliaLang/julia/issues/37765\n-    @test isa(insert_hlines(Text(\"foo\")), Text)\n+    @test isa(Markdown.insert_hlines(Text(\"foo\")), Text)\n     # https://github.com/JuliaLang/julia/issues/37757\n-    @test insert_hlines(nothing) === nothing\n+    @test Markdown.insert_hlines(nothing) === nothing\n end\n \n @testset \"#59967: indented code blocks with more than one blank line\" begin"
    }
  ]
}