{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/59843",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/59843/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/59843/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/59843/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/59843",
  "id": 3515554454,
  "node_id": "PR_kwDOABkWpM6twR1u",
  "number": 59843,
  "title": "fix: trigger error hints on exception supertypes too",
  "user": {
    "login": "gdalle",
    "id": 22795598,
    "node_id": "MDQ6VXNlcjIyNzk1NTk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/22795598?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gdalle",
    "html_url": "https://github.com/gdalle",
    "followers_url": "https://api.github.com/users/gdalle/followers",
    "following_url": "https://api.github.com/users/gdalle/following{/other_user}",
    "gists_url": "https://api.github.com/users/gdalle/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gdalle/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gdalle/subscriptions",
    "organizations_url": "https://api.github.com/users/gdalle/orgs",
    "repos_url": "https://api.github.com/users/gdalle/repos",
    "events_url": "https://api.github.com/users/gdalle/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gdalle/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1611077843,
      "node_id": "MDU6TGFiZWwxNjExMDc3ODQz",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/error%20messages",
      "name": "error messages",
      "color": "f0f725",
      "default": false,
      "description": "Better, more actionable error messages"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "DilumAluthge",
    "id": 5619885,
    "node_id": "MDQ6VXNlcjU2MTk4ODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5619885?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DilumAluthge",
    "html_url": "https://github.com/DilumAluthge",
    "followers_url": "https://api.github.com/users/DilumAluthge/followers",
    "following_url": "https://api.github.com/users/DilumAluthge/following{/other_user}",
    "gists_url": "https://api.github.com/users/DilumAluthge/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DilumAluthge/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DilumAluthge/subscriptions",
    "organizations_url": "https://api.github.com/users/DilumAluthge/orgs",
    "repos_url": "https://api.github.com/users/DilumAluthge/repos",
    "events_url": "https://api.github.com/users/DilumAluthge/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DilumAluthge/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "DilumAluthge",
      "id": 5619885,
      "node_id": "MDQ6VXNlcjU2MTk4ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5619885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DilumAluthge",
      "html_url": "https://github.com/DilumAluthge",
      "followers_url": "https://api.github.com/users/DilumAluthge/followers",
      "following_url": "https://api.github.com/users/DilumAluthge/following{/other_user}",
      "gists_url": "https://api.github.com/users/DilumAluthge/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DilumAluthge/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DilumAluthge/subscriptions",
      "organizations_url": "https://api.github.com/users/DilumAluthge/orgs",
      "repos_url": "https://api.github.com/users/DilumAluthge/repos",
      "events_url": "https://api.github.com/users/DilumAluthge/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DilumAluthge/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 24,
  "created_at": "2025-10-14T21:23:24Z",
  "updated_at": "2025-10-21T16:22:22Z",
  "closed_at": "2025-10-21T14:59:04Z",
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/59843",
    "html_url": "https://github.com/JuliaLang/julia/pull/59843",
    "diff_url": "https://github.com/JuliaLang/julia/pull/59843.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/59843.patch",
    "merged_at": "2025-10-21T14:59:04Z"
  },
  "body": "Fixes #58367",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/59843/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/59843/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "f43bdb2800b753141bc7d9e42e993ef04f41360c",
      "filename": "base/experimental.jl",
      "status": "modified",
      "additions": 17,
      "deletions": 12,
      "changes": 29,
      "blob_url": "https://github.com/JuliaLang/julia/blob/655206082f362663228a813bbd73cd8d3b28a4e8/base%2Fexperimental.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/655206082f362663228a813bbd73cd8d3b28a4e8/base%2Fexperimental.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/base%2Fexperimental.jl?ref=655206082f362663228a813bbd73cd8d3b28a4e8",
      "patch": "@@ -295,18 +295,18 @@ Closest candidates are:\n     `if isdefined(Base.Experimental, :register_error_hint) ... end` block.\n \"\"\"\n function register_error_hint(@nospecialize(handler), @nospecialize(exct::Type))\n-    list = get!(Vector{Any}, _hint_handlers, exct)\n-    push!(list, handler)\n+    list = get!(Vector{Any}, _hint_handlers, Core.typename(exct))\n+    push!(list, (exct, handler))\n     return nothing\n end\n \n-const _hint_handlers = IdDict{Type,Vector{Any}}()\n+const _hint_handlers = IdDict{Core.TypeName,Vector{Any}}()\n \n \"\"\"\n     Experimental.show_error_hints(io, ex, args...)\n \n Invoke all handlers from [`Experimental.register_error_hint`](@ref) for the particular\n-exception type `typeof(ex)`. `args` must contain any other arguments expected by\n+exception type `typeof(ex)` and all of its supertypes. `args` must contain any other arguments expected by\n the handler for that type.\n \n !!! compat \"Julia 1.5\"\n@@ -316,15 +316,20 @@ the handler for that type.\n \"\"\"\n function show_error_hints(io, ex, args...)\n     @nospecialize\n-    hinters = get(_hint_handlers, typeof(ex), nothing)\n-    isnothing(hinters) && return\n-    for handler in hinters\n-        try\n-            @invokelatest handler(io, ex, args...)\n-        catch\n-            tn = typeof(handler).name\n-            @error \"Hint-handler $handler for $(typeof(ex)) in $(tn.module) caused an error\" exception=current_exceptions()\n+    ex_supertype = typeof(ex)\n+    while ex_supertype != Any\n+        hinters = get(_hint_handlers, Core.typename(ex_supertype), Any[])\n+        for (exct, handler) in hinters\n+            ex isa exct || continue\n+            try\n+                # TODO: deal with handlers accepting different signatures?\n+                @invokelatest handler(io, ex, args...)\n+            catch\n+                tn = typeof(handler).name\n+                @error \"Hint-handler $handler for $(ex_supertype) in $(tn.module) caused an error\" exception=current_exceptions()\n+            end\n         end\n+        ex_supertype = supertype(ex_supertype)\n     end\n end\n "
    },
    {
      "sha": "941c5e2074f51fc8709cedf680bc69d6d46236d8",
      "filename": "test/errorshow.jl",
      "status": "modified",
      "additions": 37,
      "deletions": 2,
      "changes": 39,
      "blob_url": "https://github.com/JuliaLang/julia/blob/655206082f362663228a813bbd73cd8d3b28a4e8/test%2Ferrorshow.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/655206082f362663228a813bbd73cd8d3b28a4e8/test%2Ferrorshow.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Ferrorshow.jl?ref=655206082f362663228a813bbd73cd8d3b28a4e8",
      "patch": "@@ -740,7 +740,7 @@ let err_str\n     @test occursin(Regex(\"MethodError: no method matching one\\\\(::.*HasNoOne; value::$(Int)\\\\)\"), err_str)\n     @test occursin(\"`one` doesn't take keyword arguments, that would be silly\", err_str)\n end\n-pop!(Base.Experimental._hint_handlers[MethodError])  # order is undefined, don't copy this\n+pop!(Base.Experimental._hint_handlers[Core.typename(MethodError)])  # order is undefined, don't copy this\n \n function busted_hint(io, exc, notarg)  # wrong number of args\n     print(io, \"\\nI don't have a hint for you, sorry\")\n@@ -752,7 +752,7 @@ catch ex\n     io = IOBuffer()\n     @test_logs (:error, \"Hint-handler busted_hint for DomainError in $(@__MODULE__) caused an error\") showerror(io, ex)\n end\n-pop!(Base.Experimental._hint_handlers[DomainError])  # order is undefined, don't copy this\n+pop!(Base.Experimental._hint_handlers[Core.typename(DomainError)])  # order is undefined, don't copy this\n \n struct ANumber <: Number end\n let err_str = @except_str ANumber()(3 + 4) MethodError\n@@ -1476,3 +1476,38 @@ let err_str\n     err_str = @except_str f56325(1,2) MethodError\n     @test occursin(\"The anonymous function\", err_str)\n end\n+\n+# Test that error hints catch abstract exception supertypes (issue #58367)\n+\n+module Hinterland\n+\n+abstract type AbstractHintableException <: Exception end\n+struct ConcreteHintableException <: AbstractHintableException end\n+gonnathrow() = throw(ConcreteHintableException())\n+\n+function Base.showerror(io::IO, exc::ConcreteHintableException)\n+    print(io, \"This is my exception\")\n+    Base.Experimental.show_error_hints(io, exc)\n+end\n+\n+function __init__()\n+    Base.Experimental.register_error_hint(ConcreteHintableException) do io, exc\n+        print(io, \"\\nThis hint caught my concrete exception type\")\n+    end\n+    Base.Experimental.register_error_hint(AbstractHintableException) do io, exc\n+        print(io, \"\\nThis other hint caught my abstract exception supertype\")\n+    end\n+end\n+\n+end\n+\n+@testset \"Hints for abstract exception supertypes\" begin\n+    exc = try\n+        Hinterland.gonnathrow()\n+    catch e\n+        e\n+    end\n+    exc_print = sprint(Base.showerror, exc)\n+    @test occursin(\"This hint caught my concrete exception type\", exc_print)\n+    @test occursin(\"This other hint caught my abstract exception supertype\", exc_print)\n+end"
    }
  ]
}