{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/57937",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/57937/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/57937/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/57937/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/57937",
  "id": 2958162894,
  "node_id": "PR_kwDOABkWpM6QqPF7",
  "number": 57937,
  "title": "Add `Base.active_manifest()`",
  "user": {
    "login": "IanButterworth",
    "id": 1694067,
    "node_id": "MDQ6VXNlcjE2OTQwNjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1694067?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/IanButterworth",
    "html_url": "https://github.com/IanButterworth",
    "followers_url": "https://api.github.com/users/IanButterworth/followers",
    "following_url": "https://api.github.com/users/IanButterworth/following{/other_user}",
    "gists_url": "https://api.github.com/users/IanButterworth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/IanButterworth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/IanButterworth/subscriptions",
    "organizations_url": "https://api.github.com/users/IanButterworth/orgs",
    "repos_url": "https://api.github.com/users/IanButterworth/repos",
    "events_url": "https://api.github.com/users/IanButterworth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/IanButterworth/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 24139877,
      "node_id": "MDU6TGFiZWwyNDEzOTg3Nw==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/packages",
      "name": "packages",
      "color": "D180FB",
      "default": false,
      "description": "Package management and loading"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "DilumAluthge",
    "id": 5619885,
    "node_id": "MDQ6VXNlcjU2MTk4ODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5619885?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DilumAluthge",
    "html_url": "https://github.com/DilumAluthge",
    "followers_url": "https://api.github.com/users/DilumAluthge/followers",
    "following_url": "https://api.github.com/users/DilumAluthge/following{/other_user}",
    "gists_url": "https://api.github.com/users/DilumAluthge/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DilumAluthge/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DilumAluthge/subscriptions",
    "organizations_url": "https://api.github.com/users/DilumAluthge/orgs",
    "repos_url": "https://api.github.com/users/DilumAluthge/repos",
    "events_url": "https://api.github.com/users/DilumAluthge/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DilumAluthge/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "DilumAluthge",
      "id": 5619885,
      "node_id": "MDQ6VXNlcjU2MTk4ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5619885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DilumAluthge",
      "html_url": "https://github.com/DilumAluthge",
      "followers_url": "https://api.github.com/users/DilumAluthge/followers",
      "following_url": "https://api.github.com/users/DilumAluthge/following{/other_user}",
      "gists_url": "https://api.github.com/users/DilumAluthge/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DilumAluthge/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DilumAluthge/subscriptions",
      "organizations_url": "https://api.github.com/users/DilumAluthge/orgs",
      "repos_url": "https://api.github.com/users/DilumAluthge/repos",
      "events_url": "https://api.github.com/users/DilumAluthge/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DilumAluthge/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2025-03-29T15:52:28Z",
  "updated_at": "2025-10-29T22:02:01Z",
  "closed_at": "2025-10-25T05:14:59Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/57937",
    "html_url": "https://github.com/JuliaLang/julia/pull/57937",
    "diff_url": "https://github.com/JuliaLang/julia/pull/57937.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/57937.patch",
    "merged_at": "2025-10-25T05:14:58Z"
  },
  "body": "Closes https://github.com/JuliaLang/julia/issues/57924\r\n\r\n```\r\njulia> Base.active_project()\r\n\"/Users/ian/.julia/environments/v1.13/Project.toml\"\r\n\r\njulia> Base.active_manifest()\r\n\"/Users/ian/.julia/environments/v1.13/Manifest.toml\"\r\n\r\n(@v1.13) pkg> activate --temp\r\n  Activating new project at `/var/folders/1z/jf841bdj73bdj3vk7kc7f_3w0000gn/T/jl_SCVFBB`\r\n\r\njulia> Base.active_project()\r\n\"/var/folders/1z/jf841bdj73bdj3vk7kc7f_3w0000gn/T/jl_SCVFBB/Project.toml\"\r\n\r\njulia> Base.active_manifest()\r\n\r\njulia>\r\n```\r\n\r\nI'm holding off adding tests because I wasn't sure whether that last case should match `active_project` and return a path to a nonexistant file? i.e. the temp `Project.toml` doesn't exist, nor manifest.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/57937/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/57937/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "d2d33e0b32972408eb82940755b33d1750ed7311",
      "filename": "NEWS.md",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/NEWS.md",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/NEWS.md",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/NEWS.md?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -78,6 +78,8 @@ New library features\n * `Base.ScopedValues.LazyScopedValue{T}` is introduced for scoped values that compute their default using a\n   `OncePerProcess{T}` callback, allowing for lazy initialization of the default value. `AbstractScopedValue` is\n   now the abstract base type for both `ScopedValue` and `LazyScopedValue`. ([#59372])\n+* New `Base.active_manifest()` function to return the path of the active manifest, like `Base.active_project()`.\n+  Also can return the manifest that would be used for a given project file ([#57937])\n \n Standard library changes\n ------------------------"
    },
    {
      "sha": "2c9ded9c4033e3d321bdb71682c7b9e820adf3e9",
      "filename": "base/initdefs.jl",
      "status": "modified",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/base%2Finitdefs.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/base%2Finitdefs.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/base%2Finitdefs.jl?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -371,6 +371,27 @@ function set_active_project(projfile::Union{AbstractString,Nothing})\n     end\n end\n \n+\"\"\"\n+    active_manifest()\n+    active_manifest(project_file::AbstractString)\n+\n+Return the path of the active manifest file, or the manifest file that would be used for a given `project_file`.\n+\n+In a stacked environment (where multiple environments exist in the load path), this returns the manifest\n+file for the primary (active) environment only, not the manifests from other environments in the stack.\n+See the manual section on [Environment stacks](@ref) for more details on how stacked environments work.\n+\n+See [`Project environments`](@ref project-environments) for details on the difference between a project and a manifest, and the naming\n+options and their priority in package loading.\n+\n+See also [`Base.active_project`](@ref), [`Base.set_active_project`](@ref).\n+\"\"\"\n+function active_manifest(project_file::Union{AbstractString,Nothing}=nothing; search_load_path::Bool=true)\n+    # If `project_file` was specified, use that, otherwise get the active project:\n+    project_file = !isnothing(project_file) ? project_file : active_project(search_load_path)\n+    project_file === nothing && return nothing\n+    return project_file_manifest_path(project_file)\n+end\n \n \"\"\"\n     load_path()"
    },
    {
      "sha": "1bb00c3d3cbbb3fbd44c40fb93c9639685f15b5f",
      "filename": "base/loading.jl",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/base%2Floading.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/base%2Floading.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/base%2Floading.jl?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -885,6 +885,7 @@ function project_file_manifest_path(project_file::String)::Union{Nothing,String}\n         manifest_path === missing || return manifest_path\n     end\n     dir = abspath(dirname(project_file))\n+    isfile_casesensitive(project_file) || return nothing\n     d = parsed_toml(project_file)\n     base_manifest = workspace_manifest(project_file)\n     if base_manifest !== nothing"
    },
    {
      "sha": "413c8591062409a5cf0333b8625f5e49298eef45",
      "filename": "base/public.jl",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/base%2Fpublic.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/base%2Fpublic.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/base%2Fpublic.jl?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -53,6 +53,7 @@ public\n     DL_LOAD_PATH,\n     load_path,\n     active_project,\n+    active_manifest,\n \n # Reflection and introspection\n     get_extension,"
    },
    {
      "sha": "a59689f4dc4deb68b23eb5ad9fd7400560265d90",
      "filename": "doc/src/base/base.md",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/doc%2Fsrc%2Fbase%2Fbase.md",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/doc%2Fsrc%2Fbase%2Fbase.md",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/doc%2Fsrc%2Fbase%2Fbase.md?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -44,6 +44,7 @@ ans\n err\n Base.active_project\n Base.set_active_project\n+Base.active_manifest\n ```\n \n ## [Keywords](@id Keywords)"
    },
    {
      "sha": "5871530720d227e2d1086da67feca3214f859cb9",
      "filename": "doc/src/manual/code-loading.md",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/doc%2Fsrc%2Fmanual%2Fcode-loading.md",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/doc%2Fsrc%2Fmanual%2Fcode-loading.md",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/doc%2Fsrc%2Fmanual%2Fcode-loading.md?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -64,7 +64,7 @@ Each kind of environment defines these three maps differently, as detailed in th\n !!! note\n     For ease of understanding, the examples throughout this chapter show full data structures for roots, graph and paths. However, Julia's package loading code does not explicitly create these. Instead, it lazily computes only as much of each structure as it needs to load a given package.\n \n-### Project environments\n+### [Project environments](@id project-environments)\n \n A project environment is determined by a directory containing a project file called `Project.toml`, and optionally a manifest file called `Manifest.toml`. These files may also be called `JuliaProject.toml` and `JuliaManifest.toml`, in which case `Project.toml` and `Manifest.toml` are ignored. This allows for coexistence with other tools that might consider files called `Project.toml` and `Manifest.toml` significant. For pure Julia projects, however, the names `Project.toml` and `Manifest.toml` are preferred. However, from Julia v1.10.8 onwards, `(Julia)Manifest-v{major}.{minor}.toml` is recognized as a format to make a given julia version use a specific manifest file i.e. in the same folder, a `Manifest-v1.11.toml` would be used by v1.11 and `Manifest.toml` by any other julia version.\n "
    },
    {
      "sha": "e3487c7050d700e9acaf32988ec43079ebe77e9b",
      "filename": "test/loading.jl",
      "status": "modified",
      "additions": 106,
      "deletions": 0,
      "changes": 106,
      "blob_url": "https://github.com/JuliaLang/julia/blob/923f617720f329b06617f80d7fd4324a852c1240/test%2Floading.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/923f617720f329b06617f80d7fd4324a852c1240/test%2Floading.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Floading.jl?ref=923f617720f329b06617f80d7fd4324a852c1240",
      "patch": "@@ -708,6 +708,112 @@ mktempdir() do dir\n     @test success(cmd)\n end\n \n+function _with_empty_load_path(f::Function)\n+    old_load_path = copy(Base.LOAD_PATH)\n+    try\n+        empty!(Base.LOAD_PATH)\n+        f()\n+    finally\n+        append!(Base.LOAD_PATH, old_load_path)\n+    end\n+end\n+old_act_proj = Base.ACTIVE_PROJECT[]\n+function _with_activate(f::Function, project_file::Union{AbstractString, Nothing})\n+    try\n+        Base.ACTIVE_PROJECT[] = project_file\n+        f()\n+    finally\n+        Base.ACTIVE_PROJECT[] = old_act_proj\n+    end\n+end\n+function _activate_and_get_active_manifest_noarg(project_file::Union{AbstractString, Nothing})\n+    _with_activate(project_file) do\n+        Base.active_manifest()\n+    end\n+end\n+\n+@testset \"Base.active_manifest()\" begin\n+    test_dir = @__DIR__\n+    test_cases = [\n+        (joinpath(test_dir, \"TestPkg\", \"Project.toml\"), joinpath(test_dir, \"TestPkg\", \"Manifest.toml\")),\n+        (joinpath(test_dir, \"project\", \"Project.toml\"), joinpath(test_dir, \"project\", \"Manifest.toml\")),\n+    ]\n+\n+    @testset \"active_manifest() - no argument passed\" begin\n+        for (proj, expected_man) in test_cases\n+            @test _activate_and_get_active_manifest_noarg(proj) == expected_man\n+            # Base.active_manifest() should never return a file that doesn't exist:\n+            @test isfile(_activate_and_get_active_manifest_noarg(proj))\n+        end\n+        mktempdir() do dir\n+            proj = joinpath(dir, \"Project.toml\")\n+\n+            # If the project file doesn't exist, active_manifest() should return `nothing`:\n+            @test _activate_and_get_active_manifest_noarg(proj) === nothing\n+\n+            # If the project file exists but the manifest file does not, active_manifest() should still return `nothing`:\n+            touch(proj)\n+            @test _activate_and_get_active_manifest_noarg(proj) === nothing\n+\n+            # If the project and manifest files both exist, active_manifest() should return the path to the manifest:\n+            manif = joinpath(dir, \"Manifest.toml\")\n+            touch(manif)\n+            @test _activate_and_get_active_manifest_noarg(proj) == manif\n+            # Base.active_manifest() should never return a file that doesn't exist:\n+            @test isfile(_activate_and_get_active_manifest_noarg(proj))\n+\n+            # If the manifest file exists but the project file does not, active_manifest() should return `nothing`:\n+            rm(proj)\n+            @test _activate_and_get_active_manifest_noarg(proj) == nothing\n+        end\n+    end\n+\n+    @testset \"active_manifest(proj::AbstractString)\" begin\n+        Base.ACTIVE_PROJECT[] = old_act_proj\n+        for (proj, expected_man) in test_cases\n+            @test Base.active_manifest(proj) == expected_man\n+            # Base.active_manifest() should never return a file that doesn't exist:\n+            @test isfile(Base.active_manifest(proj))\n+        end\n+        mktempdir() do dir\n+            proj = joinpath(dir, \"Project.toml\")\n+\n+            # If the project file doesn't exist, active_manifest(proj) should return `nothing`:\n+            @test Base.active_manifest(proj) === nothing\n+\n+            # If the project file exists but the manifest file does not, active_manifest(proj) should still return `nothing`:\n+            touch(proj)\n+            @test Base.active_manifest(proj) === nothing\n+\n+            # If the project and manifest files both exist, active_manifest(proj) should return the path to the manifest:\n+            manif = joinpath(dir, \"Manifest.toml\")\n+            touch(manif)\n+            @test Base.active_manifest(proj) == manif\n+            # Base.active_manifest() should never return a file that doesn't exist:\n+            @test isfile(Base.active_manifest(proj))\n+\n+            # If the manifest file exists but the project file does not, active_manifest(proj) should return `nothing`:\n+            rm(proj)\n+            @test Base.active_manifest(proj) === nothing\n+        end\n+    end\n+\n+    @testset \"ACTIVE_PROJECT[] is `nothing` => active_manifest() is nothing\" begin\n+        _with_activate(nothing) do; _with_empty_load_path() do\n+            @test Base.active_manifest() === nothing\n+            @test Base.active_manifest(nothing) === nothing\n+        end; end\n+    end\n+\n+    @testset \"Project file does not exist => active_manifest() is nothing\" begin\n+        mktempdir() do dir\n+            proj = joinpath(dir, \"Project.toml\")\n+            @test Base.active_manifest(proj) === nothing\n+            @test _activate_and_get_active_manifest_noarg(proj) === nothing\n+        end\n+    end\n+end\n+\n @testset \"expansion of JULIA_LOAD_PATH\" begin\n     s = Sys.iswindows() ? ';' : ':'\n     tmp = \"/this/does/not/exist\""
    }
  ]
}