{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60232",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60232/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60232/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60232/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60232",
  "id": 3661093527,
  "node_id": "PR_kwDOABkWpM61UOOf",
  "number": 60232,
  "title": "Use jlutilities mechanism for external package required in test",
  "user": {
    "login": "Keno",
    "id": 1291671,
    "node_id": "MDQ6VXNlcjEyOTE2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1291671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Keno",
    "html_url": "https://github.com/Keno",
    "followers_url": "https://api.github.com/users/Keno/followers",
    "following_url": "https://api.github.com/users/Keno/following{/other_user}",
    "gists_url": "https://api.github.com/users/Keno/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Keno/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Keno/subscriptions",
    "organizations_url": "https://api.github.com/users/Keno/orgs",
    "repos_url": "https://api.github.com/users/Keno/repos",
    "events_url": "https://api.github.com/users/Keno/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Keno/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2025-11-25T01:10:26Z",
  "updated_at": "2025-11-30T11:41:40Z",
  "closed_at": "2025-11-25T08:25:36Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60232",
    "html_url": "https://github.com/JuliaLang/julia/pull/60232",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60232.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60232.patch",
    "merged_at": "2025-11-25T08:25:36Z"
  },
  "body": "Otherwise we try to install the Pkg into the stdlib depot, which corrupts state for Pkg tests. If the test is run manually from `Base.runtests` in a deployed setting, it'll be skipped unless manually installed by the user. This matches how Pkg.jl handles this. After this merges, we should tweak CI to pre-install the packages for both this and the Pkg.jl tests.\r\n\r\nFixes intermittent failures in https://github.com/JuliaLang/julia/pull/60222",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60232/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60232/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "f658a48862d2cb88638041233ad5617f86338039",
      "filename": "Compiler/extras/CompilerDevTools/test/testpkg.jl",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/Compiler%2Fextras%2FCompilerDevTools%2Ftest%2Ftestpkg.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/Compiler%2Fextras%2FCompilerDevTools%2Ftest%2Ftestpkg.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/Compiler%2Fextras%2FCompilerDevTools%2Ftest%2Ftestpkg.jl?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -1,6 +1,5 @@\n using Pkg\n \n Pkg.activate(dirname(@__DIR__)) do\n-  Pkg.instantiate()\n   include(\"runtests.jl\")\n end"
    },
    {
      "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
      "filename": "JuliaLowering/.gitignore",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2F.gitignore",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2F.gitignore",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2F.gitignore?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -1 +0,0 @@\n-/Manifest.toml"
    },
    {
      "sha": "1a5f6860b185c676d936c339f3409124e2a927c4",
      "filename": "JuliaLowering/Manifest.toml",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2FManifest.toml",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2FManifest.toml",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2FManifest.toml?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -0,0 +1,16 @@\n+# This file is machine-generated - editing it directly is not advised\n+\n+julia_version = \"1.14.0-DEV\"\n+manifest_format = \"2.1\"\n+project_hash = \"16f6f8d58c46fe20d68a941bfaddb4590471548a\"\n+\n+[[deps.JuliaLowering]]\n+deps = [\"JuliaSyntax\"]\n+path = \".\"\n+uuid = \"f3c80556-a63f-4383-b822-37d64f81a311\"\n+version = \"1.0.0-DEV\"\n+\n+[[deps.JuliaSyntax]]\n+path = \"../JuliaSyntax\"\n+uuid = \"70703baa-626e-46a2-a12c-08ffd08c73b4\"\n+version = \"2.0.0-DEV\""
    },
    {
      "sha": "77ce44a1bdff5954ecf4d2ef6c4b1e0220849d50",
      "filename": "JuliaLowering/test/runtests_vendored.jl",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2Ftest%2Fruntests_vendored.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/JuliaLowering%2Ftest%2Fruntests_vendored.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fruntests_vendored.jl?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -3,12 +3,6 @@ try\n     # test local (dev) copy of JuliaLowering, not yet vendored into Base\n     Base.set_active_project(joinpath(@__DIR__, \"..\", \"Project.toml\"))\n     manifest_path = joinpath(@__DIR__, \"..\", \"Manifest.toml\")\n-    isfile(manifest_path) && rm(manifest_path)\n-\n-    # activate and instantiate JuliaSyntax as a local package (rather than using\n-    # Base.JuliaSyntax)\n-    import Pkg\n-    Pkg.instantiate()\n \n     # restore error hints (emptied by `testdefs.jl`) so that errors print as\n     # JuliaLowering expects them to"
    },
    {
      "sha": "5b1d6d29db365435b929e8f2d7f06c0a20e45329",
      "filename": "deps/jlutilities/objectfile/Manifest.toml",
      "status": "added",
      "additions": 28,
      "deletions": 0,
      "changes": 28,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/deps%2Fjlutilities%2Fobjectfile%2FManifest.toml",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/deps%2Fjlutilities%2Fobjectfile%2FManifest.toml",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/deps%2Fjlutilities%2Fobjectfile%2FManifest.toml?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -0,0 +1,28 @@\n+# This file is machine-generated - editing it directly is not advised\n+\n+julia_version = \"1.14.0-DEV\"\n+manifest_format = \"2.1\"\n+project_hash = \"23b8253b8eadb7ba5d7489bb56f38819b7150654\"\n+\n+[[deps.ObjectFile]]\n+deps = [\"Reexport\", \"StructIO\"]\n+git-tree-sha1 = \"22faba70c22d2f03e60fbc61da99c4ebfc3eb9ba\"\n+registries = \"General\"\n+uuid = \"d8793406-e978-5875-9003-1fc021f44a92\"\n+version = \"0.5.0\"\n+\n+[[deps.Reexport]]\n+git-tree-sha1 = \"45e428421666073eab6f2da5c9d310d99bb12f9b\"\n+registries = \"General\"\n+uuid = \"189a3867-3050-52da-a836-e630ba90ab69\"\n+version = \"1.2.2\"\n+\n+[[deps.StructIO]]\n+git-tree-sha1 = \"c581be48ae1cbf83e899b14c07a807e1787512cc\"\n+registries = \"General\"\n+uuid = \"53d494c1-5632-5724-8f4c-31dff12d585f\"\n+version = \"0.3.1\"\n+\n+[registries.General]\n+url = \"https://github.com/JuliaRegistries/General.git\"\n+uuid = \"23338594-aafe-5451-b93e-139f81909106\""
    },
    {
      "sha": "acdde4be0965e06563a39180be81f0eba579b035",
      "filename": "deps/jlutilities/objectfile/Project.toml",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/deps%2Fjlutilities%2Fobjectfile%2FProject.toml",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/deps%2Fjlutilities%2Fobjectfile%2FProject.toml",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/deps%2Fjlutilities%2Fobjectfile%2FProject.toml?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -0,0 +1,2 @@\n+[deps]\n+ObjectFile = \"d8793406-e978-5875-9003-1fc021f44a92\""
    },
    {
      "sha": "4c847884939ac7ab0aa302847641f2860c1dd1f2",
      "filename": "test/runtests.jl",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/test%2Fruntests.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/test%2Fruntests.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Fruntests.jl?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -28,6 +28,7 @@ end\n \n const rmwait_timeout = running_under_rr() ? 300 : 30\n \n+ENV[\"JULIA_TEST_BUILDROOT\"] = buildroot\n if use_revise\n     # First put this at the top of the DEPOT PATH to install revise if necessary.\n     # Once it's loaded, we swizzle it to the end, to avoid confusing any tests."
    },
    {
      "sha": "f034c650c75a0e4ecef782a55b481eb83fa048d1",
      "filename": "test/stdlib_dependencies.jl",
      "status": "modified",
      "additions": 31,
      "deletions": 16,
      "changes": 47,
      "blob_url": "https://github.com/JuliaLang/julia/blob/1ba499652c86b11d42c08b042b22613c077662e2/test%2Fstdlib_dependencies.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/1ba499652c86b11d42c08b042b22613c077662e2/test%2Fstdlib_dependencies.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/test%2Fstdlib_dependencies.jl?ref=1ba499652c86b11d42c08b042b22613c077662e2",
      "patch": "@@ -1,14 +1,37 @@\n # This file is a part of Julia. License is MIT: https://julialang.org/license\n \n using Libdl\n-using Pkg\n using Test\n-prev_env = Base.active_project()\n-Pkg.activate(temp=true)\n-Pkg.add(Pkg.PackageSpec(name=\"ObjectFile\", uuid=\"d8793406-e978-5875-9003-1fc021f44a92\", version=\"0.4\"))\n-using ObjectFile\n-try\n \n+# Load ObjectFile.jl from the vendored jlutilities depot\n+buildroot = get(ENV, \"JULIA_TEST_BUILDROOT\", joinpath(@__DIR__, \"..\"))\n+depspath = joinpath(buildroot, \"deps\", \"jlutilities\")\n+if ispath(depspath)\n+    depspath = realpath(depspath)\n+    # With a source-tree use the vendored depot\n+    pushfirst!(DEPOT_PATH, joinpath(depspath, \"depot\"))\n+    using Pkg\n+    old_active_project = Base.active_project()\n+    Base.redirect_stdout(devnull) do\n+        Base.redirect_stderr(devnull) do\n+            Pkg.activate(realpath(joinpath(@__DIR__, \"..\", \"deps\", \"jlutilities\", \"objectfile\")))\n+            Pkg.instantiate()\n+        end\n+    end\n+    using ObjectFile\n+    popfirst!(DEPOT_PATH)\n+    Base.set_active_project(old_active_project)\n+else\n+    # Without a source-tree - expect that the user has installed it for us - warn otherwise\n+    ObjectFile_pkgid = Base.PkgId(Base.UUID(\"d8793406-e978-5875-9003-1fc021f44a92\"), \"ObjectFile\")\n+    if Base.locate_package(ObjectFile_pkgid) !== nothing\n+        @eval using ObjectFile\n+    end\n+end\n+\n+if !@isdefined(ObjectFile)\n+    @warn(\"ObjectFile.jl not available; skipping stdlib JLL dependency tests\")\n+else\n     strip_soversion(lib::AbstractString) = Base.BinaryPlatforms.parse_dl_name_version(lib)[1]\n \n     function get_deps_objectfile_macos(lib_path::String)\n@@ -249,8 +272,8 @@ try\n \n                     # This is a manually-managed special case\n                     if stdlib_name == \"libblastrampoline_jll\" &&\n-                       prop_name == :libblastrampoline &&\n-                       extraneous_deps in ([\"libopenblas64_\"], [\"libopenblas\"])\n+                        prop_name == :libblastrampoline &&\n+                        extraneous_deps in ([\"libopenblas64_\"], [\"libopenblas\"])\n                         deps_mismatch = false\n                     end\n \n@@ -315,12 +338,4 @@ try\n             end\n         end\n     end\n-\n-finally\n-    if prev_env !== nothing\n-        Pkg.activate(prev_env)\n-    else\n-        # If no previous environment, activate the default one\n-        Pkg.activate()\n-    end\n end"
    }
  ]
}