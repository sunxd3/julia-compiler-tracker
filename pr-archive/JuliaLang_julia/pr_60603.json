{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60603",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60603/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60603/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60603/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60603",
  "id": 3794007889,
  "node_id": "PR_kwDOABkWpM68LfSS",
  "number": 60603,
  "title": "Markdown: test different flavors, roundtripping",
  "user": {
    "login": "fingolfin",
    "id": 241512,
    "node_id": "MDQ6VXNlcjI0MTUxMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/241512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fingolfin",
    "html_url": "https://github.com/fingolfin",
    "followers_url": "https://api.github.com/users/fingolfin/followers",
    "following_url": "https://api.github.com/users/fingolfin/following{/other_user}",
    "gists_url": "https://api.github.com/users/fingolfin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fingolfin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fingolfin/subscriptions",
    "organizations_url": "https://api.github.com/users/fingolfin/orgs",
    "repos_url": "https://api.github.com/users/fingolfin/repos",
    "events_url": "https://api.github.com/users/fingolfin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fingolfin/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2317339600,
      "node_id": "MDU6TGFiZWwyMzE3MzM5NjAw",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/markdown",
      "name": "markdown",
      "color": "D914CD",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-01-08T18:51:13Z",
  "updated_at": "2026-01-08T22:20:14Z",
  "closed_at": "2026-01-08T22:20:12Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60603",
    "html_url": "https://github.com/JuliaLang/julia/pull/60603",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60603.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60603.patch",
    "merged_at": "2026-01-08T22:20:12Z"
  },
  "body": "Run CommonMark spec tests against all supported Markdown flavors. This way we may notice regressions in any flavor, not just the default one.\r\n\r\nOf course the different flavors have different success rates (e.g. some CommonMark spec tests fail with the `julia` flavor due to the en/em extension which converse `--` and `---` into en- resp. em-dashes).\r\n\r\nAlso (ab)use the spec tests to automatically derived cheap \"weak\" round trip tests. That is, for some plain text input, we parse it, then convert this into plain text, and parse it again. Then we compared the two parse outputs, which of course should agree.\r\n\r\nThis is weaker than taking the initial plain input, parsing it, converting that to plain text, and comparing the two plain texts. But that kind of test is problematic because Markdown usually has multiple ways to encode things (e.g. three different list marker bullets, two different ways to mark text as italics, etc.). But the weaker version already catches a lot of issues.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60603/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60603/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "9ecfd2c7b956d735c16f0a474dd6495fdd58e532",
      "filename": "stdlib/Markdown/test/regenerate_test_spec.jl",
      "status": "modified",
      "additions": 67,
      "deletions": 14,
      "changes": 81,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a",
      "patch": "@@ -13,9 +13,9 @@ using JSON\n using Test\n using StyledStrings\n \n-function check_commonmark_spec_html1(tst; report::Bool=false)\n+function check_commonmark_spec_html1(tst; report::Bool=false, flavor::Symbol=:julia)\n     input = tst[\"markdown\"]\n-    parsed = Markdown.parse(input)\n+    parsed = Markdown.parse(input; flavor)\n     expected = tst[\"html\"]\n     actual = Markdown.html(parsed)\n     if expected != actual && report\n@@ -30,10 +30,10 @@ function check_commonmark_spec_html1(tst; report::Bool=false)\n     return expected == actual\n end\n \n-function check_commonmark_spec_html(data; report::Bool=false)\n+function check_commonmark_spec_html(data; report::Bool=false, flavor::Symbol=:julia)\n     failed = Int[]\n     for tst in data\n-        check_commonmark_spec_html1(tst; report) || push!(failed, tst[\"example\"])\n+        check_commonmark_spec_html1(tst; report, flavor) || push!(failed, tst[\"example\"])\n     end\n     if report\n         total = length(data)\n@@ -43,6 +43,36 @@ function check_commonmark_spec_html(data; report::Bool=false)\n     return BitSet(failed)\n end\n \n+function check_commonmark_spec_roundtrip1(tst; report::Bool=false, flavor::Symbol=:julia)\n+    input = tst[\"markdown\"]\n+    parsed = Markdown.parse(input; flavor)\n+    new_input = Markdown.plain(parsed)\n+    new_parsed = Markdown.parse(new_input; flavor)\n+    if parsed != new_parsed && report\n+        printstyled(\"============================================\\n\"; color=:cyan)\n+        println(\"failed test \", tst[\"example\"], \":\")\n+        print(\"input:\\n'\"); printstyled(input; color=:bold); println(\"'\")\n+        print(\"parsed:\\n'\"); printstyled(parsed; color=:yellow); println(\"'\")\n+        print(\"new_input:\\n'\"); printstyled(new_input; color=:green); println(\"'\")\n+        print(\"new_parsed:\\n'\"); printstyled(new_parsed; color=:red); println(\"'\")\n+        println()\n+    end\n+    return parsed == new_parsed\n+end\n+\n+function check_commonmark_spec_roundtrip(data; report::Bool=false, flavor::Symbol=:julia)\n+    failed = Int[]\n+    for tst in data\n+        check_commonmark_spec_roundtrip1(tst; report, flavor) || push!(failed, tst[\"example\"])\n+    end\n+    if report\n+        total = length(data)\n+        passed = total - length(failed)\n+        println(\"roundtrip score: $passed/$total = $(passed/total*100)% pass\")\n+    end\n+    return BitSet(failed)\n+end\n+\n function escape_spec_string(s::String)\n     s = Base.escape_string(s)\n     # avoid string interpolation\n@@ -52,14 +82,23 @@ function escape_spec_string(s::String)\n     return s\n end\n \n-function generate_test_file(io::IO, data, broken)\n+function generate_test_file(io::IO, data, mode::Symbol; flavor::Symbol=:julia)\n+    # check all spec tests and record which are broken\n+    if mode == :HTML\n+        broken = check_commonmark_spec_html(data; flavor)\n+    elseif mode == :roundtrip\n+        broken = check_commonmark_spec_roundtrip(data; flavor)\n+    else\n+        error(\"unsupported mode $mode\")\n+    end\n+\n     println(io, \"\"\"\n         # WARNING: this file was generated by $(basename(@__FILE__)), do not edit it directly.\n \n         using Test\n         using Markdown\n \n-        @testset verbose=true \"CommonMark spec test suite\" begin\n+        @testset \"CommonMark spec test suite: $(mode) mode, $(flavor) flavor\" begin\n         \"\"\")\n \n     section = \"\"\n@@ -78,8 +117,17 @@ function generate_test_file(io::IO, data, broken)\n \n         println(io, \"    # Example \", tst[\"example\"])\n         println(io, \"    input = \\\"\", escape_spec_string(tst[\"markdown\"]), \"\\\"\")\n-        println(io, \"    expected = \\\"\", escape_spec_string(tst[\"html\"]), \"\\\"\")\n-        println(io, \"    actual = Markdown.html(Markdown.parse(input))\");\n+        if mode == :HTML\n+            println(io, \"    md = Markdown.parse(input; flavor=:$(flavor))\");\n+            println(io, \"    expected = \\\"\", escape_spec_string(tst[\"html\"]), \"\\\"\")\n+            println(io, \"    actual = Markdown.html(md)\");\n+        elseif mode == :roundtrip\n+            println(io, \"    expected = Markdown.parse(input; flavor=:$(flavor))\");\n+            println(io, \"    new_input = Markdown.Markdown.plain(expected)\");\n+            println(io, \"    actual = Markdown.parse(new_input; flavor=:$(flavor))\");\n+        else\n+            error(\"unsupported mode $mode\")\n+        end\n         if tst[\"example\"] in broken\n             println(io, \"    @test_broken expected == actual\");\n         else\n@@ -93,12 +141,17 @@ function generate_test_file(io::IO, data, broken)\n end\n \n # parse the spec\n-data = JSON.parsefile(joinpath(@__DIR__, \"spec.json\"))\n+commonmark_spec_tests = JSON.parsefile(joinpath(@__DIR__, \"spec.json\"))\n \n-# check all spec tests and record which are broken\n-broken = check_commonmark_spec_html(data)\n+for flavor in [:julia, :github, :common]\n+    # generate output file\n+    open(joinpath(@__DIR__, \"test_spec_html_$(flavor).jl\"), \"w\") do io\n+        generate_test_file(io, commonmark_spec_tests, :HTML; flavor)\n+    end\n+\n+    # generate output file\n+    open(joinpath(@__DIR__, \"test_spec_roundtrip_$(flavor).jl\"), \"w\") do io\n+        generate_test_file(io, commonmark_spec_tests, :roundtrip; flavor)\n+    end\n \n-# generate output file\n-open(joinpath(@__DIR__, \"test_spec.jl\"), \"w\") do io\n-    generate_test_file(io, data, broken)\n end"
    },
    {
      "sha": "204bfeefc09bdf44176b5f13ba70e3be676d2500",
      "filename": "stdlib/Markdown/test/runtests.jl",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fruntests.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a",
      "patch": "@@ -1706,4 +1706,10 @@ end\n     @test typeof.(md) == [Markdown.Header{1}, Markdown.Paragraph, Markdown.List, Markdown.HorizontalRule, Markdown.Paragraph, Markdown.HorizontalRule]\n end\n \n-include(\"test_spec.jl\")\n+include(\"test_spec_roundtrip_common.jl\")\n+include(\"test_spec_roundtrip_github.jl\")\n+include(\"test_spec_roundtrip_julia.jl\")\n+\n+include(\"test_spec_html_common.jl\")\n+include(\"test_spec_html_github.jl\")\n+include(\"test_spec_html_julia.jl\")"
    },
    {
      "sha": "ef39e71f3aadc7ed38d4caf3721139a4e0480e43",
      "filename": "stdlib/Markdown/test/test_spec_html_common.jl",
      "status": "added",
      "additions": 4755,
      "deletions": 0,
      "changes": 4755,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_common.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_common.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_common.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a"
    },
    {
      "sha": "a6953b24c12fd9f13af56052ca2f99e307c1b4bc",
      "filename": "stdlib/Markdown/test/test_spec_html_github.jl",
      "status": "added",
      "additions": 4755,
      "deletions": 0,
      "changes": 4755,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_github.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_github.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_github.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a"
    },
    {
      "sha": "25e745595e2429956d71d7288176a9aaf0c6c63e",
      "filename": "stdlib/Markdown/test/test_spec_html_julia.jl",
      "status": "renamed",
      "additions": 1305,
      "deletions": 653,
      "changes": 1958,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_julia.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_julia.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_html_julia.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a",
      "previous_filename": "stdlib/Markdown/test/test_spec.jl"
    },
    {
      "sha": "081a86848613ad28c44c1bc9005cb55cf777e38f",
      "filename": "stdlib/Markdown/test/test_spec_roundtrip_common.jl",
      "status": "added",
      "additions": 4755,
      "deletions": 0,
      "changes": 4755,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_common.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_common.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_common.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a"
    },
    {
      "sha": "34cc11a1a7fa8cf673696e13e814d41f4dc6f338",
      "filename": "stdlib/Markdown/test/test_spec_roundtrip_github.jl",
      "status": "added",
      "additions": 4755,
      "deletions": 0,
      "changes": 4755,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_github.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_github.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_github.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a"
    },
    {
      "sha": "6a64565c83c54e3b32a1339a8b01dfbda920f4e4",
      "filename": "stdlib/Markdown/test/test_spec_roundtrip_julia.jl",
      "status": "added",
      "additions": 4755,
      "deletions": 0,
      "changes": 4755,
      "blob_url": "https://github.com/JuliaLang/julia/blob/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_julia.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/54da2b6f4e664e16e2dc3fee7f9b38670692fa4a/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_julia.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec_roundtrip_julia.jl?ref=54da2b6f4e664e16e2dc3fee7f9b38670692fa4a"
    }
  ]
}