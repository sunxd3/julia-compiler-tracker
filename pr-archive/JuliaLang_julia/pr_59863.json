{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/59863",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/59863/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/59863/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/59863/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/59863",
  "id": 3521020880,
  "node_id": "PR_kwDOABkWpM6uCoBC",
  "number": 59863,
  "title": "loading: Try to clean up extension loading a bit",
  "user": {
    "login": "Keno",
    "id": 1291671,
    "node_id": "MDQ6VXNlcjEyOTE2NzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1291671?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Keno",
    "html_url": "https://github.com/Keno",
    "followers_url": "https://api.github.com/users/Keno/followers",
    "following_url": "https://api.github.com/users/Keno/following{/other_user}",
    "gists_url": "https://api.github.com/users/Keno/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Keno/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Keno/subscriptions",
    "organizations_url": "https://api.github.com/users/Keno/orgs",
    "repos_url": "https://api.github.com/users/Keno/repos",
    "events_url": "https://api.github.com/users/Keno/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Keno/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 24139877,
      "node_id": "MDU6TGFiZWwyNDEzOTg3Nw==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/packages",
      "name": "packages",
      "color": "D180FB",
      "default": false,
      "description": "Package management and loading"
    },
    {
      "id": 5811602268,
      "node_id": "LA_kwDOABkWpM8AAAABWmYDXA",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/package%20extensions",
      "name": "package extensions",
      "color": "c5def5",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2025-10-16T09:16:23Z",
  "updated_at": "2025-10-23T17:06:50Z",
  "closed_at": "2025-10-23T17:06:48Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/59863",
    "html_url": "https://github.com/JuliaLang/julia/pull/59863",
    "diff_url": "https://github.com/JuliaLang/julia/pull/59863.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/59863.patch",
    "merged_at": "2025-10-23T17:06:48Z"
  },
  "body": "The loading code is overall a bit messy. I'd like to add some new features to it, but I think before I can sensibly do that, some cleanup is required. This attempts to de-deduplicate the several places where extensions deal with weakdeps. The logic for extension loading weakdeps is present multiple times because we support loading extension:\r\n\r\n1. By looking at the [extensions] section of the currently active Project.toml (for loading extensions of the currently active top level project)\r\n\r\n2. By looking at the [extensions] sub-section of the top-level Manifest.toml (for any extension of a non-toplevel package); and\r\n\r\n3. Like 1, except that rather than the env specifying a toplevel Project.toml, it specifies a directory and we search the second level for a Project.toml.\r\n\r\nThis separation is a sensible resolution to the tradeoff of not wanting to scan all package's `Project.toml`s at load time while also not forcing a `resolve` for changes to the top-level Project.toml.\r\n\r\nUnfortunately, the loading behavior in case 1 currently differs from the loading behavior of case 2 and 3. In case 1, an extension is allowed to load any weakdep, in cases 2/3, it's only allowed to load weakdeps that are also extension triggers. I believe that the missing extra check for this restriction in case 1 is an oversight.\r\n\r\nSo, this refactors all that by adding the check to case 1 and mostly deleting the code for case 3, by just putting the project-file-lookup code inline at the start of case 1.\r\n\r\nAdditionally, I've factored out common queries into utility functions, even when the code itself is simple. The idea is to signal that these are the same data structure even if they appear in different places (Project vs Manifest).\r\n\r\nLastly, this makes the following additional behavior changes that I don't expect to be observable:\r\n\r\nIn case 2, when loading a non-extension-trigger, don't restart the search from scratch. The only case in which I could see this causing an observable behavior difference is if there are multiple versions of the package in the load path and for some reason the highest priority one doesn't have the extension (but then how did you load it in the first place??). However, even in that case, I think the new behavior is better, because it would get the dep of the version that *did* declare the extension.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/59863/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/59863/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0
}