{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60555",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60555/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60555/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60555/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60555",
  "id": 3782741770,
  "node_id": "PR_kwDOABkWpM67mQaS",
  "number": 60555,
  "title": "Markdown: use CommonMark spec tests",
  "user": {
    "login": "fingolfin",
    "id": 241512,
    "node_id": "MDQ6VXNlcjI0MTUxMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/241512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fingolfin",
    "html_url": "https://github.com/fingolfin",
    "followers_url": "https://api.github.com/users/fingolfin/followers",
    "following_url": "https://api.github.com/users/fingolfin/following{/other_user}",
    "gists_url": "https://api.github.com/users/fingolfin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fingolfin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fingolfin/subscriptions",
    "organizations_url": "https://api.github.com/users/fingolfin/orgs",
    "repos_url": "https://api.github.com/users/fingolfin/repos",
    "events_url": "https://api.github.com/users/fingolfin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fingolfin/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 10466303,
      "node_id": "MDU6TGFiZWwxMDQ2NjMwMw==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/test",
      "name": "test",
      "color": "e102d8",
      "default": false,
      "description": "This change adds or pertains to unit tests"
    },
    {
      "id": 2317339600,
      "node_id": "MDU6TGFiZWwyMzE3MzM5NjAw",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/markdown",
      "name": "markdown",
      "color": "D914CD",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2026-01-05T20:15:13Z",
  "updated_at": "2026-01-06T13:07:36Z",
  "closed_at": "2026-01-06T13:07:34Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60555",
    "html_url": "https://github.com/JuliaLang/julia/pull/60555",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60555.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60555.patch",
    "merged_at": "2026-01-06T13:07:34Z"
  },
  "body": "Use the CommonMark spec tests from<https://spec.commonmark.org> to generate unit tests. This gives us a slew of good tests for almost free, and is a nice way for tracking progress. Right now the \"score\" is 128 pass, 524 fail:\r\n```\r\nTest Summary:                             | Pass  Broken  Total  Time\r\nCommonMark spec test suite                |  128     524    652  0.0s\r\n  Tabs                                    |    1      10     11  0.0s\r\n  Backslash escapes                       |    2      11     13  0.0s\r\n  Entity and numeric character references |    3      14     17  0.0s\r\n  Precedence                              |            1      1  0.0s\r\n  Thematic breaks                         |    4      15     19  0.0s\r\n  ATX headings                            |   15       3     18  0.0s\r\n  Setext headings                         |   10      17     27  0.0s\r\n  Indented code blocks                    |           12     12  0.0s\r\n  Fenced code blocks                      |    2      27     29  0.0s\r\n  HTML blocks                             |           44     44  0.0s\r\n  Link reference definitions              |           27     27  0.0s\r\n  Paragraphs                              |    2       6      8  0.0s\r\n  Blank lines                             |    1              1  0.0s\r\n  Block quotes                            |   10      15     25  0.0s\r\n  List items                              |    4      44     48  0.0s\r\n  Lists                                   |           26     26  0.0s\r\n  Inlines                                 |            1      1  0.0s\r\n  Code spans                              |    2      20     22  0.0s\r\n  Emphasis and strong emphasis            |   47      85    132  0.0s\r\n  Links                                   |    7      83     90  0.0s\r\n  Images                                  |    2      20     22  0.0s\r\n  Autolinks                               |   10       9     19  0.0s\r\n  Raw HTML                                |    1      19     20  0.0s\r\n  Hard line breaks                        |    3      12     15  0.0s\r\n  Soft line breaks                        |            2      2  0.0s\r\n  Textual content                         |    2       1      3  0.0s\r\n```\r\nTo be clear, the goal is not necessarily to pass *all* of these, as we may wish to deliberately deviate from some of the decisions made for CommonMark (either because we disagree with them, or because changing it would break too many assumptions made by existing code using Markdown.jl). Also, some test fail due to extensions the Julia flavor of Markdown has (e.g en/em dash handling), though that could be handled by adding a CommonMark flavor in the future.",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60555/reactions",
    "total_count": 2,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 2,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60555/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "b92a75868bc37a5a7a54e7fe2d8ccb912d61bf8a",
      "filename": "stdlib/Markdown/test/regenerate_test_spec.jl",
      "status": "added",
      "additions": 104,
      "deletions": 0,
      "changes": 104,
      "blob_url": "https://github.com/JuliaLang/julia/blob/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fregenerate_test_spec.jl?ref=07887985b57ed458dbb144c505e8d65f836f9b21",
      "patch": "@@ -0,0 +1,104 @@\n+# Parse the CommonMark spec tests in spec.json (which come from\n+# https://spec.commonmark.org/0.31.2/spec.json) and check the Markdown\n+# stdlib against it. Also regenerate the test_spec.jl file from\n+# this, to be used in regression tests.\n+#\n+# There are two main reasons to run this script:\n+# 1. to adjust the tests after a change to the Markdown test suite\n+# 2. after updating spec.json\n+#\n+\n+using Markdown\n+using JSON\n+using Test\n+using StyledStrings\n+\n+function check_commonmark_spec_html1(tst; report::Bool=false)\n+    input = tst[\"markdown\"]\n+    parsed = Markdown.parse(input)\n+    expected = tst[\"html\"]\n+    actual = Markdown.html(parsed)\n+    if expected != actual && report\n+        printstyled(\"============================================\\n\"; color=:cyan)\n+        println(\"failed test \", tst[\"example\"], \":\")\n+        print(\"input:\\n'\"); printstyled(input; color=:bold); println(\"'\")\n+        print(\"parsed:\\n'\"); printstyled(parsed; color=:yellow); println(\"'\")\n+        print(\"expected HTML:\\n'\"); printstyled(expected; color=:green); println(\"'\")\n+        print(\"actual HTML:\\n'\"); printstyled(actual; color=:red); println(\"'\")\n+        println()\n+    end\n+    return expected == actual\n+end\n+\n+function check_commonmark_spec_html(data; report::Bool=false)\n+    failed = Int[]\n+    for tst in data\n+        check_commonmark_spec_html1(tst; report) || push!(failed, tst[\"example\"])\n+    end\n+    if report\n+        total = length(data)\n+        passed = total - length(failed)\n+        println(\"HTML score: $passed/$total = $(passed/total*100)% pass\")\n+    end\n+    return BitSet(failed)\n+end\n+\n+function escape_spec_string(s::String)\n+    s = Base.escape_string(s)\n+    # avoid string interpolation\n+    s = replace(s, \"\\$\" => raw\"\\$\")\n+    # encode non-breaking whitespace to make contrib/check-whitespace.jl happy\n+    s = replace(s, \"\\uA0\" => raw\"\\uA0\")\n+    return s\n+end\n+\n+function generate_test_file(io::IO, data, broken)\n+    println(io, \"\"\"\n+        # WARNING: this file was generated by $(basename(@__FILE__)), do not edit it directly.\n+\n+        using Test\n+        using Markdown\n+\n+        @testset verbose=true \"CommonMark spec test suite\" begin\n+        \"\"\")\n+\n+    section = \"\"\n+    for tst in data\n+        if section != tst[\"section\"]\n+            section != \"\" && println(io, \"end\")  # end testset\n+            section = tst[\"section\"]\n+            println(io)\n+            println(io, \"\"\"\n+                #\n+                # $section\n+                #\n+                @testset \"$section\" begin\n+                \"\"\")\n+        end\n+\n+        println(io, \"    # Example \", tst[\"example\"])\n+        println(io, \"    input = \\\"\", escape_spec_string(tst[\"markdown\"]), \"\\\"\")\n+        println(io, \"    expected = \\\"\", escape_spec_string(tst[\"html\"]), \"\\\"\")\n+        println(io, \"    actual = Markdown.html(Markdown.parse(input))\");\n+        if tst[\"example\"] in broken\n+            println(io, \"    @test_broken expected == actual\");\n+        else\n+            println(io, \"    @test expected == actual\");\n+        end\n+        println(io)\n+    end\n+    section != \"\" && println(io, \"end\")  # end testset\n+    println(io)\n+    println(io, \"end\")\n+end\n+\n+# parse the spec\n+data = JSON.parsefile(joinpath(@__DIR__, \"spec.json\"))\n+\n+# check all spec tests and record which are broken\n+broken = check_commonmark_spec_html(data)\n+\n+# generate output file\n+open(joinpath(@__DIR__, \"test_spec.jl\"), \"w\") do io\n+    generate_test_file(io, data, broken)\n+end"
    },
    {
      "sha": "0768eb73924d724f6653312783aecc17ddc6ca0d",
      "filename": "stdlib/Markdown/test/runtests.jl",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/JuliaLang/julia/blob/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fruntests.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fruntests.jl?ref=07887985b57ed458dbb144c505e8d65f836f9b21",
      "patch": "@@ -1586,3 +1586,5 @@ end\n     actual = sprint(show, MIME(\"text/plain\"), m)\n     @test expected == actual\n end\n+\n+include(\"test_spec.jl\")"
    },
    {
      "sha": "1f89e66f2ada1fb77c32ced2376f04afcab88b92",
      "filename": "stdlib/Markdown/test/spec.json",
      "status": "added",
      "additions": 5218,
      "deletions": 0,
      "changes": 5218,
      "blob_url": "https://github.com/JuliaLang/julia/blob/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fspec.json",
      "raw_url": "https://github.com/JuliaLang/julia/raw/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Fspec.json",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Fspec.json?ref=07887985b57ed458dbb144c505e8d65f836f9b21"
    },
    {
      "sha": "9206766e0e6b8dba38af0c94bfa6393a28587a7e",
      "filename": "stdlib/Markdown/test/test_spec.jl",
      "status": "added",
      "additions": 4103,
      "deletions": 0,
      "changes": 4103,
      "blob_url": "https://github.com/JuliaLang/julia/blob/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Ftest_spec.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/07887985b57ed458dbb144c505e8d65f836f9b21/stdlib%2FMarkdown%2Ftest%2Ftest_spec.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FMarkdown%2Ftest%2Ftest_spec.jl?ref=07887985b57ed458dbb144c505e8d65f836f9b21"
    }
  ]
}