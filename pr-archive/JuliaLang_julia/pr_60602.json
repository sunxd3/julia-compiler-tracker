{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60602",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60602/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60602/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60602/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60602",
  "id": 3793154739,
  "node_id": "PR_kwDOABkWpM68IoHp",
  "number": 60602,
  "title": "[JuliaLowering] Fix-up always-defined check in `is_valid_body_ir_argument`",
  "user": {
    "login": "topolarity",
    "id": 84105208,
    "node_id": "MDQ6VXNlcjg0MTA1MjA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/84105208?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/topolarity",
    "html_url": "https://github.com/topolarity",
    "followers_url": "https://api.github.com/users/topolarity/followers",
    "following_url": "https://api.github.com/users/topolarity/following{/other_user}",
    "gists_url": "https://api.github.com/users/topolarity/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/topolarity/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/topolarity/subscriptions",
    "organizations_url": "https://api.github.com/users/topolarity/orgs",
    "repos_url": "https://api.github.com/users/topolarity/repos",
    "events_url": "https://api.github.com/users/topolarity/events{/privacy}",
    "received_events_url": "https://api.github.com/users/topolarity/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2026-01-08T14:37:00Z",
  "updated_at": "2026-01-12T14:22:36Z",
  "closed_at": "2026-01-08T18:52:49Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60602",
    "html_url": "https://github.com/JuliaLang/julia/pull/60602",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60602.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60602.patch",
    "merged_at": "2026-01-08T18:52:49Z"
  },
  "body": "I think this was slightly mis-translated from the flisp side:\r\n```scheme\r\n    (define (valid-body-ir-argument? aval)\r\n      (or (valid-ir-argument? aval)\r\n          (and (symbol? aval) ; Arguments are always defined slots\r\n               (or (memq aval (lam:args lam))\r\n                   (let ((vi (get vinfo-table aval #f)))\r\n                     (and vi (vinfo:never-undef vi)))))))\r\n```\r\n\r\nNoticed in https://github.com/JuliaLang/julia/pull/60567#discussion_r2672556146",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60602/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60602/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "b698cd3592c38ebfc3b79c68155a566950fa7128",
      "filename": "JuliaLowering/src/linear_ir.jl",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Fsrc%2Flinear_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Fsrc%2Flinear_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Fsrc%2Flinear_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -103,7 +103,10 @@ function is_valid_body_ir_argument(ctx, ex)\n         true\n     elseif kind(ex) == K\"BindingId\"\n         binfo = get_binding(ctx, ex)\n-        binfo.kind == :argument && binfo.is_always_defined\n+        # arguments are inherently always-defined, but the closure\n+        # box analysis overrides this flag to mean \"valid to leave\n+        # unboxed\" so we check for them specifically here\n+        binfo.kind == :argument || binfo.is_always_defined\n     else\n         false\n     end"
    },
    {
      "sha": "0ddedb2764b19583af8ca6bc252274384096c1b6",
      "filename": "JuliaLowering/test/assignments_ir.jl",
      "status": "modified",
      "additions": 20,
      "deletions": 28,
      "changes": 48,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fassignments_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fassignments_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fassignments_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -100,17 +100,15 @@ end\n 3   (call %\u2082)\n 4   TestMod.T\n 5   (= slot\u2082/tmp %\u2083)\n-6   slot\u2082/tmp\n-7   (call core.isa %\u2086 %\u2084)\n-8   (gotoifnot %\u2087 label\u2081\u2080)\n-9   (goto label\u2081\u2083)\n-10  slot\u2082/tmp\n-11  (call top.convert %\u2084 %\u2081\u2080)\n-12  (= slot\u2082/tmp (call core.typeassert %\u2081\u2081 %\u2084))\n-13  slot\u2082/tmp\n-14  (= slot\u2081/x %\u2081\u2083)\n-15  slot\u2081/x\n-16  (return %\u2081\u2085)\n+6   (call core.isa slot\u2082/tmp %\u2084)\n+7   (gotoifnot %\u2086 label\u2089)\n+8   (goto label\u2081\u2081)\n+9   (call top.convert %\u2084 slot\u2082/tmp)\n+10  (= slot\u2082/tmp (call core.typeassert %\u2089 %\u2084))\n+11  slot\u2082/tmp\n+12  (= slot\u2081/x %\u2081\u2081)\n+13  slot\u2081/x\n+14  (return %\u2081\u2083)\n \n ########################################\n # \"complex lhs\" of `::T` => type-assert, not decl\n@@ -136,15 +134,12 @@ X{T} = Y{T,T}\n #---------------------\n 1   (call core.TypeVar :T)\n 2   (= slot\u2081/T %\u2081)\n-3   slot\u2081/T\n-4   TestMod.Y\n-5   slot\u2081/T\n-6   slot\u2081/T\n-7   (call core.apply_type %\u2084 %\u2085 %\u2086)\n-8   (call core.UnionAll %\u2083 %\u2087)\n-9   (call core.declare_const TestMod :X %\u2088)\n-10  latestworld\n-11  (return %\u2088)\n+3   TestMod.Y\n+4   (call core.apply_type %\u2083 slot\u2081/T slot\u2081/T)\n+5   (call core.UnionAll slot\u2081/T %\u2084)\n+6   (call core.declare_const TestMod :X %\u2085)\n+7   latestworld\n+8   (return %\u2085)\n \n ########################################\n # UnionAll expansion in local scope\n@@ -154,14 +149,11 @@ end\n #---------------------\n 1   (call core.TypeVar :T)\n 2   (= slot\u2082/T %\u2081)\n-3   slot\u2082/T\n-4   TestMod.Y\n-5   slot\u2082/T\n-6   slot\u2082/T\n-7   (call core.apply_type %\u2084 %\u2085 %\u2086)\n-8   (call core.UnionAll %\u2083 %\u2087)\n-9   (= slot\u2081/X %\u2088)\n-10  (return %\u2088)\n+3   TestMod.Y\n+4   (call core.apply_type %\u2083 slot\u2082/T slot\u2082/T)\n+5   (call core.UnionAll slot\u2082/T %\u2084)\n+6   (= slot\u2081/X %\u2085)\n+7   (return %\u2085)\n \n ########################################\n # Error: Invalid lhs in `=`"
    },
    {
      "sha": "7b4b4d62afa485c2c7675aa5540bfc9dfa54ee52",
      "filename": "JuliaLowering/test/closures_ir.jl",
      "status": "modified",
      "additions": 62,
      "deletions": 68,
      "changes": 130,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fclosures_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fclosures_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fclosures_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -480,12 +480,11 @@ end\n #---------------------\n 1   1\n 2   (= slot\u2081/y (call core.Box))\n-3   slot\u2081/y\n-4   (call core.setfield! %\u2083 :contents %\u2081)\n-5   TestMod.T\n-6   (call core.apply_type core.Tuple core.Any %\u2085)\n-7   (call core.apply_type core.Union)\n-8   --- opaque_closure_method  core.nothing 2 false SourceLocation::2:31\n+3   (call core.setfield! slot\u2081/y :contents %\u2081)\n+4   TestMod.T\n+5   (call core.apply_type core.Tuple core.Any %\u2084)\n+6   (call core.apply_type core.Union)\n+7   --- opaque_closure_method  core.nothing 2 false SourceLocation::2:31\n     slots: [slot\u2081/#self#(!read) slot\u2082/x slot\u2083/z slot\u2084/y(!read,maybe_undef)]\n     1   TestMod.-\n     2   TestMod.+\n@@ -501,9 +500,8 @@ end\n     12  (call %\u2082 %\u2084 %\u2081\u2081)\n     13  (call %\u2081 %\u2081\u2082 slot\u2083/z)\n     14  (return %\u2081\u2083)\n-9   slot\u2081/y\n-10  (new_opaque_closure %\u2086 %\u2087 core.Any true %\u2088 %\u2089)\n-11  (return %\u2081\u2080)\n+8   (new_opaque_closure %\u2085 %\u2086 core.Any true %\u2087 slot\u2081/y)\n+9   (return %\u2088)\n \n ########################################\n # Opaque closure with `...`\n@@ -614,33 +612,31 @@ end\n 1   TestMod.y_init\n 2   (= slot\u2081/y (call core.Box))\n 3   (= slot\u2082/#f_kw_closure#0 (call core.Box))\n-4   slot\u2081/y\n-5   (call core.setfield! %\u2084 :contents %\u2081)\n-6   (call core.svec :#f_kw_closure#0)\n-7   (call core.svec true)\n-8   (call JuliaLowering.eval_closure_type TestMod :#f_kw_closure##0 %\u2086 %\u2087)\n-9   latestworld\n-10  TestMod.#f_kw_closure##0\n-11  slot\u2082/#f_kw_closure#0\n-12  (new %\u2081\u2080 %\u2081\u2081)\n-13  (= slot\u2083/f_kw_closure %\u2081\u2082)\n-14  (call core.svec :y)\n-15  (call core.svec true)\n-16  (call JuliaLowering.eval_closure_type TestMod :##f_kw_closure#0##0 %\u2081\u2084 %\u2081\u2085)\n-17  latestworld\n-18  TestMod.##f_kw_closure#0##0\n-19  slot\u2081/y\n-20  (new %\u2081\u2088 %\u2081\u2089)\n-21  slot\u2082/#f_kw_closure#0\n-22  (call core.setfield! %\u2082\u2081 :contents %\u2082\u2080)\n-23  TestMod.##f_kw_closure#0##0\n-24  TestMod.X\n-25  TestMod.#f_kw_closure##0\n-26  (call core.svec %\u2082\u2083 %\u2082\u2084 %\u2082\u2085)\n-27  (call core.svec)\n-28  SourceLocation::2:14\n-29  (call core.svec %\u2082\u2086 %\u2082\u2087 %\u2082\u2088)\n-30  --- method core.nothing %\u2082\u2089\n+4   (call core.setfield! slot\u2081/y :contents %\u2081)\n+5   (call core.svec :#f_kw_closure#0)\n+6   (call core.svec true)\n+7   (call JuliaLowering.eval_closure_type TestMod :#f_kw_closure##0 %\u2085 %\u2086)\n+8   latestworld\n+9   TestMod.#f_kw_closure##0\n+10  slot\u2082/#f_kw_closure#0\n+11  (new %\u2089 %\u2081\u2080)\n+12  (= slot\u2083/f_kw_closure %\u2081\u2081)\n+13  (call core.svec :y)\n+14  (call core.svec true)\n+15  (call JuliaLowering.eval_closure_type TestMod :##f_kw_closure#0##0 %\u2081\u2083 %\u2081\u2084)\n+16  latestworld\n+17  TestMod.##f_kw_closure#0##0\n+18  (new %\u2081\u2087 slot\u2081/y)\n+19  slot\u2082/#f_kw_closure#0\n+20  (call core.setfield! %\u2081\u2089 :contents %\u2081\u2088)\n+21  TestMod.##f_kw_closure#0##0\n+22  TestMod.X\n+23  TestMod.#f_kw_closure##0\n+24  (call core.svec %\u2082\u2081 %\u2082\u2082 %\u2082\u2083)\n+25  (call core.svec)\n+26  SourceLocation::2:14\n+27  (call core.svec %\u2082\u2084 %\u2082\u2085 %\u2082\u2086)\n+28  --- method core.nothing %\u2082\u2087\n     slots: [slot\u2081/#self#(!read) slot\u2082/x slot\u2083/#self# slot\u2084/y(!read,maybe_undef)]\n     1   (meta :nkw 1)\n     2   TestMod.+\n@@ -653,14 +649,14 @@ end\n     9   (call core.getfield %\u2083 :contents)\n     10  (call %\u2082 slot\u2082/x %\u2089)\n     11  (return %\u2081\u2080)\n-31  latestworld\n-32  (call core.typeof core.kwcall)\n-33  TestMod.#f_kw_closure##0\n-34  (call core.svec %\u2083\u2082 core.NamedTuple %\u2083\u2083)\n-35  (call core.svec)\n-36  SourceLocation::2:14\n-37  (call core.svec %\u2083\u2084 %\u2083\u2085 %\u2083\u2086)\n-38  --- code_info\n+29  latestworld\n+30  (call core.typeof core.kwcall)\n+31  TestMod.#f_kw_closure##0\n+32  (call core.svec %\u2083\u2080 core.NamedTuple %\u2083\u2081)\n+33  (call core.svec)\n+34  SourceLocation::2:14\n+35  (call core.svec %\u2083\u2082 %\u2083\u2083 %\u2083\u2084)\n+36  --- code_info\n     slots: [slot\u2081/#self#(!read) slot\u2082/kws slot\u2083/#self# slot\u2084/kwtmp slot\u2085/x(!read) slot\u2086/#f_kw_closure#0(!read,maybe_undef)]\n     1   (newvar slot\u2085/x)\n     2   (call core.isdefined slot\u2082/kws :x)\n@@ -694,17 +690,17 @@ end\n     30  (call core.getfield %\u2082\u2084 :contents)\n     31  (call %\u2083\u2080 %\u2081\u2086 slot\u2083/#self#)\n     32  (return %\u2083\u2081)\n-39  slot\u2082/#f_kw_closure#0\n-40  (call core.svec %\u2083\u2089)\n-41  (call JuliaLowering.replace_captured_locals! %\u2083\u2088 %\u2084\u2080)\n-42  --- method core.nothing %\u2083\u2087 %\u2084\u2081\n-43  latestworld\n-44  TestMod.#f_kw_closure##0\n-45  (call core.svec %\u2084\u2084)\n-46  (call core.svec)\n-47  SourceLocation::2:14\n-48  (call core.svec %\u2084\u2085 %\u2084\u2086 %\u2084\u2087)\n-49  --- method core.nothing %\u2084\u2088\n+37  slot\u2082/#f_kw_closure#0\n+38  (call core.svec %\u2083\u2087)\n+39  (call JuliaLowering.replace_captured_locals! %\u2083\u2086 %\u2083\u2088)\n+40  --- method core.nothing %\u2083\u2085 %\u2083\u2089\n+41  latestworld\n+42  TestMod.#f_kw_closure##0\n+43  (call core.svec %\u2084\u2082)\n+44  (call core.svec)\n+45  SourceLocation::2:14\n+46  (call core.svec %\u2084\u2083 %\u2084\u2084 %\u2084\u2085)\n+47  --- method core.nothing %\u2084\u2086\n     slots: [slot\u2081/#self# slot\u2082/#f_kw_closure#0(!read,maybe_undef)]\n     1   (call core.getfield slot\u2081/#self# :#f_kw_closure#0)\n     2   (call core.isdefined %\u2081 :contents)\n@@ -716,9 +712,9 @@ end\n     8   TestMod.x_default\n     9   (call %\u2087 %\u2088 slot\u2081/#self#)\n     10  (return %\u2089)\n-50  latestworld\n-51  slot\u2083/f_kw_closure\n-52  (return %\u2085\u2081)\n+48  latestworld\n+49  slot\u2083/f_kw_closure\n+50  (return %\u2084\u2089)\n \n ########################################\n # Closure capturing a typed local must also capture the type expression\n@@ -743,16 +739,14 @@ slots: [slot\u2081/#self#(!read) slot\u2082/T(!read,maybe_undef) slot\u2083/tmp(!read)]\n 8   slot\u2082/T\n 9   (call core.getfield %\u2083 :contents)\n 10  (= slot\u2083/tmp %\u2081)\n-11  slot\u2083/tmp\n-12  (call core.isa %\u2081\u2081 %\u2089)\n-13  (gotoifnot %\u2081\u2082 label\u2081\u2085)\n-14  (goto label\u2081\u2088)\n-15  slot\u2083/tmp\n-16  (call top.convert %\u2089 %\u2081\u2085)\n-17  (= slot\u2083/tmp (call core.typeassert %\u2081\u2086 %\u2089))\n-18  slot\u2083/tmp\n-19  (call core.setfield! %\u2082 :contents %\u2081\u2088)\n-20  (return %\u2081)\n+11  (call core.isa slot\u2083/tmp %\u2089)\n+12  (gotoifnot %\u2081\u2081 label\u2081\u2084)\n+13  (goto label\u2081\u2086)\n+14  (call top.convert %\u2089 slot\u2083/tmp)\n+15  (= slot\u2083/tmp (call core.typeassert %\u2081\u2084 %\u2089))\n+16  slot\u2083/tmp\n+17  (call core.setfield! %\u2082 :contents %\u2081\u2086)\n+18  (return %\u2081)\n \n ########################################\n # Error: Closure outside any top level context"
    },
    {
      "sha": "75a09b5c96cb3cb184dcf16fa4c9afef2b150a3b",
      "filename": "JuliaLowering/test/decls_ir.jl",
      "status": "modified",
      "additions": 64,
      "deletions": 80,
      "changes": 144,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fdecls_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fdecls_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fdecls_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -8,16 +8,14 @@ end\n 2   1\n 3   TestMod.T\n 4   (= slot\u2082/tmp %\u2082)\n-5   slot\u2082/tmp\n-6   (call core.isa %\u2085 %\u2083)\n-7   (gotoifnot %\u2086 label\u2089)\n-8   (goto label\u2081\u2082)\n-9   slot\u2082/tmp\n-10  (call top.convert %\u2083 %\u2089)\n-11  (= slot\u2082/tmp (call core.typeassert %\u2081\u2080 %\u2083))\n-12  slot\u2082/tmp\n-13  (= slot\u2081/x %\u2081\u2082)\n-14  (return %\u2082)\n+5   (call core.isa slot\u2082/tmp %\u2083)\n+6   (gotoifnot %\u2085 label\u2088)\n+7   (goto label\u2081\u2080)\n+8   (call top.convert %\u2083 slot\u2082/tmp)\n+9   (= slot\u2082/tmp (call core.typeassert %\u2088 %\u2083))\n+10  slot\u2082/tmp\n+11  (= slot\u2081/x %\u2081\u2080)\n+12  (return %\u2082)\n \n ########################################\n # Error: Local declarations outside a scope are disallowed\n@@ -102,17 +100,15 @@ const xx::T = 10\n #---------------------\n 1   TestMod.T\n 2   (= slot\u2081/tmp 10)\n-3   slot\u2081/tmp\n-4   (call core.isa %\u2083 %\u2081)\n-5   (gotoifnot %\u2084 label\u2087)\n-6   (goto label\u2081\u2080)\n-7   slot\u2081/tmp\n-8   (call top.convert %\u2081 %\u2087)\n-9   (= slot\u2081/tmp (call core.typeassert %\u2088 %\u2081))\n-10  slot\u2081/tmp\n-11  (call core.declare_const TestMod :xx %\u2081\u2080)\n-12  latestworld\n-13  (return %\u2081\u2080)\n+3   (call core.isa slot\u2081/tmp %\u2081)\n+4   (gotoifnot %\u2083 label\u2086)\n+5   (goto label\u2088)\n+6   (call top.convert %\u2081 slot\u2081/tmp)\n+7   (= slot\u2081/tmp (call core.typeassert %\u2086 %\u2081))\n+8   slot\u2081/tmp\n+9   (call core.declare_const TestMod :xx %\u2088)\n+10  latestworld\n+11  (return %\u2088)\n \n ########################################\n # Const tuple\n@@ -141,27 +137,23 @@ const c0 = v0 = v1 = 123\n 5   latestworld\n 6   (call core.get_binding_type TestMod :v0)\n 7   (= slot\u2081/tmp %\u2081)\n-8   slot\u2081/tmp\n-9   (call core.isa %\u2088 %\u2086)\n-10  (gotoifnot %\u2089 label\u2081\u2082)\n-11  (goto label\u2081\u2084)\n+8   (call core.isa slot\u2081/tmp %\u2086)\n+9   (gotoifnot %\u2088 label\u2081\u2081)\n+10  (goto label\u2081\u2082)\n+11  (= slot\u2081/tmp (call top.convert %\u2086 slot\u2081/tmp))\n 12  slot\u2081/tmp\n-13  (= slot\u2081/tmp (call top.convert %\u2086 %\u2081\u2082))\n-14  slot\u2081/tmp\n-15  (call core.setglobal! TestMod :v0 %\u2081\u2084)\n-16  (call core.declare_global TestMod :v1 true)\n-17  latestworld\n-18  (call core.get_binding_type TestMod :v1)\n-19  (= slot\u2082/tmp %\u2081)\n-20  slot\u2082/tmp\n-21  (call core.isa %\u2082\u2080 %\u2081\u2088)\n-22  (gotoifnot %\u2082\u2081 label\u2082\u2084)\n-23  (goto label\u2082\u2086)\n-24  slot\u2082/tmp\n-25  (= slot\u2082/tmp (call top.convert %\u2081\u2088 %\u2082\u2084))\n-26  slot\u2082/tmp\n-27  (call core.setglobal! TestMod :v1 %\u2082\u2086)\n-28  (return %\u2081)\n+13  (call core.setglobal! TestMod :v0 %\u2081\u2082)\n+14  (call core.declare_global TestMod :v1 true)\n+15  latestworld\n+16  (call core.get_binding_type TestMod :v1)\n+17  (= slot\u2082/tmp %\u2081)\n+18  (call core.isa slot\u2082/tmp %\u2081\u2086)\n+19  (gotoifnot %\u2081\u2088 label\u2082\u2081)\n+20  (goto label\u2082\u2082)\n+21  (= slot\u2082/tmp (call top.convert %\u2081\u2086 slot\u2082/tmp))\n+22  slot\u2082/tmp\n+23  (call core.setglobal! TestMod :v1 %\u2082\u2082)\n+24  (return %\u2081)\n \n ########################################\n # Global assignment\n@@ -171,15 +163,13 @@ xx = 10\n 2   latestworld\n 3   (call core.get_binding_type TestMod :xx)\n 4   (= slot\u2081/tmp 10)\n-5   slot\u2081/tmp\n-6   (call core.isa %\u2085 %\u2083)\n-7   (gotoifnot %\u2086 label\u2089)\n-8   (goto label\u2081\u2081)\n+5   (call core.isa slot\u2081/tmp %\u2083)\n+6   (gotoifnot %\u2085 label\u2088)\n+7   (goto label\u2089)\n+8   (= slot\u2081/tmp (call top.convert %\u2083 slot\u2081/tmp))\n 9   slot\u2081/tmp\n-10  (= slot\u2081/tmp (call top.convert %\u2083 %\u2089))\n-11  slot\u2081/tmp\n-12  (call core.setglobal! TestMod :xx %\u2081\u2081)\n-13  (return 10)\n+10  (call core.setglobal! TestMod :xx %\u2089)\n+11  (return 10)\n \n ########################################\n # Typed global assignment\n@@ -194,15 +184,13 @@ global xx::T = 10\n 7   latestworld\n 8   (call core.get_binding_type TestMod :xx)\n 9   (= slot\u2081/tmp 10)\n-10  slot\u2081/tmp\n-11  (call core.isa %\u2081\u2080 %\u2088)\n-12  (gotoifnot %\u2081\u2081 label\u2081\u2084)\n-13  (goto label\u2081\u2086)\n+10  (call core.isa slot\u2081/tmp %\u2088)\n+11  (gotoifnot %\u2081\u2080 label\u2081\u2083)\n+12  (goto label\u2081\u2084)\n+13  (= slot\u2081/tmp (call top.convert %\u2088 slot\u2081/tmp))\n 14  slot\u2081/tmp\n-15  (= slot\u2081/tmp (call top.convert %\u2088 %\u2081\u2084))\n-16  slot\u2081/tmp\n-17  (call core.setglobal! TestMod :xx %\u2081\u2086)\n-18  (return 10)\n+15  (call core.setglobal! TestMod :xx %\u2081\u2084)\n+16  (return 10)\n \n ########################################\n # Error: x declared twice\n@@ -268,29 +256,25 @@ end\n     2   1\n     3   TestMod.Int\n     4   (= slot\u2083/tmp %\u2082)\n-    5   slot\u2083/tmp\n-    6   (call core.isa %\u2085 %\u2083)\n-    7   (gotoifnot %\u2086 label\u2089)\n-    8   (goto label\u2081\u2082)\n-    9   slot\u2083/tmp\n-    10  (call top.convert %\u2083 %\u2089)\n-    11  (= slot\u2083/tmp (call core.typeassert %\u2081\u2080 %\u2083))\n-    12  slot\u2083/tmp\n-    13  (= slot\u2085/x %\u2081\u2082)\n-    14  2.0\n-    15  TestMod.Int\n-    16  (= slot\u2084/tmp %\u2081\u2084)\n-    17  slot\u2084/tmp\n-    18  (call core.isa %\u2081\u2087 %\u2081\u2085)\n-    19  (gotoifnot %\u2081\u2088 label\u2082\u2081)\n-    20  (goto label\u2082\u2084)\n-    21  slot\u2084/tmp\n-    22  (call top.convert %\u2081\u2085 %\u2082\u2081)\n-    23  (= slot\u2084/tmp (call core.typeassert %\u2082\u2082 %\u2081\u2085))\n-    24  slot\u2084/tmp\n-    25  (= slot\u2085/x %\u2082\u2084)\n-    26  slot\u2085/x\n-    27  (return %\u2082\u2086)\n+    5   (call core.isa slot\u2083/tmp %\u2083)\n+    6   (gotoifnot %\u2085 label\u2088)\n+    7   (goto label\u2081\u2080)\n+    8   (call top.convert %\u2083 slot\u2083/tmp)\n+    9   (= slot\u2083/tmp (call core.typeassert %\u2088 %\u2083))\n+    10  slot\u2083/tmp\n+    11  (= slot\u2085/x %\u2081\u2080)\n+    12  2.0\n+    13  TestMod.Int\n+    14  (= slot\u2084/tmp %\u2081\u2082)\n+    15  (call core.isa slot\u2084/tmp %\u2081\u2083)\n+    16  (gotoifnot %\u2081\u2085 label\u2081\u2088)\n+    17  (goto label\u2082\u2080)\n+    18  (call top.convert %\u2081\u2083 slot\u2084/tmp)\n+    19  (= slot\u2084/tmp (call core.typeassert %\u2081\u2088 %\u2081\u2083))\n+    20  slot\u2084/tmp\n+    21  (= slot\u2085/x %\u2082\u2080)\n+    22  slot\u2085/x\n+    23  (return %\u2082\u2082)\n 10  latestworld\n 11  TestMod.f\n 12  (return %\u2081\u2081)"
    },
    {
      "sha": "bcb753a3369396e154a8cdf8473d55dbddd450fe",
      "filename": "JuliaLowering/test/destructuring_ir.jl",
      "status": "modified",
      "additions": 8,
      "deletions": 10,
      "changes": 18,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fdestructuring_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fdestructuring_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fdestructuring_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -359,16 +359,14 @@ end\n 3   (call top.getproperty %\u2082 :x)\n 4   TestMod.T\n 5   (= slot\u2082/tmp %\u2083)\n-6   slot\u2082/tmp\n-7   (call core.isa %\u2086 %\u2084)\n-8   (gotoifnot %\u2087 label\u2081\u2080)\n-9   (goto label\u2081\u2083)\n-10  slot\u2082/tmp\n-11  (call top.convert %\u2084 %\u2081\u2080)\n-12  (= slot\u2082/tmp (call core.typeassert %\u2081\u2081 %\u2084))\n-13  slot\u2082/tmp\n-14  (= slot\u2081/x %\u2081\u2083)\n-15  (return %\u2082)\n+6   (call core.isa slot\u2082/tmp %\u2084)\n+7   (gotoifnot %\u2086 label\u2089)\n+8   (goto label\u2081\u2081)\n+9   (call top.convert %\u2084 slot\u2082/tmp)\n+10  (= slot\u2082/tmp (call core.typeassert %\u2089 %\u2084))\n+11  slot\u2082/tmp\n+12  (= slot\u2081/x %\u2081\u2081)\n+13  (return %\u2082)\n \n ########################################\n # Error: Property destructuring with frankentuple"
    },
    {
      "sha": "866e602510fb4c68adf54c32c16892c3b26abd19",
      "filename": "JuliaLowering/test/functions_ir.jl",
      "status": "modified",
      "additions": 14,
      "deletions": 18,
      "changes": 32,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Ffunctions_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Ffunctions_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Ffunctions_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -294,15 +294,13 @@ end\n     1   TestMod.Int\n     2   (gotoifnot slot\u2082/x label\u2083)\n     3   (= slot\u2083/tmp 0xff)\n-    4   slot\u2083/tmp\n-    5   (call core.isa %\u2084 %\u2081)\n-    6   (gotoifnot %\u2085 label\u2088)\n-    7   (goto label\u2081\u2081)\n-    8   slot\u2083/tmp\n-    9   (call top.convert %\u2081 %\u2088)\n-    10  (= slot\u2083/tmp (call core.typeassert %\u2089 %\u2081))\n-    11  slot\u2083/tmp\n-    12  (return %\u2081\u2081)\n+    4   (call core.isa slot\u2083/tmp %\u2081)\n+    5   (gotoifnot %\u2084 label\u2087)\n+    6   (goto label\u2089)\n+    7   (call top.convert %\u2081 slot\u2083/tmp)\n+    8   (= slot\u2083/tmp (call core.typeassert %\u2087 %\u2081))\n+    9   slot\u2083/tmp\n+    10  (return %\u2089)\n 10  latestworld\n 11  TestMod.f\n 12  (return %\u2081\u2081)\n@@ -910,15 +908,13 @@ end\n     slots: [slot\u2081/#self#(called) slot\u2082/x(!read) slot\u2083/tmp(!read)]\n     1   TestMod.T\n     2   (= slot\u2083/tmp core.nothing)\n-    3   slot\u2083/tmp\n-    4   (call core.isa %\u2083 %\u2081)\n-    5   (gotoifnot %\u2084 label\u2087)\n-    6   (goto label\u2081\u2080)\n-    7   slot\u2083/tmp\n-    8   (call top.convert %\u2081 %\u2087)\n-    9   (= slot\u2083/tmp (call core.typeassert %\u2088 %\u2081))\n-    10  slot\u2083/tmp\n-    11  (return %\u2081\u2080)\n+    3   (call core.isa slot\u2083/tmp %\u2081)\n+    4   (gotoifnot %\u2083 label\u2086)\n+    5   (goto label\u2088)\n+    6   (call top.convert %\u2081 slot\u2083/tmp)\n+    7   (= slot\u2083/tmp (call core.typeassert %\u2086 %\u2081))\n+    8   slot\u2083/tmp\n+    9   (return %\u2088)\n 18  latestworld\n 19  TestMod.f\n 20  (return %\u2081\u2089)"
    },
    {
      "sha": "cbc07c5fe8661ee450848600857a5e21e2296917",
      "filename": "JuliaLowering/test/generators_ir.jl",
      "status": "modified",
      "additions": 23,
      "deletions": 24,
      "changes": 47,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fgenerators_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fgenerators_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fgenerators_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -260,40 +260,39 @@ T[(x,y) for x in xs, y in ys]\n 11  slot\u2083/next\n 12  (call core.=== %\u2081\u2081 core.nothing)\n 13  (call top.not_int %\u2081\u2082)\n-14  (gotoifnot %\u2081\u2083 label\u2085\u2080)\n+14  (gotoifnot %\u2081\u2083 label\u2084\u2089)\n 15  slot\u2083/next\n 16  (= slot\u2084/y (call core.getfield %\u2081\u2085 1))\n 17  (call core.getfield %\u2081\u2085 2)\n 18  (= slot\u2082/next (call top.iterate %\u2081))\n 19  slot\u2082/next\n 20  (call core.=== %\u2081\u2089 core.nothing)\n 21  (call top.not_int %\u2082\u2080)\n-22  (gotoifnot %\u2082\u2081 label\u2084\u2084)\n+22  (gotoifnot %\u2082\u2081 label\u2084\u2083)\n 23  slot\u2084/y\n 24  (= slot\u2085/y %\u2082\u2083)\n 25  slot\u2082/next\n 26  (= slot\u2086/x (call core.getfield %\u2082\u2085 1))\n 27  (call core.getfield %\u2082\u2085 2)\n 28  slot\u2086/x\n-29  slot\u2085/y\n-30  (call core.tuple %\u2082\u2088 %\u2082\u2089)\n-31  (gotoifnot %\u2085 label\u2083\u2084)\n-32  (call top.push! %\u2087 %\u2083\u2080)\n-33  (goto label\u2083\u2086)\n-34  slot\u2081/idx\n-35  (call top.setindex! %\u2087 %\u2083\u2080 %\u2083\u2084)\n-36  slot\u2081/idx\n-37  (= slot\u2081/idx (call top.add_int %\u2083\u2086 1))\n-38  (= slot\u2082/next (call top.iterate %\u2081 %\u2082\u2087))\n-39  slot\u2082/next\n-40  (call core.=== %\u2083\u2089 core.nothing)\n-41  (call top.not_int %\u2084\u2080)\n-42  (gotoifnot %\u2084\u2081 label\u2084\u2084)\n-43  (goto label\u2082\u2083)\n-44  (= slot\u2083/next (call top.iterate %\u2082 %\u2081\u2087))\n-45  slot\u2083/next\n-46  (call core.=== %\u2084\u2085 core.nothing)\n-47  (call top.not_int %\u2084\u2086)\n-48  (gotoifnot %\u2084\u2087 label\u2085\u2080)\n-49  (goto label\u2081\u2085)\n-50  (return %\u2087)\n+29  (call core.tuple %\u2082\u2088 slot\u2085/y)\n+30  (gotoifnot %\u2085 label\u2083\u2083)\n+31  (call top.push! %\u2087 %\u2082\u2089)\n+32  (goto label\u2083\u2085)\n+33  slot\u2081/idx\n+34  (call top.setindex! %\u2087 %\u2082\u2089 %\u2083\u2083)\n+35  slot\u2081/idx\n+36  (= slot\u2081/idx (call top.add_int %\u2083\u2085 1))\n+37  (= slot\u2082/next (call top.iterate %\u2081 %\u2082\u2087))\n+38  slot\u2082/next\n+39  (call core.=== %\u2083\u2088 core.nothing)\n+40  (call top.not_int %\u2083\u2089)\n+41  (gotoifnot %\u2084\u2080 label\u2084\u2083)\n+42  (goto label\u2082\u2083)\n+43  (= slot\u2083/next (call top.iterate %\u2082 %\u2081\u2087))\n+44  slot\u2083/next\n+45  (call core.=== %\u2084\u2084 core.nothing)\n+46  (call top.not_int %\u2084\u2085)\n+47  (gotoifnot %\u2084\u2086 label\u2084\u2089)\n+48  (goto label\u2081\u2085)\n+49  (return %\u2087)"
    },
    {
      "sha": "a3c64a70e5e3e462f13a21528a04b37dcdc67213",
      "filename": "JuliaLowering/test/quoting_ir.jl",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fquoting_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fquoting_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fquoting_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -39,10 +39,9 @@ end\n #---------------------\n 1   1\n 2   (= slot\u2081/x %\u2081)\n-3   slot\u2081/x\n-4   (call core.tuple %\u2083)\n-5   (call JuliaLowering.interpolate_ast SyntaxTree (inert (. A ($ x))) %\u2084)\n-6   (return %\u2085)\n+3   (call core.tuple slot\u2081/x)\n+4   (call JuliaLowering.interpolate_ast SyntaxTree (inert (. A ($ x))) %\u2083)\n+5   (return %\u2084)\n \n ########################################\n # Error: Double escape"
    },
    {
      "sha": "2b82f9f5dd28672dda74d0345b62ac8e2f4088c9",
      "filename": "JuliaLowering/test/scopes_ir.jl",
      "status": "modified",
      "additions": 62,
      "deletions": 70,
      "changes": 132,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fscopes_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Fscopes_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Fscopes_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -13,18 +13,16 @@ end\n 2   TestMod.T\n 3   (newvar slot\u2082/T)\n 4   (= slot\u2083/tmp %\u2081)\n-5   slot\u2083/tmp\n-6   (call core.isa %\u2085 %\u2082)\n-7   (gotoifnot %\u2086 label\u2089)\n-8   (goto label\u2081\u2082)\n-9   slot\u2083/tmp\n-10  (call top.convert %\u2082 %\u2089)\n-11  (= slot\u2083/tmp (call core.typeassert %\u2081\u2080 %\u2082))\n-12  slot\u2083/tmp\n-13  (= slot\u2081/x %\u2081\u2082)\n-14  (= slot\u2082/T 1)\n-15  slot\u2082/T\n-16  (return %\u2081\u2085)\n+5   (call core.isa slot\u2083/tmp %\u2082)\n+6   (gotoifnot %\u2085 label\u2088)\n+7   (goto label\u2081\u2080)\n+8   (call top.convert %\u2082 slot\u2083/tmp)\n+9   (= slot\u2083/tmp (call core.typeassert %\u2088 %\u2082))\n+10  slot\u2083/tmp\n+11  (= slot\u2081/x %\u2081\u2080)\n+12  (= slot\u2082/T 1)\n+13  slot\u2082/T\n+14  (return %\u2081\u2083)\n \n ########################################\n # let syntax with tuple on lhs\n@@ -60,10 +58,9 @@ end\n 3   (call %\u2081 %\u2082)\n 4   (= slot\u2081/x %\u2083)\n 5   TestMod.g\n-6   slot\u2081/x\n-7   (call %\u2085 %\u2086)\n-8   (= slot\u2082/x %\u2087)\n-9   (return core.nothing)\n+6   (call %\u2085 slot\u2081/x)\n+7   (= slot\u2082/x %\u2086)\n+8   (return core.nothing)\n \n ########################################\n # let syntax with a function definition in the binding list creates a closure\n@@ -403,40 +400,38 @@ end\n #---------------------\n 1   1\n 2   (= slot\u2081/x (call core.Box))\n-3   slot\u2081/x\n-4   (call core.setfield! %\u2083 :contents %\u2081)\n-5   (call core.declare_global TestMod :f false)\n-6   latestworld\n-7   (method TestMod.f)\n-8   latestworld\n-9   TestMod.f\n-10  (call core.Typeof %\u2089)\n-11  (call core.svec %\u2081\u2080 core.Any)\n-12  (call core.svec)\n-13  SourceLocation::2:12\n-14  (call core.svec %\u2081\u2081 %\u2081\u2082 %\u2081\u2083)\n-15  --- code_info\n+3   (call core.setfield! slot\u2081/x :contents %\u2081)\n+4   (call core.declare_global TestMod :f false)\n+5   latestworld\n+6   (method TestMod.f)\n+7   latestworld\n+8   TestMod.f\n+9   (call core.Typeof %\u2088)\n+10  (call core.svec %\u2089 core.Any)\n+11  (call core.svec)\n+12  SourceLocation::2:12\n+13  (call core.svec %\u2081\u2080 %\u2081\u2081 %\u2081\u2082)\n+14  --- code_info\n     slots: [slot\u2081/#self#(!read) slot\u2082/y]\n     1   slot\u2082/y\n     2   (captured_local 1)\n     3   (call core.setfield! %\u2082 :contents %\u2081)\n     4   (return %\u2081)\n-16  slot\u2081/x\n-17  (call core.svec %\u2081\u2086)\n-18  (call JuliaLowering.replace_captured_locals! %\u2081\u2085 %\u2081\u2087)\n-19  --- method core.nothing %\u2081\u2084 %\u2081\u2088\n+15  (call core.svec slot\u2081/x)\n+16  (call JuliaLowering.replace_captured_locals! %\u2081\u2084 %\u2081\u2085)\n+17  --- method core.nothing %\u2081\u2083 %\u2081\u2086\n+18  latestworld\n+19  (call core.declare_global TestMod :g false)\n 20  latestworld\n-21  (call core.declare_global TestMod :g false)\n+21  (method TestMod.g)\n 22  latestworld\n-23  (method TestMod.g)\n-24  latestworld\n-25  TestMod.g\n-26  (call core.Typeof %\u2082\u2085)\n-27  (call core.svec %\u2082\u2086)\n-28  (call core.svec)\n-29  SourceLocation::3:12\n-30  (call core.svec %\u2082\u2087 %\u2082\u2088 %\u2082\u2089)\n-31  --- code_info\n+23  TestMod.g\n+24  (call core.Typeof %\u2082\u2083)\n+25  (call core.svec %\u2082\u2084)\n+26  (call core.svec)\n+27  SourceLocation::3:12\n+28  (call core.svec %\u2082\u2085 %\u2082\u2086 %\u2082\u2087)\n+29  --- code_info\n     slots: [slot\u2081/#self#(!read) slot\u2082/x(!read,maybe_undef)]\n     1   (captured_local 1)\n     2   (call core.isdefined %\u2081 :contents)\n@@ -446,13 +441,12 @@ end\n     6   slot\u2082/x\n     7   (call core.getfield %\u2081 :contents)\n     8   (return %\u2087)\n-32  slot\u2081/x\n-33  (call core.svec %\u2083\u2082)\n-34  (call JuliaLowering.replace_captured_locals! %\u2083\u2081 %\u2083\u2083)\n-35  --- method core.nothing %\u2083\u2080 %\u2083\u2084\n-36  latestworld\n-37  TestMod.g\n-38  (return %\u2083\u2087)\n+30  (call core.svec slot\u2081/x)\n+31  (call JuliaLowering.replace_captured_locals! %\u2082\u2089 %\u2083\u2080)\n+32  --- method core.nothing %\u2082\u2088 %\u2083\u2081\n+33  latestworld\n+34  TestMod.g\n+35  (return %\u2083\u2084)\n \n ########################################\n # Modify assignment operator on closure variable\n@@ -462,19 +456,18 @@ end\n #---------------------\n 1   1\n 2   (= slot\u2081/x (call core.Box))\n-3   slot\u2081/x\n-4   (call core.setfield! %\u2083 :contents %\u2081)\n-5   (call core.declare_global TestMod :f false)\n-6   latestworld\n-7   (method TestMod.f)\n-8   latestworld\n-9   TestMod.f\n-10  (call core.Typeof %\u2089)\n-11  (call core.svec %\u2081\u2080)\n-12  (call core.svec)\n-13  SourceLocation::2:12\n-14  (call core.svec %\u2081\u2081 %\u2081\u2082 %\u2081\u2083)\n-15  --- code_info\n+3   (call core.setfield! slot\u2081/x :contents %\u2081)\n+4   (call core.declare_global TestMod :f false)\n+5   latestworld\n+6   (method TestMod.f)\n+7   latestworld\n+8   TestMod.f\n+9   (call core.Typeof %\u2088)\n+10  (call core.svec %\u2089)\n+11  (call core.svec)\n+12  SourceLocation::2:12\n+13  (call core.svec %\u2081\u2080 %\u2081\u2081 %\u2081\u2082)\n+14  --- code_info\n     slots: [slot\u2081/#self#(!read) slot\u2082/x(!read,maybe_undef)]\n     1   TestMod.+\n     2   (captured_local 1)\n@@ -488,10 +481,9 @@ end\n     10  (captured_local 1)\n     11  (call core.setfield! %\u2081\u2080 :contents %\u2089)\n     12  (return %\u2089)\n-16  slot\u2081/x\n-17  (call core.svec %\u2081\u2086)\n-18  (call JuliaLowering.replace_captured_locals! %\u2081\u2085 %\u2081\u2087)\n-19  --- method core.nothing %\u2081\u2084 %\u2081\u2088\n-20  latestworld\n-21  TestMod.f\n-22  (return %\u2082\u2081)\n+15  (call core.svec slot\u2081/x)\n+16  (call JuliaLowering.replace_captured_locals! %\u2081\u2084 %\u2081\u2085)\n+17  --- method core.nothing %\u2081\u2083 %\u2081\u2086\n+18  latestworld\n+19  TestMod.f\n+20  (return %\u2081\u2089)"
    },
    {
      "sha": "764965b78c324f9a159091b7581880a6f98b5cf5",
      "filename": "JuliaLowering/test/typedefs_ir.jl",
      "status": "modified",
      "additions": 133,
      "deletions": 161,
      "changes": 294,
      "blob_url": "https://github.com/JuliaLang/julia/blob/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Ftypedefs_ir.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68/JuliaLowering%2Ftest%2Ftypedefs_ir.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/JuliaLowering%2Ftest%2Ftypedefs_ir.jl?ref=bfcfc5b032664ba064e3dcd7c9d6942e6fb81e68",
      "patch": "@@ -4,10 +4,9 @@ A where X\n #---------------------\n 1   (call core.TypeVar :X)\n 2   (= slot\u2081/X %\u2081)\n-3   slot\u2081/X\n-4   TestMod.A\n-5   (call core.UnionAll %\u2083 %\u2084)\n-6   (return %\u2085)\n+3   TestMod.A\n+4   (call core.UnionAll slot\u2081/X %\u2083)\n+5   (return %\u2084)\n \n ########################################\n # where expression with upper bound\n@@ -16,10 +15,9 @@ A where X <: UB\n 1   TestMod.UB\n 2   (call core.TypeVar :X %\u2081)\n 3   (= slot\u2081/X %\u2082)\n-4   slot\u2081/X\n-5   TestMod.A\n-6   (call core.UnionAll %\u2084 %\u2085)\n-7   (return %\u2086)\n+4   TestMod.A\n+5   (call core.UnionAll slot\u2081/X %\u2084)\n+6   (return %\u2085)\n \n ########################################\n # where expression with lower bound\n@@ -28,10 +26,9 @@ A where X >: LB\n 1   TestMod.LB\n 2   (call core.TypeVar :X %\u2081 core.Any)\n 3   (= slot\u2081/X %\u2082)\n-4   slot\u2081/X\n-5   TestMod.A\n-6   (call core.UnionAll %\u2084 %\u2085)\n-7   (return %\u2086)\n+4   TestMod.A\n+5   (call core.UnionAll slot\u2081/X %\u2084)\n+6   (return %\u2085)\n \n ########################################\n # where expression with both bounds\n@@ -41,42 +38,35 @@ A where LB <: X <: UB\n 2   TestMod.UB\n 3   (call core.TypeVar :X %\u2081 %\u2082)\n 4   (= slot\u2081/X %\u2083)\n-5   slot\u2081/X\n-6   TestMod.A\n-7   (call core.UnionAll %\u2085 %\u2086)\n-8   (return %\u2087)\n+5   TestMod.A\n+6   (call core.UnionAll slot\u2081/X %\u2085)\n+7   (return %\u2086)\n \n ########################################\n # where expression with braces\n A where {X, Y<:X}\n #---------------------\n 1   (call core.TypeVar :X)\n 2   (= slot\u2081/X %\u2081)\n-3   slot\u2081/X\n-4   slot\u2081/X\n-5   (call core.TypeVar :Y %\u2084)\n-6   (= slot\u2082/Y %\u2085)\n-7   slot\u2082/Y\n-8   TestMod.A\n-9   (call core.UnionAll %\u2087 %\u2088)\n-10  (call core.UnionAll %\u2083 %\u2089)\n-11  (return %\u2081\u2080)\n+3   (call core.TypeVar :Y slot\u2081/X)\n+4   (= slot\u2082/Y %\u2083)\n+5   TestMod.A\n+6   (call core.UnionAll slot\u2082/Y %\u2085)\n+7   (call core.UnionAll slot\u2081/X %\u2086)\n+8   (return %\u2087)\n \n ########################################\n # Equivalent nested where expression without braces\n A where Y<:X where X\n #---------------------\n 1   (call core.TypeVar :X)\n 2   (= slot\u2081/X %\u2081)\n-3   slot\u2081/X\n-4   slot\u2081/X\n-5   (call core.TypeVar :Y %\u2084)\n-6   (= slot\u2082/Y %\u2085)\n-7   slot\u2082/Y\n-8   TestMod.A\n-9   (call core.UnionAll %\u2087 %\u2088)\n-10  (call core.UnionAll %\u2083 %\u2089)\n-11  (return %\u2081\u2080)\n+3   (call core.TypeVar :Y slot\u2081/X)\n+4   (= slot\u2082/Y %\u2083)\n+5   TestMod.A\n+6   (call core.UnionAll slot\u2082/Y %\u2085)\n+7   (call core.UnionAll slot\u2081/X %\u2086)\n+8   (return %\u2087)\n \n ########################################\n # Error: bad type bounds\n@@ -191,8 +181,29 @@ abstract type A end\n 2   (call core._abstracttype TestMod :A %\u2081)\n 3   (= slot\u2081/A %\u2082)\n 4   (call core._setsuper! %\u2082 core.Any)\n-5   slot\u2081/A\n-6   (call core._typebody! false %\u2085)\n+5   (call core._typebody! false slot\u2081/A)\n+6   (call core.declare_global TestMod :A false)\n+7   latestworld\n+8   (call core.isdefinedglobal TestMod :A false)\n+9   (gotoifnot %\u2088 label\u2081\u2084)\n+10  TestMod.A\n+11  (call core._equiv_typedef %\u2081\u2080 %\u2082)\n+12  (gotoifnot %\u2081\u2081 label\u2081\u2084)\n+13  (goto label\u2081\u2086)\n+14  (call core.declare_const TestMod :A %\u2082)\n+15  latestworld\n+16  (return core.nothing)\n+\n+########################################\n+# Abstract type definition with supertype\n+abstract type A <: B end\n+#---------------------\n+1   (call core.svec)\n+2   (call core._abstracttype TestMod :A %\u2081)\n+3   (= slot\u2081/A %\u2082)\n+4   TestMod.B\n+5   (call core._setsuper! %\u2082 %\u2084)\n+6   (call core._typebody! false slot\u2081/A)\n 7   (call core.declare_global TestMod :A false)\n 8   latestworld\n 9   (call core.isdefinedglobal TestMod :A false)\n@@ -205,29 +216,6 @@ abstract type A end\n 16  latestworld\n 17  (return core.nothing)\n \n-########################################\n-# Abstract type definition with supertype\n-abstract type A <: B end\n-#---------------------\n-1   (call core.svec)\n-2   (call core._abstracttype TestMod :A %\u2081)\n-3   (= slot\u2081/A %\u2082)\n-4   TestMod.B\n-5   (call core._setsuper! %\u2082 %\u2084)\n-6   slot\u2081/A\n-7   (call core._typebody! false %\u2086)\n-8   (call core.declare_global TestMod :A false)\n-9   latestworld\n-10  (call core.isdefinedglobal TestMod :A false)\n-11  (gotoifnot %\u2081\u2080 label\u2081\u2086)\n-12  TestMod.A\n-13  (call core._equiv_typedef %\u2081\u2082 %\u2082)\n-14  (gotoifnot %\u2081\u2083 label\u2081\u2086)\n-15  (goto label\u2081\u2088)\n-16  (call core.declare_const TestMod :A %\u2082)\n-17  latestworld\n-18  (return core.nothing)\n-\n ########################################\n # Abstract type definition with multiple typevars\n abstract type A{X, Y <: X} end\n@@ -241,19 +229,18 @@ abstract type A{X, Y <: X} end\n 7   (call core._abstracttype TestMod :A %\u2086)\n 8   (= slot\u2081/A %\u2087)\n 9   (call core._setsuper! %\u2087 core.Any)\n-10  slot\u2081/A\n-11  (call core._typebody! false %\u2081\u2080)\n-12  (call core.declare_global TestMod :A false)\n-13  latestworld\n-14  (call core.isdefinedglobal TestMod :A false)\n-15  (gotoifnot %\u2081\u2084 label\u2082\u2080)\n-16  TestMod.A\n-17  (call core._equiv_typedef %\u2081\u2086 %\u2087)\n-18  (gotoifnot %\u2081\u2087 label\u2082\u2080)\n-19  (goto label\u2082\u2082)\n-20  (call core.declare_const TestMod :A %\u2087)\n-21  latestworld\n-22  (return core.nothing)\n+10  (call core._typebody! false slot\u2081/A)\n+11  (call core.declare_global TestMod :A false)\n+12  latestworld\n+13  (call core.isdefinedglobal TestMod :A false)\n+14  (gotoifnot %\u2081\u2083 label\u2081\u2089)\n+15  TestMod.A\n+16  (call core._equiv_typedef %\u2081\u2085 %\u2087)\n+17  (gotoifnot %\u2081\u2086 label\u2081\u2089)\n+18  (goto label\u2082\u2081)\n+19  (call core.declare_const TestMod :A %\u2087)\n+20  latestworld\n+21  (return core.nothing)\n \n ########################################\n # Error: Abstract type definition with bad signature\n@@ -299,19 +286,18 @@ primitive type P 8 end\n 2   (call core._primitivetype TestMod :P %\u2081 8)\n 3   (= slot\u2081/P %\u2082)\n 4   (call core._setsuper! %\u2082 core.Any)\n-5   slot\u2081/P\n-6   (call core._typebody! false %\u2085)\n-7   (call core.declare_global TestMod :P false)\n-8   latestworld\n-9   (call core.isdefinedglobal TestMod :P false)\n-10  (gotoifnot %\u2089 label\u2081\u2085)\n-11  TestMod.P\n-12  (call core._equiv_typedef %\u2081\u2081 %\u2082)\n-13  (gotoifnot %\u2081\u2082 label\u2081\u2085)\n-14  (goto label\u2081\u2087)\n-15  (call core.declare_const TestMod :P %\u2082)\n-16  latestworld\n-17  (return core.nothing)\n+5   (call core._typebody! false slot\u2081/P)\n+6   (call core.declare_global TestMod :P false)\n+7   latestworld\n+8   (call core.isdefinedglobal TestMod :P false)\n+9   (gotoifnot %\u2088 label\u2081\u2084)\n+10  TestMod.P\n+11  (call core._equiv_typedef %\u2081\u2080 %\u2082)\n+12  (gotoifnot %\u2081\u2081 label\u2081\u2084)\n+13  (goto label\u2081\u2086)\n+14  (call core.declare_const TestMod :P %\u2082)\n+15  latestworld\n+16  (return core.nothing)\n \n ########################################\n # Complex primitive type definition\n@@ -326,19 +312,18 @@ primitive type P{X,Y} <: Z 32 end\n 7   (= slot\u2081/P %\u2086)\n 8   TestMod.Z\n 9   (call core._setsuper! %\u2086 %\u2088)\n-10  slot\u2081/P\n-11  (call core._typebody! false %\u2081\u2080)\n-12  (call core.declare_global TestMod :P false)\n-13  latestworld\n-14  (call core.isdefinedglobal TestMod :P false)\n-15  (gotoifnot %\u2081\u2084 label\u2082\u2080)\n-16  TestMod.P\n-17  (call core._equiv_typedef %\u2081\u2086 %\u2086)\n-18  (gotoifnot %\u2081\u2087 label\u2082\u2080)\n-19  (goto label\u2082\u2082)\n-20  (call core.declare_const TestMod :P %\u2086)\n-21  latestworld\n-22  (return core.nothing)\n+10  (call core._typebody! false slot\u2081/P)\n+11  (call core.declare_global TestMod :P false)\n+12  latestworld\n+13  (call core.isdefinedglobal TestMod :P false)\n+14  (gotoifnot %\u2081\u2083 label\u2081\u2089)\n+15  TestMod.P\n+16  (call core._equiv_typedef %\u2081\u2085 %\u2086)\n+17  (gotoifnot %\u2081\u2086 label\u2081\u2089)\n+18  (goto label\u2082\u2081)\n+19  (call core.declare_const TestMod :P %\u2086)\n+20  latestworld\n+21  (return core.nothing)\n \n ########################################\n # Primitive type definition with computed size (should this be allowed??)\n@@ -350,19 +335,18 @@ primitive type P P_nbits() end\n 4   (call core._primitivetype TestMod :P %\u2081 %\u2083)\n 5   (= slot\u2081/P %\u2084)\n 6   (call core._setsuper! %\u2084 core.Any)\n-7   slot\u2081/P\n-8   (call core._typebody! false %\u2087)\n-9   (call core.declare_global TestMod :P false)\n-10  latestworld\n-11  (call core.isdefinedglobal TestMod :P false)\n-12  (gotoifnot %\u2081\u2081 label\u2081\u2087)\n-13  TestMod.P\n-14  (call core._equiv_typedef %\u2081\u2083 %\u2084)\n-15  (gotoifnot %\u2081\u2084 label\u2081\u2087)\n-16  (goto label\u2081\u2089)\n-17  (call core.declare_const TestMod :P %\u2084)\n-18  latestworld\n-19  (return core.nothing)\n+7   (call core._typebody! false slot\u2081/P)\n+8   (call core.declare_global TestMod :P false)\n+9   latestworld\n+10  (call core.isdefinedglobal TestMod :P false)\n+11  (gotoifnot %\u2081\u2080 label\u2081\u2086)\n+12  TestMod.P\n+13  (call core._equiv_typedef %\u2081\u2082 %\u2084)\n+14  (gotoifnot %\u2081\u2083 label\u2081\u2086)\n+15  (goto label\u2081\u2088)\n+16  (call core.declare_const TestMod :P %\u2084)\n+17  latestworld\n+18  (return core.nothing)\n \n ########################################\n # Empty struct\n@@ -505,15 +489,13 @@ end\n     1   (call core.fieldtype slot\u2081/#ctor-self# 2)\n     2   slot\u2083/b\n     3   (= slot\u2085/tmp %\u2082)\n-    4   slot\u2085/tmp\n-    5   (call core.isa %\u2084 %\u2081)\n-    6   (gotoifnot %\u2085 label\u2088)\n-    7   (goto label\u2081\u2080)\n+    4   (call core.isa slot\u2085/tmp %\u2081)\n+    5   (gotoifnot %\u2084 label\u2087)\n+    6   (goto label\u2088)\n+    7   (= slot\u2085/tmp (call top.convert %\u2081 slot\u2085/tmp))\n     8   slot\u2085/tmp\n-    9   (= slot\u2085/tmp (call top.convert %\u2081 %\u2088))\n-    10  slot\u2085/tmp\n-    11  (new slot\u2081/#ctor-self# slot\u2082/a %\u2081\u2080 slot\u2084/c)\n-    12  (return %\u2081\u2081)\n+    9   (new slot\u2081/#ctor-self# slot\u2082/a %\u2088 slot\u2084/c)\n+    10  (return %\u2089)\n 39  latestworld\n 40  TestMod.X\n 41  (call core.apply_type core.Type %\u2084\u2080)\n@@ -762,15 +744,13 @@ end\n     1   (call core.fieldtype slot\u2081/#ctor-self# 1)\n     2   slot\u2082/x\n     3   (= slot\u2083/tmp %\u2082)\n-    4   slot\u2083/tmp\n-    5   (call core.isa %\u2084 %\u2081)\n-    6   (gotoifnot %\u2085 label\u2088)\n-    7   (goto label\u2081\u2080)\n+    4   (call core.isa slot\u2083/tmp %\u2081)\n+    5   (gotoifnot %\u2084 label\u2087)\n+    6   (goto label\u2088)\n+    7   (= slot\u2083/tmp (call top.convert %\u2081 slot\u2083/tmp))\n     8   slot\u2083/tmp\n-    9   (= slot\u2083/tmp (call top.convert %\u2081 %\u2088))\n-    10  slot\u2083/tmp\n-    11  (new slot\u2081/#ctor-self# %\u2081\u2080)\n-    12  (return %\u2081\u2081)\n+    9   (new slot\u2081/#ctor-self# %\u2088)\n+    10  (return %\u2089)\n 46  latestworld\n 47  TestMod.X\n 48  (call core.apply_type core.Type %\u2084\u2087)\n@@ -861,15 +841,13 @@ end\n     1   (call core.fieldtype slot\u2081/#ctor-self# 1)\n     2   slot\u2082/v\n     3   (= slot\u2083/tmp %\u2082)\n-    4   slot\u2083/tmp\n-    5   (call core.isa %\u2084 %\u2081)\n-    6   (gotoifnot %\u2085 label\u2088)\n-    7   (goto label\u2081\u2080)\n+    4   (call core.isa slot\u2083/tmp %\u2081)\n+    5   (gotoifnot %\u2084 label\u2087)\n+    6   (goto label\u2088)\n+    7   (= slot\u2083/tmp (call top.convert %\u2081 slot\u2083/tmp))\n     8   slot\u2083/tmp\n-    9   (= slot\u2083/tmp (call top.convert %\u2081 %\u2088))\n-    10  slot\u2083/tmp\n-    11  (new slot\u2081/#ctor-self# %\u2081\u2080)\n-    12  (return %\u2081\u2081)\n+    9   (new slot\u2081/#ctor-self# %\u2088)\n+    10  (return %\u2089)\n 61  latestworld\n 62  TestMod.X\n 63  (call core.apply_type core.Type %\u2086\u2082)\n@@ -1000,15 +978,13 @@ end\n     3   TestMod.+\n     4   (call %\u2083 slot\u2082/y slot\u2083/z)\n     5   (= slot\u2084/tmp (new %\u2082 %\u2084))\n-    6   slot\u2084/tmp\n-    7   (call core.isa %\u2086 %\u2081)\n-    8   (gotoifnot %\u2087 label\u2081\u2080)\n-    9   (goto label\u2081\u2083)\n-    10  slot\u2084/tmp\n-    11  (call top.convert %\u2081 %\u2081\u2080)\n-    12  (= slot\u2084/tmp (call core.typeassert %\u2081\u2081 %\u2081))\n-    13  slot\u2084/tmp\n-    14  (return %\u2081\u2083)\n+    6   (call core.isa slot\u2084/tmp %\u2081)\n+    7   (gotoifnot %\u2086 label\u2089)\n+    8   (goto label\u2081\u2081)\n+    9   (call top.convert %\u2081 slot\u2084/tmp)\n+    10  (= slot\u2084/tmp (call core.typeassert %\u2089 %\u2081))\n+    11  slot\u2084/tmp\n+    12  (return %\u2081\u2081)\n 70  latestworld\n 71  TestMod.X\n 72  (call core.apply_type core.Type %\u2087\u2081)\n@@ -1251,24 +1227,20 @@ end\n     11  slot\u2081/#ctor-self#\n     12  (call core.fieldtype %\u2081\u2081 1)\n     13  (= slot\u2083/tmp (call core.getfield %\u2081 1))\n-    14  slot\u2083/tmp\n-    15  (call core.isa %\u2081\u2084 %\u2081\u2082)\n-    16  (gotoifnot %\u2081\u2085 label\u2081\u2088)\n-    17  (goto label\u2082\u2080)\n+    14  (call core.isa slot\u2083/tmp %\u2081\u2082)\n+    15  (gotoifnot %\u2081\u2084 label\u2081\u2087)\n+    16  (goto label\u2081\u2088)\n+    17  (= slot\u2083/tmp (call top.convert %\u2081\u2082 slot\u2083/tmp))\n     18  slot\u2083/tmp\n-    19  (= slot\u2083/tmp (call top.convert %\u2081\u2082 %\u2081\u2088))\n-    20  slot\u2083/tmp\n-    21  (call core.fieldtype %\u2081\u2081 2)\n-    22  (= slot\u2084/tmp (call core.getfield %\u2081 2))\n-    23  slot\u2084/tmp\n-    24  (call core.isa %\u2082\u2083 %\u2082\u2081)\n-    25  (gotoifnot %\u2082\u2084 label\u2082\u2087)\n-    26  (goto label\u2082\u2089)\n-    27  slot\u2084/tmp\n-    28  (= slot\u2084/tmp (call top.convert %\u2082\u2081 %\u2082\u2087))\n-    29  slot\u2084/tmp\n-    30  (new %\u2081\u2081 %\u2082\u2080 %\u2082\u2089)\n-    31  (return %\u2083\u2080)\n+    19  (call core.fieldtype %\u2081\u2081 2)\n+    20  (= slot\u2084/tmp (call core.getfield %\u2081 2))\n+    21  (call core.isa slot\u2084/tmp %\u2081\u2089)\n+    22  (gotoifnot %\u2082\u2081 label\u2082\u2084)\n+    23  (goto label\u2082\u2085)\n+    24  (= slot\u2084/tmp (call top.convert %\u2081\u2089 slot\u2084/tmp))\n+    25  slot\u2084/tmp\n+    26  (new %\u2081\u2081 %\u2081\u2088 %\u2082\u2085)\n+    27  (return %\u2082\u2086)\n 47  latestworld\n 48  (return core.nothing)\n "
    }
  ]
}