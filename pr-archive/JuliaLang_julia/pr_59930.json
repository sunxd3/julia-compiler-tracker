{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/59930",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/59930/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/59930/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/59930/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/59930",
  "id": 3541313597,
  "node_id": "PR_kwDOABkWpM6vF644",
  "number": 59930,
  "title": "improve performance of `powermod`",
  "user": {
    "login": "adienes",
    "id": 51664769,
    "node_id": "MDQ6VXNlcjUxNjY0NzY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/51664769?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adienes",
    "html_url": "https://github.com/adienes",
    "followers_url": "https://api.github.com/users/adienes/followers",
    "following_url": "https://api.github.com/users/adienes/following{/other_user}",
    "gists_url": "https://api.github.com/users/adienes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adienes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adienes/subscriptions",
    "organizations_url": "https://api.github.com/users/adienes/orgs",
    "repos_url": "https://api.github.com/users/adienes/repos",
    "events_url": "https://api.github.com/users/adienes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adienes/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 115858,
      "node_id": "MDU6TGFiZWwxMTU4NTg=",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/performance",
      "name": "performance",
      "color": "d7e102",
      "default": false,
      "description": "Must go faster"
    },
    {
      "id": 171885699,
      "node_id": "MDU6TGFiZWwxNzE4ODU2OTk=",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/maths",
      "name": "maths",
      "color": "93755D",
      "default": false,
      "description": "Mathematical functions"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 0,
  "created_at": "2025-10-22T15:19:00Z",
  "updated_at": "2025-10-22T20:26:18Z",
  "closed_at": "2025-10-22T20:26:13Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/59930",
    "html_url": "https://github.com/JuliaLang/julia/pull/59930",
    "diff_url": "https://github.com/JuliaLang/julia/pull/59930.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/59930.patch",
    "merged_at": "2025-10-22T20:26:13Z"
  },
  "body": "based off of and closes https://github.com/JuliaLang/julia/pull/54866\r\n\r\ndifferences to https://github.com/JuliaLang/julia/pull/54866 are:\r\n\r\n* checks `iszero(r)` in `mod(a, ::SignedMultiplicativeInverse)` for cases like `mod(0, multiplicativeinverse(-5))`\r\n* catches some cases of mismatched signed-ness of `x, m` that were failing\r\n* added a very very rough heuristic `(p > 2sizeof(mm))` so we don't bother computing the mi when the power is very small\r\n* switched to LSB multiplication loop from MSB\r\n\r\nbenchmark:\r\n```\r\nusing BenchmarkTools\r\n\r\nfunction setup()\r\n    x,p,m = rand(NTuple{3, Int})\r\n    while iszero(m) || ((p < 0) && !isone(gcd(x, m)))\r\n        x,p,m = rand(NTuple{3, Int})\r\n    end\r\n    return (x, p, m)\r\nend\r\n\r\n@benchmark powermod(x, p, m) setup=((x,p,m) = setup())\r\n\r\n\r\n#master\r\nBenchmarkTools.Trial: 10000 samples with 10 evaluations per sample.\r\n Range (min \u2026 max):  1.304 \u03bcs \u2026   8.938 \u03bcs  \u250a GC (min \u2026 max): 0.00% \u2026 0.00%\r\n Time  (median):     1.779 \u03bcs               \u250a GC (median):    0.00%\r\n Time  (mean \u00b1 \u03c3):   1.803 \u03bcs \u00b1 270.848 ns  \u250a GC (mean \u00b1 \u03c3):  0.00% \u00b1 0.00%\r\n\r\n               \u2582\u2584\u2585\u2588\u2588\u2588\u2588\u2587\u2586\u2584\u2581\u2581                                    \r\n  \u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2582\u2582\u2583\u2585\u2585\u2587\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2586\u2585\u2584\u2583\u2582\u2582\u2582\u2582\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581\u2581 \u2583\r\n  1.3 \u03bcs          Histogram: frequency by time        2.76 \u03bcs <\r\n\r\n Memory estimate: 0 bytes, allocs estimate: 0.\r\n\r\n\r\n\r\n#PR\r\njulia> @benchmark powermod(x, p, m) setup=((x,p,m) = setup())\r\nBenchmarkTools.Trial: 10000 samples with 135 evaluations per sample.\r\n Range (min \u2026 max):  667.896 ns \u2026  1.267 \u03bcs  \u250a GC (min \u2026 max): 0.00% \u2026 0.00%\r\n Time  (median):     854.015 ns              \u250a GC (median):    0.00%\r\n Time  (mean \u00b1 \u03c3):   886.407 ns \u00b1 74.610 ns  \u250a GC (mean \u00b1 \u03c3):  0.00% \u00b1 0.00%\r\n\r\n                        \u2582\u2583\u2586\u2588\u2588\u2585\u2582                                 \r\n  \u2582\u2582\u2581\u2581\u2582\u2582\u2582\u2582\u2582\u2582\u2582\u2582\u2582\u2582\u2583\u2583\u2583\u2584\u2584\u2585\u2586\u2587\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2586\u2585\u2584\u2583\u2583\u2583\u2583\u2583\u2584\u2584\u2585\u2586\u2586\u2587\u2587\u2588\u2588\u2588\u2588\u2587\u2586\u2586\u2585\u2584\u2583\u2583\u2583\u2583\u2582\u2582 \u2584\r\n  668 ns          Histogram: frequency by time         1.06 \u03bcs <\r\n\r\n Memory estimate: 0 bytes, allocs estimate: 0.\r\n```",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/59930/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 1,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/59930/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0
}