{
  "url": "https://api.github.com/repos/JuliaLang/julia/issues/60076",
  "repository_url": "https://api.github.com/repos/JuliaLang/julia",
  "labels_url": "https://api.github.com/repos/JuliaLang/julia/issues/60076/labels{/name}",
  "comments_url": "https://api.github.com/repos/JuliaLang/julia/issues/60076/comments",
  "events_url": "https://api.github.com/repos/JuliaLang/julia/issues/60076/events",
  "html_url": "https://github.com/JuliaLang/julia/pull/60076",
  "id": 3600233333,
  "node_id": "PR_kwDOABkWpM6yIV57",
  "number": 60076,
  "title": "Term hist UI tweaks",
  "user": {
    "login": "tecosaur",
    "id": 20903656,
    "node_id": "MDQ6VXNlcjIwOTAzNjU2",
    "avatar_url": "https://avatars.githubusercontent.com/u/20903656?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tecosaur",
    "html_url": "https://github.com/tecosaur",
    "followers_url": "https://api.github.com/users/tecosaur/followers",
    "following_url": "https://api.github.com/users/tecosaur/following{/other_user}",
    "gists_url": "https://api.github.com/users/tecosaur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tecosaur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tecosaur/subscriptions",
    "organizations_url": "https://api.github.com/users/tecosaur/orgs",
    "repos_url": "https://api.github.com/users/tecosaur/repos",
    "events_url": "https://api.github.com/users/tecosaur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tecosaur/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 42281298,
      "node_id": "MDU6TGFiZWw0MjI4MTI5OA==",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/REPL",
      "name": "REPL",
      "color": "c7def8",
      "default": false,
      "description": "Julia's REPL (Read Eval Print Loop)"
    },
    {
      "id": 511192218,
      "node_id": "MDU6TGFiZWw1MTExOTIyMTg=",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/display%20and%20printing",
      "name": "display and printing",
      "color": "e5ff9e",
      "default": false,
      "description": "Aesthetics and correctness of printed representations of objects."
    },
    {
      "id": 706812401,
      "node_id": "MDU6TGFiZWw3MDY4MTI0MDE=",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/stdlib",
      "name": "stdlib",
      "color": "6F689E",
      "default": false,
      "description": "Julia's standard library"
    },
    {
      "id": 4232017300,
      "node_id": "LA_kwDOABkWpM78P3WU",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/don't%20squash",
      "name": "don't squash",
      "color": "ff4500",
      "default": false,
      "description": "Don't squash merge"
    },
    {
      "id": 9546926682,
      "node_id": "LA_kwDOABkWpM8AAAACOQqKWg",
      "url": "https://api.github.com/repos/JuliaLang/julia/labels/backport%201.13",
      "name": "backport 1.13",
      "color": "699295",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 6,
  "created_at": "2025-11-07T12:57:41Z",
  "updated_at": "2025-11-13T18:00:23Z",
  "closed_at": "2025-11-13T18:00:23Z",
  "author_association": "MEMBER",
  "type": null,
  "active_lock_reason": null,
  "draft": false,
  "pull_request": {
    "url": "https://api.github.com/repos/JuliaLang/julia/pulls/60076",
    "html_url": "https://github.com/JuliaLang/julia/pull/60076",
    "diff_url": "https://github.com/JuliaLang/julia/pull/60076.diff",
    "patch_url": "https://github.com/JuliaLang/julia/pull/60076.patch",
    "merged_at": "2025-11-13T18:00:23Z"
  },
  "body": "This is a small collection of (what I consider) innocuous fixes/tweaks to the history UI.\r\n\r\nIf anything is bikesheddable, I'll split it off into a separate PR.\r\n\r\nCloses: #60036",
  "reactions": {
    "url": "https://api.github.com/repos/JuliaLang/julia/issues/60076/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/JuliaLang/julia/issues/60076/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "score": 1.0,
  "files": [
    {
      "sha": "aed78d00fa9d68556e089c9520b3e3afc7aa08cf",
      "filename": "stdlib/REPL/src/History/resumablefiltering.jl",
      "status": "modified",
      "additions": 30,
      "deletions": 16,
      "changes": 46,
      "blob_url": "https://github.com/JuliaLang/julia/blob/34bbe85f48010dcca1b495340da6a6b59f5cff5e/stdlib%2FREPL%2Fsrc%2FHistory%2Fresumablefiltering.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/34bbe85f48010dcca1b495340da6a6b59f5cff5e/stdlib%2FREPL%2Fsrc%2FHistory%2Fresumablefiltering.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FREPL%2Fsrc%2FHistory%2Fresumablefiltering.jl?ref=34bbe85f48010dcca1b495340da6a6b59f5cff5e",
      "patch": "@@ -24,7 +24,7 @@ const FILTER_SEPARATOR = ';'\n \n List of single-character prefixes that set search modes.\n \"\"\"\n-const FILTER_PREFIXES = ('!', '`', '=', '/', '~', '>')\n+const FILTER_PREFIXES = ('!', '`', '=', '/', '~')\n \n \"\"\"\n     FILTER_SHORTHELP_QUERY\n@@ -53,20 +53,22 @@ const FILTER_SHORTHELP = S\"\"\"\n \n  See more information on behaviour and keybindings with '{REPL_History_search_prefix:??}'.\n \n+ By default, each word in the search string is looked for in any order.\n+ Should the search string start with {REPL_History_search_prefix:xyz>}, then only xyz-mode entries are considered.\n+\n  Different search modes are available via prefixes, as follows:\n  {emphasis:\u2022} {REPL_History_search_prefix:=} looks for exact matches\n  {emphasis:\u2022} {REPL_History_search_prefix:!} {italic:excludes} exact matches\n  {emphasis:\u2022} {REPL_History_search_prefix:/} performs a regexp search\n  {emphasis:\u2022} {REPL_History_search_prefix:~} looks for fuzzy matches\n- {emphasis:\u2022} {REPL_History_search_prefix:>} looks for a particular REPL mode\n  {emphasis:\u2022} {REPL_History_search_prefix:`} looks for an initialism (text with matching initials)\n \n  You can also apply multiple restrictions with the separator '{REPL_History_search_separator:$FILTER_SEPARATOR}'.\n \n  For example, {region:{REPL_History_search_prefix:/}^foo{REPL_History_search_separator:$FILTER_SEPARATOR}\\\n {REPL_History_search_prefix:`}bar{REPL_History_search_separator:$FILTER_SEPARATOR}\\\n-{REPL_History_search_prefix:>}shell} will look for history entries that start with \"{code:foo}\",\n- contains \"{code:b... a... r...}\", {italic:and} is a shell history entry.\n+{REPL_History_search_prefix:shell>}} will look for history entries that start with \"{code:foo}\",\n+ contains \"{code:b... a... r...}\", {italic:and} are a shell history entry.\n \"\"\"\n \n const FILTER_LONGHELP = S\"\"\"\n@@ -108,9 +110,9 @@ function ConditionSet(spec::S) where {S <: AbstractString}\n     function addcond!(condset::ConditionSet, cond::SubString)\n         isempty(cond) && return\n         kind = first(cond)\n-        if kind \u2208 ('!', '=', '`', '/', '>', '~')\n+        if kind \u2208 ('!', '=', '`', '/', '~')\n             value = @view cond[2:end]\n-            if kind \u2208 ('`', '>', '~')\n+            if kind \u2208 ('`', '~')\n                 value = strip(value)\n             elseif !all(isspace, value)\n                 value = if kind == '/'\n@@ -128,16 +130,23 @@ function ConditionSet(spec::S) where {S <: AbstractString}\n                 push!(condset.initialisms, value)\n             elseif startswith(cond, '/')\n                 push!(condset.regexps, value)\n-            elseif startswith(cond, '>')\n-                push!(condset.modes, SubString(lowercase(value)))\n             elseif startswith(cond, '~')\n                 push!(condset.fuzzy, value)\n             end\n         else\n             if startswith(cond, '\\\\') && !(length(cond) > 1 && cond[2] == '\\\\')\n                 cond = @view cond[2:end]\n+            else\n+                rang = something(findfirst('>', cond), typemax(Int))\n+                if rang == something(findfirst(isspace, cond), ncodeunits(cond) + 1) - 1\n+                    mode = @view cond[1:prevind(cond, rang)]\n+                    push!(condset.modes, SubString(lowercase(mode)))\n+                    cond = @view cond[rang + 1:end]\n+                end\n             end\n-            push!(condset.words, strip(cond))\n+            cond = strip(cond)\n+            isempty(cond) && return\n+            push!(condset.words, cond)\n         end\n         nothing\n     end\n@@ -155,22 +164,27 @@ function ConditionSet(spec::S) where {S <: AbstractString}\n         elseif chr == '\\\\'\n             escaped = true\n         elseif chr == FILTER_SEPARATOR\n-            str = SubString(spec, mark:pos - 1)\n-            if !isempty(dropbytes)\n-                str = SubString(convert(S, String(deleteat!(collect(codeunits(str)), dropbytes))))\n+            str = if isempty(dropbytes)\n+                SubString(spec, mark:prevind(spec, pos))\n+            else\n+                subbytes = deleteat!(codeunits(spec)[mark:pos-1], dropbytes)\n                 empty!(dropbytes)\n+                SubString(convert(S, String(subbytes)))\n             end\n             addcond!(cset, lstrip(str))\n             mark = pos + 1\n         end\n         pos = nextind(spec, pos)\n     end\n     if mark <= lastind\n-        str = SubString(spec, mark:pos - 1)\n-        if !isempty(dropbytes)\n-            str = SubString(convert(S, String(deleteat!(collect(codeunits(str)), dropbytes))))\n+        str = if isempty(dropbytes)\n+            SubString(spec, mark)\n+        else\n+            subbytes = deleteat!(codeunits(spec)[mark:end], dropbytes)\n+            empty!(dropbytes)\n+            SubString(convert(S, String(subbytes)))\n         end\n-        addcond!(cset, lstrip(SubString(spec, mark:lastind)))\n+        addcond!(cset, lstrip(str))\n     end\n     cset\n end"
    },
    {
      "sha": "4739fc723037f0a4f2dd73fb3cdb93f81b633414",
      "filename": "stdlib/REPL/test/history.jl",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/JuliaLang/julia/blob/34bbe85f48010dcca1b495340da6a6b59f5cff5e/stdlib%2FREPL%2Ftest%2Fhistory.jl",
      "raw_url": "https://github.com/JuliaLang/julia/raw/34bbe85f48010dcca1b495340da6a6b59f5cff5e/stdlib%2FREPL%2Ftest%2Fhistory.jl",
      "contents_url": "https://api.github.com/repos/JuliaLang/julia/contents/stdlib%2FREPL%2Ftest%2Fhistory.jl?ref=34bbe85f48010dcca1b495340da6a6b59f5cff5e",
      "patch": "@@ -206,7 +206,7 @@ end\n                 @test cset.regexps == [SubString(\"foo.*bar\")]\n             end\n             @testset \"Mode\" begin\n-                cset = ConditionSet(\">shell\")\n+                cset = ConditionSet(\"shell>\")\n                 @test cset.modes == [SubString(\"shell\")]\n             end\n             @testset \"Fuzzy\" begin\n@@ -231,9 +231,11 @@ end\n                 cset = ConditionSet(\"hello\\\\;world;=exact\")\n                 @test cset.words == [SubString(\"hello;world\")]\n                 @test cset.exacts == [SubString(\"exact\")]\n+                cset = ConditionSet(\"1 \\\\; 2\")\n+                @test cset.words == [SubString(\"1 ; 2\")]\n             end\n             @testset \"Complex query\" begin\n-                cset = ConditionSet(\"some = words ;; !error ;> julia;/^def.*;\")\n+                cset = ConditionSet(\"some = words ;; !error ; julia> ;/^def.*;\")\n                 @test cset.words == [SubString(\"some = words\")]\n                 @test cset.negatives == [SubString(\"error\")]\n                 @test cset.modes == [SubString(\"julia\")]\n@@ -254,7 +256,7 @@ end\n                 @test isempty(spec2.regexps)\n             end\n             @testset \"Complex query\" begin\n-                cset = ConditionSet(\"=exact;!neg;/foo.*bar;>julia\")\n+                cset = ConditionSet(\"=exact;!neg;/foo.*bar;julia>\")\n                 spec = FilterSpec(cset)\n                 @test spec.exacts == [\"exact\"]\n                 @test spec.negatives == [\"neg\"]\n@@ -332,7 +334,7 @@ end\n             end\n             @testset \"Mode\" begin\n                 empty!(results)\n-                cset = ConditionSet(\">shell\")\n+                cset = ConditionSet(\"shell>\")\n                 spec = FilterSpec(cset)\n                 @test filterchunkrev!(results, entries, spec) == 0\n                 @test results == [entries[7]]"
    }
  ]
}